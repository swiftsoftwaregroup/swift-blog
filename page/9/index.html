
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Swift Software Group Blog">
      
      
      
        <link rel="canonical" href="https://blog.swiftsoftwaregroup.com/page/9/">
      
      
      
        <link rel="next" href="../../arm64/">
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS feed" href="../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.4">
    
    
      
        <title>Blog - Swift Software Group Blog</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-QP5FYNH46M"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-QP5FYNH46M",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-QP5FYNH46M",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#blog" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Swift Software Group Blog" class="md-header__button md-logo" aria-label="Swift Software Group Blog" data-md-component="logo">
      
  <img src="../../images/logo_white.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Swift Software Group Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Blog
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/swiftsoftwaregroup" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="https://swiftsoftwaregroup.com" class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="https://swiftsoftwaregroup.com/services" class="md-tabs__link">
        
  
    
  
  Services

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="https://swiftsoftwaregroup.com/contact-us" class="md-tabs__link">
        
  
    
  
  Contact Us

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Blog

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../archive/2024/" class="md-tabs__link">
          
  
  Archive

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../arm64/" class="md-tabs__link">
          
  
  Categories

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Swift Software Group Blog" class="md-nav__button md-logo" aria-label="Swift Software Group Blog" data-md-component="logo">
      
  <img src="../../images/logo_white.svg" alt="logo">

    </a>
    Swift Software Group Blog
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/swiftsoftwaregroup" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://swiftsoftwaregroup.com" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://swiftsoftwaregroup.com/services" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Services
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://swiftsoftwaregroup.com/contact-us" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contact Us
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
      
    
  
  
    <li class="md-nav__item">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Blog
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="../.." class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Blog
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-to-build-an-nginx-server-and-deploy-a-python-flask-app-using-chef" class="md-nav__link">
    <span class="md-ellipsis">
      How to Build an NGINX Server and Deploy a Python Flask App Using Chef
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-started-with-flashdevelop-on-windows-10" class="md-nav__link">
    <span class="md-ellipsis">
      Getting Started with FlashDevelop on Windows 10
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-install-nginx-on-ubuntu-using-chef" class="md-nav__link">
    <span class="md-ellipsis">
      How To Install Nginx On Ubuntu Using Chef
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-use-berkshelf-chef-zero-vagrant-and-virtualbox" class="md-nav__link">
    <span class="md-ellipsis">
      How to use Berkshelf, Chef Zero, Vagrant and VirtualBox
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#provision-chef-with-vagrant-omnibus-plugin" class="md-nav__link">
    <span class="md-ellipsis">
      Provision Chef with Vagrant-Omnibus Plugin
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Archive
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2024/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2023/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2021/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2021
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2020/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2020
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2018/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2018
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2017/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2017
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2016/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2016
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2015/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2015
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2014/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2014
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2013/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2013
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2012/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2012
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2011/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2011
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Categories
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Categories
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../arm64/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    arm64
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../aws/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    aws
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../aws-cdk/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    aws-cdk
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../aws-cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    aws-cli
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../cloud/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cloud
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../cloud-formation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cloud-formation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../cpp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cpp
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../csharp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    csharp
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../deep-neural-networks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    deep-neural-networks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    docker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../docker-swarm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    docker-swarm
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../dotnet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dotnet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../ec2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ec2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../ecs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ecs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../k3s/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    k3s
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../keras/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    keras
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    kubernetes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../linux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    linux
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../machine-learning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    machine-learning
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../macos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    macos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../mongodb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mongodb
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../podman/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    podman
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../ruby/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ruby
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../tensorflow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tensorflow
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../ubuntu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ubuntu
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../virtual-box/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    virtual-box
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../vscode/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vscode
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../windows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    windows
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-to-build-an-nginx-server-and-deploy-a-python-flask-app-using-chef" class="md-nav__link">
    <span class="md-ellipsis">
      How to Build an NGINX Server and Deploy a Python Flask App Using Chef
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-started-with-flashdevelop-on-windows-10" class="md-nav__link">
    <span class="md-ellipsis">
      Getting Started with FlashDevelop on Windows 10
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-install-nginx-on-ubuntu-using-chef" class="md-nav__link">
    <span class="md-ellipsis">
      How To Install Nginx On Ubuntu Using Chef
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-use-berkshelf-chef-zero-vagrant-and-virtualbox" class="md-nav__link">
    <span class="md-ellipsis">
      How to use Berkshelf, Chef Zero, Vagrant and VirtualBox
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#provision-chef-with-vagrant-omnibus-plugin" class="md-nav__link">
    <span class="md-ellipsis">
      Provision Chef with Vagrant-Omnibus Plugin
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content" data-md-component="content">
    <div class="md-content__inner">
      <header class="md-typeset">
        <h1 id="blog">Blog</h1>
      </header>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2016-02-13 00:00:00">February 13, 2016</time></li>
        
        
          
          <li class="md-meta__item">
            
              14 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="how-to-build-an-nginx-server-and-deploy-a-python-flask-app-using-chef"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/">How to Build an NGINX Server and Deploy a Python Flask App Using Chef</a></h2>
<p>In this post we show how you can use <a href="https://www.chef.io/chef/">Chef</a> to build an Ubuntu 14.04 LTS web server running Nginx, Python 2, virtualenv, uWSGI, and Flask - all done on Windows 10 host. </p>
<p>All commands are executed in PowerShell on a Windows workstation. The Chef version that is used is 12.5.1 - it is the version that comes with ChefDK 0.10.0. To avoid unexpected behavior, we recommend using those versions, when following this step-by-step guide.</p>
<h3 id="before-you-begin"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#before-you-begin">Before You Begin</a></h3>
<h4 id="test-flask-application"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#test-flask-application">Test Flask Application</a></h4>
<p>The test application that we use for this deployment is available in the <a href="https://github.com/vkantchev/my_flask_app">my_flask_app</a> repository. The application was created using Visual Studio 2015 with Python Tools for Visual Studio (PTVS).</p>
<h4 id="install-chocolatey"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#install-chocolatey">Install Chocolatey</a></h4>
<p>If you do not have Chocolatey, you can install it by following the instructions on <a href="https://chocolatey.org/">chocolatey.org</a>. You may also see <a href="http://www.swiftsoftwaregroup.com/use-different-cache-directory-chocolatey-packages/">this post</a> for instructions on how to set the Chocolatey cache location. </p>
<h4 id="install-chef-development-kit-chefdk"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#install-chef-development-kit-chefdk">Install Chef Development Kit (ChefDK)</a></h4>
<p>In PowerShell as <em>Administrator</em>:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-90-1"><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a><span class="n">choco</span> <span class="n">install</span> <span class="n">chefdk</span> <span class="n">-version</span> <span class="n">0</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">1</span>
</span></code></pre></div>
<p>Find your Chef version:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-91-1"><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="n">chef</span> <span class="p">-</span><span class="n">-version</span>
</span><span id="__span-91-2"><a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a>
</span><span id="__span-91-3"><a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a><span class="n">Chef</span> <span class="n">Development</span> <span class="n">Kit</span> <span class="n">Version</span><span class="p">:</span> <span class="n">0</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">0</span>
</span><span id="__span-91-4"><a id="__codelineno-91-4" name="__codelineno-91-4" href="#__codelineno-91-4"></a><span class="n">chef-client</span> <span class="n">version</span><span class="p">:</span> <span class="n">12</span><span class="p">.</span><span class="n">5</span><span class="p">.</span><span class="n">1</span>
</span><span id="__span-91-5"><a id="__codelineno-91-5" name="__codelineno-91-5" href="#__codelineno-91-5"></a><span class="n">berks</span> <span class="n">version</span><span class="p">:</span> <span class="n">4</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">1</span>
</span><span id="__span-91-6"><a id="__codelineno-91-6" name="__codelineno-91-6" href="#__codelineno-91-6"></a><span class="n">kitchen</span> <span class="n">version</span><span class="p">:</span> <span class="n">1</span><span class="p">.</span><span class="n">4</span><span class="p">.</span><span class="n">2</span>
</span></code></pre></div>
<h4 id="install-virtualbox-and-vagrant"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#install-virtualbox-and-vagrant">Install VirtualBox and Vagrant</a></h4>
<p>To install VirtualBox and Vagrant, follow the steps described in <a href="http://www.swiftsoftwaregroup.com/ubuntu-with-vagrant-and-virtualbox-on-windows/">Ubuntu with Vagrant and VirtualBox on Windows</a>.</p>
<h4 id="install-vagrant-plugins"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#install-vagrant-plugins">Install Vagrant Plugins</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-92-1"><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a><span class="n">vagrant</span> <span class="n">plugin</span> <span class="n">install</span> <span class="n">vagrant-omnibus</span>
</span><span id="__span-92-2"><a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a><span class="n">vagrant</span> <span class="n">plugin</span> <span class="n">install</span> <span class="n">vagrant-berkshelf</span>
</span><span id="__span-92-3"><a id="__codelineno-92-3" name="__codelineno-92-3" href="#__codelineno-92-3"></a><span class="n">vagrant</span> <span class="n">plugin</span> <span class="n">install</span> <span class="n">vagrant-hostmanager</span>
</span><span id="__span-92-4"><a id="__codelineno-92-4" name="__codelineno-92-4" href="#__codelineno-92-4"></a><span class="n">vagrant</span> <span class="n">plugin</span> <span class="n">install</span> <span class="n">vagrant-cachier</span>
</span></code></pre></div>
<h4 id="give-your-user-modify-access-to-windirsystem32driversetchosts"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#give-your-user-modify-access-to-windirsystem32driversetchosts">Give your user <code>Modify</code> access to <code>WINDIR%\System32\drivers\etc\hosts</code></a></h4>
<p>This is needed by the <a href="https://github.com/smdahlen/vagrant-hostmanager#windows-support">vagrant-hostmanager</a> Vagrant plugin. In PowerShell as <em>Administrator</em>:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-93-1"><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="nv">$acl</span> <span class="p">=</span> <span class="nb">Get-Acl</span> <span class="n">-Path</span> <span class="nv">$env:SystemRoot</span><span class="p">\</span><span class="n">System32</span><span class="p">\</span><span class="n">drivers</span><span class="p">\</span><span class="n">etc</span><span class="p">\</span><span class="n">hosts</span>
</span><span id="__span-93-2"><a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a><span class="nv">$ar</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Security</span><span class="p">.</span><span class="n">AccessControl</span><span class="p">.</span><span class="n">FileSystemAccessRule</span><span class="p">(</span><span class="nv">$env:username</span><span class="p">,</span> <span class="s1">&#39;Modify&#39;</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s1">&#39;Allow&#39;</span><span class="p">)</span>
</span><span id="__span-93-3"><a id="__codelineno-93-3" name="__codelineno-93-3" href="#__codelineno-93-3"></a><span class="nv">$acl</span><span class="p">.</span><span class="n">SetAccessRule</span><span class="p">(</span><span class="nv">$ar</span><span class="p">)</span>
</span><span id="__span-93-4"><a id="__codelineno-93-4" name="__codelineno-93-4" href="#__codelineno-93-4"></a><span class="nb">Set-Acl</span> <span class="n">-Path</span> <span class="nv">$env:SystemRoot</span><span class="p">\</span><span class="n">System32</span><span class="p">\</span><span class="n">drivers</span><span class="p">\</span><span class="n">etc</span><span class="p">\</span><span class="n">hosts</span> <span class="n">-AclObject</span> <span class="nv">$acl</span>
</span></code></pre></div>
<h3 id="create-chef-cookbook"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#create-chef-cookbook">Create Chef Cookbook</a></h3>
<p>This directory will become the root of your source repository:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-94-1"><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a><span class="n">chef</span> <span class="n">generate</span> <span class="n">cookbook</span> <span class="n">my_flask_server</span>
</span><span id="__span-94-2"><a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a><span class="nb">cd </span><span class="n">my_flask_server</span>
</span></code></pre></div>
<h3 id="ensure-the-apt-cache-is-up-to-date"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#ensure-the-apt-cache-is-up-to-date">Ensure the apt cache is up to date</a></h3>
<h4 id="reference-the-apt-cookbook"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#reference-the-apt-cookbook">Reference the <code>apt</code> Cookbook</a></h4>
<p>Add this line to <code>metadata.rb</code>:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-95-1"><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="n">depends</span><span class="w"> </span><span class="s1">&#39;apt&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;~&gt; 2.9.2&#39;</span>
</span></code></pre></div>
<p>To get the latest version string, run <code>knife cookbook site show apt</code>: </p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-96-1"><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a><span class="n">chef</span> <span class="n">exec</span> <span class="n">knife</span> <span class="n">cookbook</span> <span class="n">site</span> <span class="n">show</span> <span class="n">apt</span> <span class="p">|</span> <span class="n">grep</span> <span class="n">latest_version</span>
</span><span id="__span-96-2"><a id="__codelineno-96-2" name="__codelineno-96-2" href="#__codelineno-96-2"></a><span class="n">latest_version</span><span class="p">:</span>     <span class="n">https</span><span class="p">://</span><span class="n">supermarket</span><span class="p">.</span><span class="n">chef</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">api</span><span class="p">/</span><span class="n">v1</span><span class="p">/</span><span class="n">cookbooks</span><span class="p">/</span><span class="n">apt</span><span class="p">/</span><span class="n">versions</span><span class="p">/</span><span class="n">2</span><span class="p">.</span><span class="n">9</span><span class="p">.</span><span class="n">2</span>
</span></code></pre></div>
<p>Here is the complete file:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-97-1"><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a><span class="nb">name</span><span class="w"> </span><span class="s1">&#39;my_flask_server&#39;</span>
</span><span id="__span-97-2"><a id="__codelineno-97-2" name="__codelineno-97-2" href="#__codelineno-97-2"></a><span class="n">maintainer</span><span class="w"> </span><span class="s1">&#39;The Authors&#39;</span>
</span><span id="__span-97-3"><a id="__codelineno-97-3" name="__codelineno-97-3" href="#__codelineno-97-3"></a><span class="n">maintainer_email</span><span class="w"> </span><span class="s1">&#39;you@example.com&#39;</span>
</span><span id="__span-97-4"><a id="__codelineno-97-4" name="__codelineno-97-4" href="#__codelineno-97-4"></a><span class="n">license</span><span class="w"> </span><span class="s1">&#39;all_rights&#39;</span>
</span><span id="__span-97-5"><a id="__codelineno-97-5" name="__codelineno-97-5" href="#__codelineno-97-5"></a><span class="n">description</span><span class="w"> </span><span class="s1">&#39;Installs/Configures my_flask_server&#39;</span>
</span><span id="__span-97-6"><a id="__codelineno-97-6" name="__codelineno-97-6" href="#__codelineno-97-6"></a><span class="n">long_description</span><span class="w"> </span><span class="s1">&#39;Installs/Configures my_flask_server&#39;</span>
</span><span id="__span-97-7"><a id="__codelineno-97-7" name="__codelineno-97-7" href="#__codelineno-97-7"></a><span class="n">version</span><span class="w"> </span><span class="s1">&#39;0.1.0&#39;</span>
</span><span id="__span-97-8"><a id="__codelineno-97-8" name="__codelineno-97-8" href="#__codelineno-97-8"></a>
</span><span id="__span-97-9"><a id="__codelineno-97-9" name="__codelineno-97-9" href="#__codelineno-97-9"></a><span class="n">depends</span><span class="w"> </span><span class="s1">&#39;apt&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;~&gt; 2.9.2&#39;</span>
</span></code></pre></div>
<h4 id="set-the-apt-cookbooks-default-recipe-to-run"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#set-the-apt-cookbooks-default-recipe-to-run">Set the apt cookbook's default recipe to run</a></h4>
<p>Add this line to <code>recipes/default.rb</code>:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-98-1"><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;apt::default&#39;</span>
</span></code></pre></div>
<p>Here is the complete file:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-99-1"><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a><span class="c1">#</span>
</span><span id="__span-99-2"><a id="__codelineno-99-2" name="__codelineno-99-2" href="#__codelineno-99-2"></a><span class="c1"># Cookbook Name:: my_flask_server</span>
</span><span id="__span-99-3"><a id="__codelineno-99-3" name="__codelineno-99-3" href="#__codelineno-99-3"></a><span class="c1"># Recipe:: default</span>
</span><span id="__span-99-4"><a id="__codelineno-99-4" name="__codelineno-99-4" href="#__codelineno-99-4"></a><span class="c1">#</span>
</span><span id="__span-99-5"><a id="__codelineno-99-5" name="__codelineno-99-5" href="#__codelineno-99-5"></a><span class="c1"># Copyright (c) 2016 The Authors, All Rights Reserved.</span>
</span><span id="__span-99-6"><a id="__codelineno-99-6" name="__codelineno-99-6" href="#__codelineno-99-6"></a>
</span><span id="__span-99-7"><a id="__codelineno-99-7" name="__codelineno-99-7" href="#__codelineno-99-7"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;apt::default&#39;</span>
</span></code></pre></div>
<h3 id="prepare-for-test-driven-development"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#prepare-for-test-driven-development">Prepare for Test Driven Development</a></h3>
<h4 id="add-rspec-file"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#add-rspec-file">Add <code>.rspec</code> file</a></h4>
<p><div class="language-powershell highlight"><pre><span></span><code><span id="__span-100-1"><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a><span class="n">touch</span> <span class="p">.</span><span class="n">rspec</span>
</span></code></pre></div>
Paste this in the <code>.rspec</code> file:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-101-1"><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a>--color
</span><span id="__span-101-2"><a id="__codelineno-101-2" name="__codelineno-101-2" href="#__codelineno-101-2"></a>--format documentation
</span></code></pre></div>
<h4 id="add-kitchenvagrant_cachierrb-file"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#add-kitchenvagrant_cachierrb-file">Add <code>.kitchen.vagrant_cachier.rb</code> file</a></h4>
<p>This file will be merged within Test Kitchen's generated Vagrantfile. In it, we put the configuration for the <code>vagrant-cachier</code> plugin</p>
<p><div class="language-powershell highlight"><pre><span></span><code><span id="__span-102-1"><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a><span class="n">touch</span> <span class="p">.</span><span class="n">kitchen</span><span class="p">.</span><span class="n">vagrant_cachier</span><span class="p">.</span><span class="n">rb</span>
</span></code></pre></div>
Paste this in the <code>.kitchen.vagrant_hostmanager.rb</code> file:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-103-1"><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a><span class="c1"># This requires vagrant-cachier plugin.</span>
</span><span id="__span-103-2"><a id="__codelineno-103-2" name="__codelineno-103-2" href="#__codelineno-103-2"></a><span class="c1"># For more information see http://fgrehm.viewdocs.io/vagrant-cachier/</span>
</span><span id="__span-103-3"><a id="__codelineno-103-3" name="__codelineno-103-3" href="#__codelineno-103-3"></a><span class="c1">#</span>
</span><span id="__span-103-4"><a id="__codelineno-103-4" name="__codelineno-103-4" href="#__codelineno-103-4"></a><span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span id="__span-103-5"><a id="__codelineno-103-5" name="__codelineno-103-5" href="#__codelineno-103-5"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="no">Vagrant</span><span class="o">.</span><span class="n">has_plugin?</span><span class="p">(</span><span class="s2">&quot;vagrant-cachier&quot;</span><span class="p">)</span>
</span><span id="__span-103-6"><a id="__codelineno-103-6" name="__codelineno-103-6" href="#__codelineno-103-6"></a><span class="w">    </span><span class="n">config</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">auto_detect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">true</span>
</span><span id="__span-103-7"><a id="__codelineno-103-7" name="__codelineno-103-7" href="#__codelineno-103-7"></a><span class="w">    </span><span class="n">config</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">scope</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:box</span>
</span><span id="__span-103-8"><a id="__codelineno-103-8" name="__codelineno-103-8" href="#__codelineno-103-8"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-103-9"><a id="__codelineno-103-9" name="__codelineno-103-9" href="#__codelineno-103-9"></a>
</span><span id="__span-103-10"><a id="__codelineno-103-10" name="__codelineno-103-10" href="#__codelineno-103-10"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="no">Vagrant</span><span class="o">.</span><span class="n">has_plugin?</span><span class="p">(</span><span class="s2">&quot;vagrant-omnibus&quot;</span><span class="p">)</span>
</span><span id="__span-103-11"><a id="__codelineno-103-11" name="__codelineno-103-11" href="#__codelineno-103-11"></a><span class="w">    </span><span class="n">config</span><span class="o">.</span><span class="n">omnibus</span><span class="o">.</span><span class="n">cache_packages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">true</span>
</span><span id="__span-103-12"><a id="__codelineno-103-12" name="__codelineno-103-12" href="#__codelineno-103-12"></a><span class="w">    </span><span class="n">config</span><span class="o">.</span><span class="n">omnibus</span><span class="o">.</span><span class="n">chef_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;12.5.1&quot;</span>
</span><span id="__span-103-13"><a id="__codelineno-103-13" name="__codelineno-103-13" href="#__codelineno-103-13"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-103-14"><a id="__codelineno-103-14" name="__codelineno-103-14" href="#__codelineno-103-14"></a>
</span><span id="__span-103-15"><a id="__codelineno-103-15" name="__codelineno-103-15" href="#__codelineno-103-15"></a><span class="w">  </span><span class="n">config</span><span class="o">.</span><span class="n">vbguest</span><span class="o">.</span><span class="n">auto_update</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">false</span>
</span><span id="__span-103-16"><a id="__codelineno-103-16" name="__codelineno-103-16" href="#__codelineno-103-16"></a><span class="k">end</span>
</span></code></pre></div>
<h4 id="add-kitchenvagrant_hostmanagerrb-file"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#add-kitchenvagrant_hostmanagerrb-file">Add <code>.kitchen.vagrant_hostmanager.rb</code> file</a></h4>
<p>This file will be merged within Test Kitchen's generated Vagrantfile. In it, we put the configuration for the <code>vagrant-hostmanager</code> plugin, which updates <code>C:/Windows/System32/drivers/etc/hosts</code>, and allows you to access the virtual machine by name instead of IP address, e.g. <code>default-ubuntu-1404</code>.  </p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-104-1"><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a><span class="n">touch</span> <span class="p">.</span><span class="n">kitchen</span><span class="p">.</span><span class="n">vagrant_hostmanager</span><span class="p">.</span><span class="n">rb</span>
</span></code></pre></div>
<p>Paste this in the <code>.kitchen.vagrant_hostmanager.rb</code> file:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-105-1"><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a><span class="c1"># This requires vagrant-hostmanager plugin.</span>
</span><span id="__span-105-2"><a id="__codelineno-105-2" name="__codelineno-105-2" href="#__codelineno-105-2"></a><span class="c1"># For more information see https://github.com/smdahlen/vagrant-hostmanager</span>
</span><span id="__span-105-3"><a id="__codelineno-105-3" name="__codelineno-105-3" href="#__codelineno-105-3"></a><span class="c1">#</span>
</span><span id="__span-105-4"><a id="__codelineno-105-4" name="__codelineno-105-4" href="#__codelineno-105-4"></a><span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span id="__span-105-5"><a id="__codelineno-105-5" name="__codelineno-105-5" href="#__codelineno-105-5"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="no">Vagrant</span><span class="o">.</span><span class="n">has_plugin?</span><span class="p">(</span><span class="s2">&quot;vagrant-hostmanager&quot;</span><span class="p">)</span>
</span><span id="__span-105-6"><a id="__codelineno-105-6" name="__codelineno-105-6" href="#__codelineno-105-6"></a><span class="w">    </span><span class="c1"># update /ect/hosts on all running guests</span>
</span><span id="__span-105-7"><a id="__codelineno-105-7" name="__codelineno-105-7" href="#__codelineno-105-7"></a><span class="w">    </span><span class="n">config</span><span class="o">.</span><span class="n">hostmanager</span><span class="o">.</span><span class="n">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">true</span>
</span><span id="__span-105-8"><a id="__codelineno-105-8" name="__codelineno-105-8" href="#__codelineno-105-8"></a>
</span><span id="__span-105-9"><a id="__codelineno-105-9" name="__codelineno-105-9" href="#__codelineno-105-9"></a><span class="w">    </span><span class="c1"># do not add offline guests to /etc/hosts</span>
</span><span id="__span-105-10"><a id="__codelineno-105-10" name="__codelineno-105-10" href="#__codelineno-105-10"></a><span class="w">    </span><span class="n">config</span><span class="o">.</span><span class="n">hostmanager</span><span class="o">.</span><span class="n">include_offline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">false</span>
</span><span id="__span-105-11"><a id="__codelineno-105-11" name="__codelineno-105-11" href="#__codelineno-105-11"></a>
</span><span id="__span-105-12"><a id="__codelineno-105-12" name="__codelineno-105-12" href="#__codelineno-105-12"></a><span class="w">    </span><span class="c1"># use the private ip address with ip_reslover, see below</span>
</span><span id="__span-105-13"><a id="__codelineno-105-13" name="__codelineno-105-13" href="#__codelineno-105-13"></a><span class="w">    </span><span class="n">config</span><span class="o">.</span><span class="n">hostmanager</span><span class="o">.</span><span class="n">ignore_private_ip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">false</span>
</span><span id="__span-105-14"><a id="__codelineno-105-14" name="__codelineno-105-14" href="#__codelineno-105-14"></a>
</span><span id="__span-105-15"><a id="__codelineno-105-15" name="__codelineno-105-15" href="#__codelineno-105-15"></a><span class="w">    </span><span class="c1"># custom IP resolver</span>
</span><span id="__span-105-16"><a id="__codelineno-105-16" name="__codelineno-105-16" href="#__codelineno-105-16"></a><span class="w">    </span><span class="c1"># get each guest&#39;s IP address by running `hostname -I` on the guest</span>
</span><span id="__span-105-17"><a id="__codelineno-105-17" name="__codelineno-105-17" href="#__codelineno-105-17"></a><span class="w">    </span><span class="n">config</span><span class="o">.</span><span class="n">hostmanager</span><span class="o">.</span><span class="n">ip_resolver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">proc</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">vm</span><span class="p">,</span><span class="w"> </span><span class="n">resolving_vm</span><span class="o">|</span>
</span><span id="__span-105-18"><a id="__codelineno-105-18" name="__codelineno-105-18" href="#__codelineno-105-18"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="n">hostname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">vm</span><span class="o">.</span><span class="n">ssh_info</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">vm</span><span class="o">.</span><span class="n">ssh_info</span><span class="o">[</span><span class="ss">:host</span><span class="o">]</span><span class="p">)</span>
</span><span id="__span-105-19"><a id="__codelineno-105-19" name="__codelineno-105-19" href="#__codelineno-105-19"></a><span class="w">        </span><span class="sb">`vagrant ssh -c &quot;hostname -I&quot;`</span><span class="o">.</span><span class="n">split</span><span class="p">()</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
</span><span id="__span-105-20"><a id="__codelineno-105-20" name="__codelineno-105-20" href="#__codelineno-105-20"></a><span class="w">      </span><span class="k">end</span>
</span><span id="__span-105-21"><a id="__codelineno-105-21" name="__codelineno-105-21" href="#__codelineno-105-21"></a><span class="w">    </span><span class="k">end</span>
</span><span id="__span-105-22"><a id="__codelineno-105-22" name="__codelineno-105-22" href="#__codelineno-105-22"></a>
</span><span id="__span-105-23"><a id="__codelineno-105-23" name="__codelineno-105-23" href="#__codelineno-105-23"></a><span class="w">    </span><span class="c1"># also update host&#39;s /ect/hosts</span>
</span><span id="__span-105-24"><a id="__codelineno-105-24" name="__codelineno-105-24" href="#__codelineno-105-24"></a><span class="w">    </span><span class="n">config</span><span class="o">.</span><span class="n">hostmanager</span><span class="o">.</span><span class="n">manage_host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">true</span>
</span><span id="__span-105-25"><a id="__codelineno-105-25" name="__codelineno-105-25" href="#__codelineno-105-25"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-105-26"><a id="__codelineno-105-26" name="__codelineno-105-26" href="#__codelineno-105-26"></a><span class="k">end</span>
</span></code></pre></div>
<h4 id="update-kitchenyml"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#update-kitchenyml">Update <code>.kitchen.yml</code></a></h4>
<p>Update <code>.kitchen.yml</code> to include only the <code>ubuntu-14.04</code> platform for now. Also add the data bag path and Chef version. This is how it should look at the end:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-106-1"><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a><span class="nn">---</span>
</span><span id="__span-106-2"><a id="__codelineno-106-2" name="__codelineno-106-2" href="#__codelineno-106-2"></a><span class="nt">driver</span><span class="p">:</span>
</span><span id="__span-106-3"><a id="__codelineno-106-3" name="__codelineno-106-3" href="#__codelineno-106-3"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vagrant</span>
</span><span id="__span-106-4"><a id="__codelineno-106-4" name="__codelineno-106-4" href="#__codelineno-106-4"></a><span class="w">  </span><span class="nt">require_chef_omnibus</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">12.5.1</span>
</span><span id="__span-106-5"><a id="__codelineno-106-5" name="__codelineno-106-5" href="#__codelineno-106-5"></a><span class="w">  </span><span class="nt">network</span><span class="p">:</span>
</span><span id="__span-106-6"><a id="__codelineno-106-6" name="__codelineno-106-6" href="#__codelineno-106-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;private_network&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;dhcp&quot;</span><span class="p p-Indicator">}]</span>
</span><span id="__span-106-7"><a id="__codelineno-106-7" name="__codelineno-106-7" href="#__codelineno-106-7"></a><span class="w">  </span><span class="nt">vagrantfiles</span><span class="p">:</span>
</span><span id="__span-106-8"><a id="__codelineno-106-8" name="__codelineno-106-8" href="#__codelineno-106-8"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.kitchen.vagrant_cachier.rb</span>
</span><span id="__span-106-9"><a id="__codelineno-106-9" name="__codelineno-106-9" href="#__codelineno-106-9"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.kitchen.vagrant_hostmanager.rb</span>
</span><span id="__span-106-10"><a id="__codelineno-106-10" name="__codelineno-106-10" href="#__codelineno-106-10"></a>
</span><span id="__span-106-11"><a id="__codelineno-106-11" name="__codelineno-106-11" href="#__codelineno-106-11"></a><span class="nt">provisioner</span><span class="p">:</span>
</span><span id="__span-106-12"><a id="__codelineno-106-12" name="__codelineno-106-12" href="#__codelineno-106-12"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">chef_zero</span>
</span><span id="__span-106-13"><a id="__codelineno-106-13" name="__codelineno-106-13" href="#__codelineno-106-13"></a>
</span><span id="__span-106-14"><a id="__codelineno-106-14" name="__codelineno-106-14" href="#__codelineno-106-14"></a><span class="nt">platforms</span><span class="p">:</span>
</span><span id="__span-106-15"><a id="__codelineno-106-15" name="__codelineno-106-15" href="#__codelineno-106-15"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-14.04</span>
</span><span id="__span-106-16"><a id="__codelineno-106-16" name="__codelineno-106-16" href="#__codelineno-106-16"></a>
</span><span id="__span-106-17"><a id="__codelineno-106-17" name="__codelineno-106-17" href="#__codelineno-106-17"></a><span class="nt">suites</span><span class="p">:</span>
</span><span id="__span-106-18"><a id="__codelineno-106-18" name="__codelineno-106-18" href="#__codelineno-106-18"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
</span><span id="__span-106-19"><a id="__codelineno-106-19" name="__codelineno-106-19" href="#__codelineno-106-19"></a><span class="w">    </span><span class="nt">run_list</span><span class="p">:</span>
</span><span id="__span-106-20"><a id="__codelineno-106-20" name="__codelineno-106-20" href="#__codelineno-106-20"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">recipe[my_flask_server::default]</span>
</span><span id="__span-106-21"><a id="__codelineno-106-21" name="__codelineno-106-21" href="#__codelineno-106-21"></a><span class="w">    </span><span class="nt">attributes</span><span class="p">:</span>
</span></code></pre></div>
<h4 id="run-all-tests-manually"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#run-all-tests-manually">Run All Tests Manually</a></h4>
<p>Run all tests manually to verify everything works as expected. </p>
<p>First install cookbook dependencies:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-107-1"><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a><span class="n">chef</span> <span class="n">exec</span> <span class="n">berks</span> <span class="n">install</span>
</span></code></pre></div>
<p>then run the tests:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-108-1"><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a><span class="n">chef</span> <span class="n">exec</span> <span class="n">rubocop</span>
</span><span id="__span-108-2"><a id="__codelineno-108-2" name="__codelineno-108-2" href="#__codelineno-108-2"></a><span class="n">chef</span> <span class="n">exec</span> <span class="n">foodcritic</span> <span class="p">.</span>
</span><span id="__span-108-3"><a id="__codelineno-108-3" name="__codelineno-108-3" href="#__codelineno-108-3"></a><span class="n">chef</span> <span class="n">exec</span> <span class="n">rspec</span>
</span><span id="__span-108-4"><a id="__codelineno-108-4" name="__codelineno-108-4" href="#__codelineno-108-4"></a><span class="n">chef</span> <span class="n">exec</span> <span class="n">kitchen</span> <span class="n">test</span> <span class="p">-</span><span class="n">-destroy</span><span class="p">=</span><span class="n">never</span>
</span></code></pre></div>
<h3 id="setup-a-build-system"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#setup-a-build-system">Setup a Build System</a></h3>
<p>We will use <a href="http://rake.rubyforge.org/">Rake</a> to automate the build and test tasks. Rake already comes preinstalled in the ChefDK.</p>
<h4 id="create-a-rakefile"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#create-a-rakefile">Create a Rakefile</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-109-1"><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a><span class="n">touch</span> <span class="n">Rakefile</span>
</span></code></pre></div>
<p>Paste this into the <code>Rakefile</code>:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-110-1"><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a><span class="c1"># See:</span>
</span><span id="__span-110-2"><a id="__codelineno-110-2" name="__codelineno-110-2" href="#__codelineno-110-2"></a><span class="c1"># https://github.com/chef-cookbooks/chef-server/blob/master/Rakefile</span>
</span><span id="__span-110-3"><a id="__codelineno-110-3" name="__codelineno-110-3" href="#__codelineno-110-3"></a>
</span><span id="__span-110-4"><a id="__codelineno-110-4" name="__codelineno-110-4" href="#__codelineno-110-4"></a><span class="nb">require</span><span class="w"> </span><span class="s1">&#39;rspec/core/rake_task&#39;</span>
</span><span id="__span-110-5"><a id="__codelineno-110-5" name="__codelineno-110-5" href="#__codelineno-110-5"></a><span class="nb">require</span><span class="w"> </span><span class="s1">&#39;rubocop/rake_task&#39;</span>
</span><span id="__span-110-6"><a id="__codelineno-110-6" name="__codelineno-110-6" href="#__codelineno-110-6"></a><span class="nb">require</span><span class="w"> </span><span class="s1">&#39;foodcritic&#39;</span>
</span><span id="__span-110-7"><a id="__codelineno-110-7" name="__codelineno-110-7" href="#__codelineno-110-7"></a><span class="nb">require</span><span class="w"> </span><span class="s1">&#39;kitchen&#39;</span>
</span><span id="__span-110-8"><a id="__codelineno-110-8" name="__codelineno-110-8" href="#__codelineno-110-8"></a>
</span><span id="__span-110-9"><a id="__codelineno-110-9" name="__codelineno-110-9" href="#__codelineno-110-9"></a><span class="c1"># Style tests. Rubocop and Foodcritic</span>
</span><span id="__span-110-10"><a id="__codelineno-110-10" name="__codelineno-110-10" href="#__codelineno-110-10"></a><span class="n">namespace</span><span class="w"> </span><span class="ss">:style</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-110-11"><a id="__codelineno-110-11" name="__codelineno-110-11" href="#__codelineno-110-11"></a><span class="w">  </span><span class="n">desc</span><span class="w"> </span><span class="s1">&#39;Run Ruby style checks&#39;</span>
</span><span id="__span-110-12"><a id="__codelineno-110-12" name="__codelineno-110-12" href="#__codelineno-110-12"></a><span class="w">  </span><span class="no">RuboCop</span><span class="o">::</span><span class="no">RakeTask</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:ruby</span><span class="p">)</span>
</span><span id="__span-110-13"><a id="__codelineno-110-13" name="__codelineno-110-13" href="#__codelineno-110-13"></a>
</span><span id="__span-110-14"><a id="__codelineno-110-14" name="__codelineno-110-14" href="#__codelineno-110-14"></a><span class="w">  </span><span class="n">desc</span><span class="w"> </span><span class="s1">&#39;Run Chef style checks&#39;</span>
</span><span id="__span-110-15"><a id="__codelineno-110-15" name="__codelineno-110-15" href="#__codelineno-110-15"></a><span class="w">  </span><span class="no">FoodCritic</span><span class="o">::</span><span class="no">Rake</span><span class="o">::</span><span class="no">LintTask</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:chef</span><span class="p">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span id="__span-110-16"><a id="__codelineno-110-16" name="__codelineno-110-16" href="#__codelineno-110-16"></a><span class="w">    </span><span class="n">t</span><span class="o">.</span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-110-17"><a id="__codelineno-110-17" name="__codelineno-110-17" href="#__codelineno-110-17"></a><span class="w">      </span><span class="n">fail_</span><span class="c1"># categories: [&#39;any&#39;]</span>
</span><span id="__span-110-18"><a id="__codelineno-110-18" name="__codelineno-110-18" href="#__codelineno-110-18"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-110-19"><a id="__codelineno-110-19" name="__codelineno-110-19" href="#__codelineno-110-19"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-110-20"><a id="__codelineno-110-20" name="__codelineno-110-20" href="#__codelineno-110-20"></a><span class="k">end</span>
</span><span id="__span-110-21"><a id="__codelineno-110-21" name="__codelineno-110-21" href="#__codelineno-110-21"></a>
</span><span id="__span-110-22"><a id="__codelineno-110-22" name="__codelineno-110-22" href="#__codelineno-110-22"></a><span class="n">desc</span><span class="w"> </span><span class="s1">&#39;Run all style checks&#39;</span>
</span><span id="__span-110-23"><a id="__codelineno-110-23" name="__codelineno-110-23" href="#__codelineno-110-23"></a><span class="n">task</span><span class="w"> </span><span class="ss">style</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="s1">&#39;style:ruby&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;style:chef&#39;</span><span class="o">]</span>
</span><span id="__span-110-24"><a id="__codelineno-110-24" name="__codelineno-110-24" href="#__codelineno-110-24"></a>
</span><span id="__span-110-25"><a id="__codelineno-110-25" name="__codelineno-110-25" href="#__codelineno-110-25"></a><span class="c1"># Rspec and ChefSpec</span>
</span><span id="__span-110-26"><a id="__codelineno-110-26" name="__codelineno-110-26" href="#__codelineno-110-26"></a><span class="n">desc</span><span class="w"> </span><span class="s1">&#39;Run ChefSpec examples&#39;</span>
</span><span id="__span-110-27"><a id="__codelineno-110-27" name="__codelineno-110-27" href="#__codelineno-110-27"></a><span class="no">RSpec</span><span class="o">::</span><span class="no">Core</span><span class="o">::</span><span class="no">RakeTask</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:spec</span><span class="p">)</span>
</span><span id="__span-110-28"><a id="__codelineno-110-28" name="__codelineno-110-28" href="#__codelineno-110-28"></a>
</span><span id="__span-110-29"><a id="__codelineno-110-29" name="__codelineno-110-29" href="#__codelineno-110-29"></a><span class="c1"># Integration tests. Kitchen.ci</span>
</span><span id="__span-110-30"><a id="__codelineno-110-30" name="__codelineno-110-30" href="#__codelineno-110-30"></a><span class="n">namespace</span><span class="w"> </span><span class="ss">:integration</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-110-31"><a id="__codelineno-110-31" name="__codelineno-110-31" href="#__codelineno-110-31"></a><span class="w">  </span><span class="n">desc</span><span class="w"> </span><span class="s1">&#39;Same as `chef exec kitchen test -d=never`&#39;</span>
</span><span id="__span-110-32"><a id="__codelineno-110-32" name="__codelineno-110-32" href="#__codelineno-110-32"></a><span class="w">  </span><span class="n">task</span><span class="w"> </span><span class="ss">:test</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-110-33"><a id="__codelineno-110-33" name="__codelineno-110-33" href="#__codelineno-110-33"></a><span class="w">    </span><span class="no">Kitchen</span><span class="o">.</span><span class="n">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">Kitchen</span><span class="o">.</span><span class="n">default_file_logger</span>
</span><span id="__span-110-34"><a id="__codelineno-110-34" name="__codelineno-110-34" href="#__codelineno-110-34"></a><span class="w">    </span><span class="no">Kitchen</span><span class="o">::</span><span class="no">Config</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">each</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">instance</span><span class="o">|</span>
</span><span id="__span-110-35"><a id="__codelineno-110-35" name="__codelineno-110-35" href="#__codelineno-110-35"></a><span class="w">      </span><span class="n">instance</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="ss">:never</span><span class="p">)</span>
</span><span id="__span-110-36"><a id="__codelineno-110-36" name="__codelineno-110-36" href="#__codelineno-110-36"></a><span class="w">    </span><span class="k">end</span>
</span><span id="__span-110-37"><a id="__codelineno-110-37" name="__codelineno-110-37" href="#__codelineno-110-37"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-110-38"><a id="__codelineno-110-38" name="__codelineno-110-38" href="#__codelineno-110-38"></a><span class="k">end</span>
</span><span id="__span-110-39"><a id="__codelineno-110-39" name="__codelineno-110-39" href="#__codelineno-110-39"></a>
</span><span id="__span-110-40"><a id="__codelineno-110-40" name="__codelineno-110-40" href="#__codelineno-110-40"></a><span class="c1"># Default</span>
</span><span id="__span-110-41"><a id="__codelineno-110-41" name="__codelineno-110-41" href="#__codelineno-110-41"></a><span class="n">task</span><span class="w"> </span><span class="ss">default</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="s1">&#39;style&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;spec&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;integration:test&#39;</span><span class="o">]</span>
</span></code></pre></div>
<h4 id="test"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#test">Test</a></h4>
<h5 id="list-tasks"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#list-tasks">List Tasks</a></h5>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-111-1"><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a><span class="n">chef</span> <span class="n">exec</span> <span class="n">rake</span> <span class="n">-T</span>
</span></code></pre></div>
<h5 id="run-all-tests"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#run-all-tests">Run all tests</a></h5>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-112-1"><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a><span class="n">chef</span> <span class="n">exec</span> <span class="n">rake</span>
</span></code></pre></div>
<h3 id="create-application-directory"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#create-application-directory">Create Application Directory</a></h3>
<h4 id="add-an-integration-test"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#add-an-integration-test">Add an integration test</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-113-1"><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a><span class="n">touch</span> <span class="n">test</span><span class="p">/</span><span class="n">integration</span><span class="p">/</span><span class="k">default</span><span class="p">/</span><span class="n">serverspec</span><span class="p">/</span><span class="n">my_app_dir_spec</span><span class="p">.</span><span class="n">rb</span>
</span></code></pre></div>
<p>Add this code to <code>my_app_dir_spec.rb</code>:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-114-1"><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a><span class="nb">require</span><span class="w"> </span><span class="s1">&#39;spec_helper&#39;</span>
</span><span id="__span-114-2"><a id="__codelineno-114-2" name="__codelineno-114-2" href="#__codelineno-114-2"></a>
</span><span id="__span-114-3"><a id="__codelineno-114-3" name="__codelineno-114-3" href="#__codelineno-114-3"></a><span class="n">describe</span><span class="w"> </span><span class="s1">&#39;my_flask_server::my_app_dir&#39;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-114-4"><a id="__codelineno-114-4" name="__codelineno-114-4" href="#__codelineno-114-4"></a><span class="w">  </span><span class="c1"># Serverspec examples can be found at</span>
</span><span id="__span-114-5"><a id="__codelineno-114-5" name="__codelineno-114-5" href="#__codelineno-114-5"></a><span class="w">  </span><span class="c1"># http://serverspec.org/resource_types.html</span>
</span><span id="__span-114-6"><a id="__codelineno-114-6" name="__codelineno-114-6" href="#__codelineno-114-6"></a>
</span><span id="__span-114-7"><a id="__codelineno-114-7" name="__codelineno-114-7" href="#__codelineno-114-7"></a><span class="w">  </span><span class="c1"># verify virtual environment dir</span>
</span><span id="__span-114-8"><a id="__codelineno-114-8" name="__codelineno-114-8" href="#__codelineno-114-8"></a><span class="w">  </span><span class="n">describe</span><span class="w"> </span><span class="n">file</span><span class="p">(</span><span class="s1">&#39;/var/www/my_flask_app/shared/.env2&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-114-9"><a id="__codelineno-114-9" name="__codelineno-114-9" href="#__codelineno-114-9"></a><span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_directory</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-114-10"><a id="__codelineno-114-10" name="__codelineno-114-10" href="#__codelineno-114-10"></a><span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_owned_by</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-114-11"><a id="__codelineno-114-11" name="__codelineno-114-11" href="#__codelineno-114-11"></a><span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_grouped_into</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-114-12"><a id="__codelineno-114-12" name="__codelineno-114-12" href="#__codelineno-114-12"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-114-13"><a id="__codelineno-114-13" name="__codelineno-114-13" href="#__codelineno-114-13"></a>
</span><span id="__span-114-14"><a id="__codelineno-114-14" name="__codelineno-114-14" href="#__codelineno-114-14"></a><span class="w">  </span><span class="c1"># verify uwsgi dir</span>
</span><span id="__span-114-15"><a id="__codelineno-114-15" name="__codelineno-114-15" href="#__codelineno-114-15"></a><span class="w">  </span><span class="n">describe</span><span class="w"> </span><span class="n">file</span><span class="p">(</span><span class="s1">&#39;/var/www/my_flask_app/shared/.uwsgi&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-114-16"><a id="__codelineno-114-16" name="__codelineno-114-16" href="#__codelineno-114-16"></a><span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_directory</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-114-17"><a id="__codelineno-114-17" name="__codelineno-114-17" href="#__codelineno-114-17"></a><span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_owned_by</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-114-18"><a id="__codelineno-114-18" name="__codelineno-114-18" href="#__codelineno-114-18"></a><span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_grouped_into</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-114-19"><a id="__codelineno-114-19" name="__codelineno-114-19" href="#__codelineno-114-19"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-114-20"><a id="__codelineno-114-20" name="__codelineno-114-20" href="#__codelineno-114-20"></a>
</span><span id="__span-114-21"><a id="__codelineno-114-21" name="__codelineno-114-21" href="#__codelineno-114-21"></a><span class="w">  </span><span class="c1"># verify ssh dir</span>
</span><span id="__span-114-22"><a id="__codelineno-114-22" name="__codelineno-114-22" href="#__codelineno-114-22"></a><span class="w">  </span><span class="n">describe</span><span class="w"> </span><span class="n">file</span><span class="p">(</span><span class="s1">&#39;/var/www/.ssh&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-114-23"><a id="__codelineno-114-23" name="__codelineno-114-23" href="#__codelineno-114-23"></a><span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_directory</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-114-24"><a id="__codelineno-114-24" name="__codelineno-114-24" href="#__codelineno-114-24"></a><span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_owned_by</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-114-25"><a id="__codelineno-114-25" name="__codelineno-114-25" href="#__codelineno-114-25"></a><span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_grouped_into</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-114-26"><a id="__codelineno-114-26" name="__codelineno-114-26" href="#__codelineno-114-26"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-114-27"><a id="__codelineno-114-27" name="__codelineno-114-27" href="#__codelineno-114-27"></a>
</span><span id="__span-114-28"><a id="__codelineno-114-28" name="__codelineno-114-28" href="#__codelineno-114-28"></a><span class="w">  </span><span class="c1"># verify pip cache dir</span>
</span><span id="__span-114-29"><a id="__codelineno-114-29" name="__codelineno-114-29" href="#__codelineno-114-29"></a><span class="w">  </span><span class="n">describe</span><span class="w"> </span><span class="n">file</span><span class="p">(</span><span class="s1">&#39;/var/www/.cache&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-114-30"><a id="__codelineno-114-30" name="__codelineno-114-30" href="#__codelineno-114-30"></a><span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_directory</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-114-31"><a id="__codelineno-114-31" name="__codelineno-114-31" href="#__codelineno-114-31"></a><span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_owned_by</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-114-32"><a id="__codelineno-114-32" name="__codelineno-114-32" href="#__codelineno-114-32"></a><span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_grouped_into</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-114-33"><a id="__codelineno-114-33" name="__codelineno-114-33" href="#__codelineno-114-33"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-114-34"><a id="__codelineno-114-34" name="__codelineno-114-34" href="#__codelineno-114-34"></a><span class="k">end</span>
</span></code></pre></div>
<h4 id="write-the-my_app_dir-recipe"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#write-the-my_app_dir-recipe">Write the <code>my_app_dir</code> recipe</a></h4>
<p>The first step is to create the recipe file, <code>my_app_dir.rb</code>. Run the following command to generate it:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-115-1"><a id="__codelineno-115-1" name="__codelineno-115-1" href="#__codelineno-115-1"></a><span class="n">chef</span> <span class="n">generate</span> <span class="n">recipe</span> <span class="n">my_app_dir</span>
</span><span id="__span-115-2"><a id="__codelineno-115-2" name="__codelineno-115-2" href="#__codelineno-115-2"></a><span class="nb">rm </span><span class="n">spec</span><span class="p">/</span><span class="n">unit</span><span class="p">/</span><span class="n">recipes</span><span class="p">/</span><span class="n">my_app_dir_spec</span><span class="p">.</span><span class="n">rb</span>
</span></code></pre></div>
<p>Write out <code>recipes/my_app_dir.rb</code> like this:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-116-1"><a id="__codelineno-116-1" name="__codelineno-116-1" href="#__codelineno-116-1"></a><span class="c1">#</span>
</span><span id="__span-116-2"><a id="__codelineno-116-2" name="__codelineno-116-2" href="#__codelineno-116-2"></a><span class="c1"># Cookbook Name:: my_flask_server</span>
</span><span id="__span-116-3"><a id="__codelineno-116-3" name="__codelineno-116-3" href="#__codelineno-116-3"></a><span class="c1"># Recipe:: my_app_dir</span>
</span><span id="__span-116-4"><a id="__codelineno-116-4" name="__codelineno-116-4" href="#__codelineno-116-4"></a><span class="c1">#</span>
</span><span id="__span-116-5"><a id="__codelineno-116-5" name="__codelineno-116-5" href="#__codelineno-116-5"></a><span class="c1"># Copyright (c) 2016 The Authors, All Rights Reserved.</span>
</span><span id="__span-116-6"><a id="__codelineno-116-6" name="__codelineno-116-6" href="#__codelineno-116-6"></a>
</span><span id="__span-116-7"><a id="__codelineno-116-7" name="__codelineno-116-7" href="#__codelineno-116-7"></a><span class="c1"># app root directory</span>
</span><span id="__span-116-8"><a id="__codelineno-116-8" name="__codelineno-116-8" href="#__codelineno-116-8"></a><span class="n">directory</span><span class="w"> </span><span class="s1">&#39;/var/www/my_flask_app&#39;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-116-9"><a id="__codelineno-116-9" name="__codelineno-116-9" href="#__codelineno-116-9"></a><span class="w">  </span><span class="n">action</span><span class="w"> </span><span class="ss">:create</span>
</span><span id="__span-116-10"><a id="__codelineno-116-10" name="__codelineno-116-10" href="#__codelineno-116-10"></a><span class="w">  </span><span class="n">recursive</span><span class="w"> </span><span class="kp">true</span>
</span><span id="__span-116-11"><a id="__codelineno-116-11" name="__codelineno-116-11" href="#__codelineno-116-11"></a><span class="w">  </span><span class="n">user</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span>
</span><span id="__span-116-12"><a id="__codelineno-116-12" name="__codelineno-116-12" href="#__codelineno-116-12"></a><span class="w">  </span><span class="n">group</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span>
</span><span id="__span-116-13"><a id="__codelineno-116-13" name="__codelineno-116-13" href="#__codelineno-116-13"></a><span class="k">end</span>
</span><span id="__span-116-14"><a id="__codelineno-116-14" name="__codelineno-116-14" href="#__codelineno-116-14"></a>
</span><span id="__span-116-15"><a id="__codelineno-116-15" name="__codelineno-116-15" href="#__codelineno-116-15"></a><span class="c1"># app shared directory</span>
</span><span id="__span-116-16"><a id="__codelineno-116-16" name="__codelineno-116-16" href="#__codelineno-116-16"></a><span class="n">directory</span><span class="w"> </span><span class="s1">&#39;/var/www/my_flask_app/shared&#39;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-116-17"><a id="__codelineno-116-17" name="__codelineno-116-17" href="#__codelineno-116-17"></a><span class="w">  </span><span class="n">action</span><span class="w"> </span><span class="ss">:create</span>
</span><span id="__span-116-18"><a id="__codelineno-116-18" name="__codelineno-116-18" href="#__codelineno-116-18"></a><span class="w">  </span><span class="n">user</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span>
</span><span id="__span-116-19"><a id="__codelineno-116-19" name="__codelineno-116-19" href="#__codelineno-116-19"></a><span class="w">  </span><span class="n">group</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span>
</span><span id="__span-116-20"><a id="__codelineno-116-20" name="__codelineno-116-20" href="#__codelineno-116-20"></a><span class="k">end</span>
</span><span id="__span-116-21"><a id="__codelineno-116-21" name="__codelineno-116-21" href="#__codelineno-116-21"></a>
</span><span id="__span-116-22"><a id="__codelineno-116-22" name="__codelineno-116-22" href="#__codelineno-116-22"></a><span class="c1"># for virtualenv</span>
</span><span id="__span-116-23"><a id="__codelineno-116-23" name="__codelineno-116-23" href="#__codelineno-116-23"></a><span class="n">directory</span><span class="w"> </span><span class="s1">&#39;/var/www/my_flask_app/shared/.env2&#39;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-116-24"><a id="__codelineno-116-24" name="__codelineno-116-24" href="#__codelineno-116-24"></a><span class="w">  </span><span class="n">action</span><span class="w"> </span><span class="ss">:create</span>
</span><span id="__span-116-25"><a id="__codelineno-116-25" name="__codelineno-116-25" href="#__codelineno-116-25"></a><span class="w">  </span><span class="n">user</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span>
</span><span id="__span-116-26"><a id="__codelineno-116-26" name="__codelineno-116-26" href="#__codelineno-116-26"></a><span class="w">  </span><span class="n">group</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span>
</span><span id="__span-116-27"><a id="__codelineno-116-27" name="__codelineno-116-27" href="#__codelineno-116-27"></a><span class="k">end</span>
</span><span id="__span-116-28"><a id="__codelineno-116-28" name="__codelineno-116-28" href="#__codelineno-116-28"></a>
</span><span id="__span-116-29"><a id="__codelineno-116-29" name="__codelineno-116-29" href="#__codelineno-116-29"></a><span class="c1"># for uwsgi socket and uwsgi config</span>
</span><span id="__span-116-30"><a id="__codelineno-116-30" name="__codelineno-116-30" href="#__codelineno-116-30"></a><span class="n">directory</span><span class="w"> </span><span class="s1">&#39;/var/www/my_flask_app/shared/.uwsgi&#39;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-116-31"><a id="__codelineno-116-31" name="__codelineno-116-31" href="#__codelineno-116-31"></a><span class="w">  </span><span class="n">action</span><span class="w"> </span><span class="ss">:create</span>
</span><span id="__span-116-32"><a id="__codelineno-116-32" name="__codelineno-116-32" href="#__codelineno-116-32"></a><span class="w">  </span><span class="n">user</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span>
</span><span id="__span-116-33"><a id="__codelineno-116-33" name="__codelineno-116-33" href="#__codelineno-116-33"></a><span class="w">  </span><span class="n">group</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span>
</span><span id="__span-116-34"><a id="__codelineno-116-34" name="__codelineno-116-34" href="#__codelineno-116-34"></a><span class="k">end</span>
</span><span id="__span-116-35"><a id="__codelineno-116-35" name="__codelineno-116-35" href="#__codelineno-116-35"></a>
</span><span id="__span-116-36"><a id="__codelineno-116-36" name="__codelineno-116-36" href="#__codelineno-116-36"></a><span class="c1"># required by ssh</span>
</span><span id="__span-116-37"><a id="__codelineno-116-37" name="__codelineno-116-37" href="#__codelineno-116-37"></a><span class="n">directory</span><span class="w"> </span><span class="s1">&#39;/var/www/.ssh&#39;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-116-38"><a id="__codelineno-116-38" name="__codelineno-116-38" href="#__codelineno-116-38"></a><span class="w">  </span><span class="n">action</span><span class="w"> </span><span class="ss">:create</span>
</span><span id="__span-116-39"><a id="__codelineno-116-39" name="__codelineno-116-39" href="#__codelineno-116-39"></a><span class="w">  </span><span class="n">recursive</span><span class="w"> </span><span class="kp">true</span>
</span><span id="__span-116-40"><a id="__codelineno-116-40" name="__codelineno-116-40" href="#__codelineno-116-40"></a><span class="w">  </span><span class="n">user</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span>
</span><span id="__span-116-41"><a id="__codelineno-116-41" name="__codelineno-116-41" href="#__codelineno-116-41"></a><span class="w">  </span><span class="n">group</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span>
</span><span id="__span-116-42"><a id="__codelineno-116-42" name="__codelineno-116-42" href="#__codelineno-116-42"></a><span class="k">end</span>
</span><span id="__span-116-43"><a id="__codelineno-116-43" name="__codelineno-116-43" href="#__codelineno-116-43"></a>
</span><span id="__span-116-44"><a id="__codelineno-116-44" name="__codelineno-116-44" href="#__codelineno-116-44"></a><span class="c1"># required by pip</span>
</span><span id="__span-116-45"><a id="__codelineno-116-45" name="__codelineno-116-45" href="#__codelineno-116-45"></a><span class="n">directory</span><span class="w"> </span><span class="s1">&#39;/var/www/.cache&#39;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-116-46"><a id="__codelineno-116-46" name="__codelineno-116-46" href="#__codelineno-116-46"></a><span class="w">  </span><span class="n">action</span><span class="w"> </span><span class="ss">:create</span>
</span><span id="__span-116-47"><a id="__codelineno-116-47" name="__codelineno-116-47" href="#__codelineno-116-47"></a><span class="w">  </span><span class="n">recursive</span><span class="w"> </span><span class="kp">true</span>
</span><span id="__span-116-48"><a id="__codelineno-116-48" name="__codelineno-116-48" href="#__codelineno-116-48"></a><span class="w">  </span><span class="n">user</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span>
</span><span id="__span-116-49"><a id="__codelineno-116-49" name="__codelineno-116-49" href="#__codelineno-116-49"></a><span class="w">  </span><span class="n">group</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span>
</span><span id="__span-116-50"><a id="__codelineno-116-50" name="__codelineno-116-50" href="#__codelineno-116-50"></a><span class="k">end</span>
</span></code></pre></div>
<h4 id="set-the-my_app_dirrb-recipe-to-run"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#set-the-my_app_dirrb-recipe-to-run">Set the <code>my_app_dir.rb</code> recipe to run</a></h4>
<p>Add this line to <code>recipes/default.rb</code>:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-117-1"><a id="__codelineno-117-1" name="__codelineno-117-1" href="#__codelineno-117-1"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;my_flask_server::my_app_dir&#39;</span>
</span></code></pre></div>
<p>Here is the complete file:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-118-1"><a id="__codelineno-118-1" name="__codelineno-118-1" href="#__codelineno-118-1"></a><span class="c1">#</span>
</span><span id="__span-118-2"><a id="__codelineno-118-2" name="__codelineno-118-2" href="#__codelineno-118-2"></a><span class="c1"># Cookbook Name:: my_flask_server</span>
</span><span id="__span-118-3"><a id="__codelineno-118-3" name="__codelineno-118-3" href="#__codelineno-118-3"></a><span class="c1"># Recipe:: default</span>
</span><span id="__span-118-4"><a id="__codelineno-118-4" name="__codelineno-118-4" href="#__codelineno-118-4"></a><span class="c1">#</span>
</span><span id="__span-118-5"><a id="__codelineno-118-5" name="__codelineno-118-5" href="#__codelineno-118-5"></a><span class="c1"># Copyright (c) 2016 The Authors, All Rights Reserved.</span>
</span><span id="__span-118-6"><a id="__codelineno-118-6" name="__codelineno-118-6" href="#__codelineno-118-6"></a>
</span><span id="__span-118-7"><a id="__codelineno-118-7" name="__codelineno-118-7" href="#__codelineno-118-7"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;apt::default&#39;</span>
</span><span id="__span-118-8"><a id="__codelineno-118-8" name="__codelineno-118-8" href="#__codelineno-118-8"></a>
</span><span id="__span-118-9"><a id="__codelineno-118-9" name="__codelineno-118-9" href="#__codelineno-118-9"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;my_flask_server::my_app_dir&#39;</span>
</span></code></pre></div>
<h4 id="run-all-tests_1"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#run-all-tests_1">Run all tests</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-119-1"><a id="__codelineno-119-1" name="__codelineno-119-1" href="#__codelineno-119-1"></a><span class="n">chef</span> <span class="n">exec</span> <span class="n">rake</span>
</span></code></pre></div>
<h3 id="install-python"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#install-python">Install Python</a></h3>
<h4 id="add-an-integration-test_1"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#add-an-integration-test_1">Add an integration test</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-120-1"><a id="__codelineno-120-1" name="__codelineno-120-1" href="#__codelineno-120-1"></a><span class="n">touch</span> <span class="n">test</span><span class="p">/</span><span class="n">integration</span><span class="p">/</span><span class="k">default</span><span class="p">/</span><span class="n">serverspec</span><span class="p">/</span><span class="n">my_app_python_spec</span><span class="p">.</span><span class="n">rb</span>
</span></code></pre></div>
<p>Add this code to <code>my_app_python_spec.rb</code>:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-121-1"><a id="__codelineno-121-1" name="__codelineno-121-1" href="#__codelineno-121-1"></a><span class="nb">require</span><span class="w"> </span><span class="s1">&#39;spec_helper&#39;</span>
</span><span id="__span-121-2"><a id="__codelineno-121-2" name="__codelineno-121-2" href="#__codelineno-121-2"></a>
</span><span id="__span-121-3"><a id="__codelineno-121-3" name="__codelineno-121-3" href="#__codelineno-121-3"></a><span class="n">describe</span><span class="w"> </span><span class="s1">&#39;my_flask_server::my_app_python&#39;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-121-4"><a id="__codelineno-121-4" name="__codelineno-121-4" href="#__codelineno-121-4"></a><span class="w">  </span><span class="c1"># Serverspec examples can be found at</span>
</span><span id="__span-121-5"><a id="__codelineno-121-5" name="__codelineno-121-5" href="#__codelineno-121-5"></a><span class="w">  </span><span class="c1"># http://serverspec.org/resource_types.html</span>
</span><span id="__span-121-6"><a id="__codelineno-121-6" name="__codelineno-121-6" href="#__codelineno-121-6"></a>
</span><span id="__span-121-7"><a id="__codelineno-121-7" name="__codelineno-121-7" href="#__codelineno-121-7"></a><span class="w">  </span><span class="c1"># verify system python</span>
</span><span id="__span-121-8"><a id="__codelineno-121-8" name="__codelineno-121-8" href="#__codelineno-121-8"></a><span class="w">  </span><span class="n">describe</span><span class="w"> </span><span class="n">package</span><span class="p">(</span><span class="s1">&#39;python&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-121-9"><a id="__codelineno-121-9" name="__codelineno-121-9" href="#__codelineno-121-9"></a><span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_installed</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-121-10"><a id="__codelineno-121-10" name="__codelineno-121-10" href="#__codelineno-121-10"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-121-11"><a id="__codelineno-121-11" name="__codelineno-121-11" href="#__codelineno-121-11"></a>
</span><span id="__span-121-12"><a id="__codelineno-121-12" name="__codelineno-121-12" href="#__codelineno-121-12"></a><span class="w">  </span><span class="c1"># verify system pip</span>
</span><span id="__span-121-13"><a id="__codelineno-121-13" name="__codelineno-121-13" href="#__codelineno-121-13"></a><span class="w">  </span><span class="n">describe</span><span class="w"> </span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;which pip&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-121-14"><a id="__codelineno-121-14" name="__codelineno-121-14" href="#__codelineno-121-14"></a><span class="w">    </span><span class="n">its</span><span class="p">(</span><span class="ss">:stdout</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">contain</span><span class="w"> </span><span class="s1">&#39;/usr/local/bin/pip&#39;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-121-15"><a id="__codelineno-121-15" name="__codelineno-121-15" href="#__codelineno-121-15"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-121-16"><a id="__codelineno-121-16" name="__codelineno-121-16" href="#__codelineno-121-16"></a>
</span><span id="__span-121-17"><a id="__codelineno-121-17" name="__codelineno-121-17" href="#__codelineno-121-17"></a><span class="w">  </span><span class="c1"># verify system setuptools</span>
</span><span id="__span-121-18"><a id="__codelineno-121-18" name="__codelineno-121-18" href="#__codelineno-121-18"></a><span class="w">  </span><span class="n">describe</span><span class="w"> </span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;which easy_install&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-121-19"><a id="__codelineno-121-19" name="__codelineno-121-19" href="#__codelineno-121-19"></a><span class="w">    </span><span class="n">its</span><span class="p">(</span><span class="ss">:stdout</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">contain</span><span class="w"> </span><span class="s1">&#39;/usr/local/bin/easy_install&#39;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-121-20"><a id="__codelineno-121-20" name="__codelineno-121-20" href="#__codelineno-121-20"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-121-21"><a id="__codelineno-121-21" name="__codelineno-121-21" href="#__codelineno-121-21"></a>
</span><span id="__span-121-22"><a id="__codelineno-121-22" name="__codelineno-121-22" href="#__codelineno-121-22"></a><span class="w">  </span><span class="c1"># verify system virtualenv</span>
</span><span id="__span-121-23"><a id="__codelineno-121-23" name="__codelineno-121-23" href="#__codelineno-121-23"></a><span class="w">  </span><span class="n">describe</span><span class="w"> </span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;which virtualenv&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-121-24"><a id="__codelineno-121-24" name="__codelineno-121-24" href="#__codelineno-121-24"></a><span class="w">    </span><span class="n">its</span><span class="p">(</span><span class="ss">:stdout</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">contain</span><span class="w"> </span><span class="s1">&#39;/usr/local/bin/virtualenv&#39;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-121-25"><a id="__codelineno-121-25" name="__codelineno-121-25" href="#__codelineno-121-25"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-121-26"><a id="__codelineno-121-26" name="__codelineno-121-26" href="#__codelineno-121-26"></a>
</span><span id="__span-121-27"><a id="__codelineno-121-27" name="__codelineno-121-27" href="#__codelineno-121-27"></a><span class="w">  </span><span class="c1"># verify my_flask_app virtual environment</span>
</span><span id="__span-121-28"><a id="__codelineno-121-28" name="__codelineno-121-28" href="#__codelineno-121-28"></a><span class="w">  </span><span class="c1"># See `helpers/serverspec/type/virtualenv.rb`</span>
</span><span id="__span-121-29"><a id="__codelineno-121-29" name="__codelineno-121-29" href="#__codelineno-121-29"></a><span class="w">  </span><span class="n">describe</span><span class="w"> </span><span class="n">virtualenv</span><span class="p">(</span><span class="s1">&#39;/var/www/my_flask_app/shared/.env2&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-121-30"><a id="__codelineno-121-30" name="__codelineno-121-30" href="#__codelineno-121-30"></a><span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_virtualenv</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-121-31"><a id="__codelineno-121-31" name="__codelineno-121-31" href="#__codelineno-121-31"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-121-32"><a id="__codelineno-121-32" name="__codelineno-121-32" href="#__codelineno-121-32"></a><span class="k">end</span>
</span></code></pre></div>
<h4 id="create-virtualenv-serverspec-type"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#create-virtualenv-serverspec-type">Create <code>virtualenv</code> serverspec type</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-122-1"><a id="__codelineno-122-1" name="__codelineno-122-1" href="#__codelineno-122-1"></a><span class="n">mkdir</span> <span class="n">test</span><span class="p">/</span><span class="n">integration</span><span class="p">/</span><span class="n">helpers</span><span class="p">/</span><span class="n">serverspec</span><span class="p">/</span><span class="nb">type</span>
</span><span id="__span-122-2"><a id="__codelineno-122-2" name="__codelineno-122-2" href="#__codelineno-122-2"></a><span class="n">touch</span> <span class="n">test</span><span class="p">/</span><span class="n">integration</span><span class="p">/</span><span class="n">helpers</span><span class="p">/</span><span class="n">serverspec</span><span class="p">/</span><span class="n">type</span><span class="p">/</span><span class="n">virtualenv</span><span class="p">.</span><span class="n">rb</span>
</span></code></pre></div>
<p>Paste this code into <code>virtualenv.rb</code>:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-123-1"><a id="__codelineno-123-1" name="__codelineno-123-1" href="#__codelineno-123-1"></a><span class="c1">##############################################################################</span>
</span><span id="__span-123-2"><a id="__codelineno-123-2" name="__codelineno-123-2" href="#__codelineno-123-2"></a><span class="c1"># You can find the original code at:</span>
</span><span id="__span-123-3"><a id="__codelineno-123-3" name="__codelineno-123-3" href="#__codelineno-123-3"></a><span class="c1"># &lt;https://github.com/jantman/serverspec-extended-types&gt;</span>
</span><span id="__span-123-4"><a id="__codelineno-123-4" name="__codelineno-123-4" href="#__codelineno-123-4"></a><span class="c1"># Licensed under the MIT License</span>
</span><span id="__span-123-5"><a id="__codelineno-123-5" name="__codelineno-123-5" href="#__codelineno-123-5"></a><span class="c1">##############################################################################</span>
</span><span id="__span-123-6"><a id="__codelineno-123-6" name="__codelineno-123-6" href="#__codelineno-123-6"></a>
</span><span id="__span-123-7"><a id="__codelineno-123-7" name="__codelineno-123-7" href="#__codelineno-123-7"></a><span class="c1"># Serverspec</span>
</span><span id="__span-123-8"><a id="__codelineno-123-8" name="__codelineno-123-8" href="#__codelineno-123-8"></a><span class="k">module</span><span class="w"> </span><span class="nn">Serverspec</span>
</span><span id="__span-123-9"><a id="__codelineno-123-9" name="__codelineno-123-9" href="#__codelineno-123-9"></a><span class="w">  </span><span class="c1"># Type</span>
</span><span id="__span-123-10"><a id="__codelineno-123-10" name="__codelineno-123-10" href="#__codelineno-123-10"></a><span class="w">  </span><span class="k">module</span><span class="w"> </span><span class="nn">Type</span>
</span><span id="__span-123-11"><a id="__codelineno-123-11" name="__codelineno-123-11" href="#__codelineno-123-11"></a><span class="w">    </span><span class="c1"># Virtualenv</span>
</span><span id="__span-123-12"><a id="__codelineno-123-12" name="__codelineno-123-12" href="#__codelineno-123-12"></a><span class="w">    </span><span class="k">class</span><span class="w"> </span><span class="nc">Virtualenv</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="no">Base</span>
</span><span id="__span-123-13"><a id="__codelineno-123-13" name="__codelineno-123-13" href="#__codelineno-123-13"></a><span class="w">      </span><span class="c1"># Test whether this appears to be a working venv</span>
</span><span id="__span-123-14"><a id="__codelineno-123-14" name="__codelineno-123-14" href="#__codelineno-123-14"></a><span class="w">      </span><span class="c1">#</span>
</span><span id="__span-123-15"><a id="__codelineno-123-15" name="__codelineno-123-15" href="#__codelineno-123-15"></a><span class="w">      </span><span class="c1"># Tests performed:</span>
</span><span id="__span-123-16"><a id="__codelineno-123-16" name="__codelineno-123-16" href="#__codelineno-123-16"></a><span class="w">      </span><span class="c1"># - venv_path/bin/pip executable by owner?</span>
</span><span id="__span-123-17"><a id="__codelineno-123-17" name="__codelineno-123-17" href="#__codelineno-123-17"></a><span class="w">      </span><span class="c1"># - venv_path/bin/python executable by owner?</span>
</span><span id="__span-123-18"><a id="__codelineno-123-18" name="__codelineno-123-18" href="#__codelineno-123-18"></a><span class="w">      </span><span class="c1"># - venv_path/bin/activate readable by owner?</span>
</span><span id="__span-123-19"><a id="__codelineno-123-19" name="__codelineno-123-19" href="#__codelineno-123-19"></a><span class="w">      </span><span class="c1"># - &#39;export VIRTUAL_ENV&#39; in venv_path/bin/activate?</span>
</span><span id="__span-123-20"><a id="__codelineno-123-20" name="__codelineno-123-20" href="#__codelineno-123-20"></a><span class="w">      </span><span class="c1">#</span>
</span><span id="__span-123-21"><a id="__codelineno-123-21" name="__codelineno-123-21" href="#__codelineno-123-21"></a><span class="w">      </span><span class="c1"># @example</span>
</span><span id="__span-123-22"><a id="__codelineno-123-22" name="__codelineno-123-22" href="#__codelineno-123-22"></a><span class="w">      </span><span class="c1">#   describe virtualenv(&#39;/path/to/venv&#39;) do</span>
</span><span id="__span-123-23"><a id="__codelineno-123-23" name="__codelineno-123-23" href="#__codelineno-123-23"></a><span class="w">      </span><span class="c1">#     it { should be_virtualenv }</span>
</span><span id="__span-123-24"><a id="__codelineno-123-24" name="__codelineno-123-24" href="#__codelineno-123-24"></a><span class="w">      </span><span class="c1">#   end</span>
</span><span id="__span-123-25"><a id="__codelineno-123-25" name="__codelineno-123-25" href="#__codelineno-123-25"></a><span class="w">      </span><span class="c1">#</span>
</span><span id="__span-123-26"><a id="__codelineno-123-26" name="__codelineno-123-26" href="#__codelineno-123-26"></a><span class="w">      </span><span class="c1"># @api public</span>
</span><span id="__span-123-27"><a id="__codelineno-123-27" name="__codelineno-123-27" href="#__codelineno-123-27"></a><span class="w">      </span><span class="c1"># @return [Boolean]</span>
</span><span id="__span-123-28"><a id="__codelineno-123-28" name="__codelineno-123-28" href="#__codelineno-123-28"></a><span class="w">      </span><span class="k">def</span><span class="w"> </span><span class="nf">virtualenv?</span>
</span><span id="__span-123-29"><a id="__codelineno-123-29" name="__codelineno-123-29" href="#__codelineno-123-29"></a><span class="w">        </span><span class="n">pip_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="vi">@name</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;bin&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;pip&#39;</span><span class="p">)</span>
</span><span id="__span-123-30"><a id="__codelineno-123-30" name="__codelineno-123-30" href="#__codelineno-123-30"></a><span class="w">        </span><span class="n">python_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="vi">@name</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;bin&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;python&#39;</span><span class="p">)</span>
</span><span id="__span-123-31"><a id="__codelineno-123-31" name="__codelineno-123-31" href="#__codelineno-123-31"></a><span class="w">        </span><span class="n">act_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="vi">@name</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;bin&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;activate&#39;</span><span class="p">)</span>
</span><span id="__span-123-32"><a id="__codelineno-123-32" name="__codelineno-123-32" href="#__codelineno-123-32"></a><span class="w">        </span><span class="n">cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;grep -q &#39;export VIRTUAL_ENV&#39; </span><span class="si">#{</span><span class="n">act_path</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-123-33"><a id="__codelineno-123-33" name="__codelineno-123-33" href="#__codelineno-123-33"></a>
</span><span id="__span-123-34"><a id="__codelineno-123-34" name="__codelineno-123-34" href="#__codelineno-123-34"></a><span class="w">        </span><span class="vi">@runner</span><span class="o">.</span><span class="n">check_file_is_executable</span><span class="p">(</span><span class="n">pip_path</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;owner&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span>
</span><span id="__span-123-35"><a id="__codelineno-123-35" name="__codelineno-123-35" href="#__codelineno-123-35"></a><span class="w">          </span><span class="vi">@runner</span><span class="o">.</span><span class="n">check_file_is_executable</span><span class="p">(</span><span class="n">python_path</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;owner&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span>
</span><span id="__span-123-36"><a id="__codelineno-123-36" name="__codelineno-123-36" href="#__codelineno-123-36"></a><span class="w">          </span><span class="vi">@runner</span><span class="o">.</span><span class="n">check_file_is_readable</span><span class="p">(</span><span class="n">act_path</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;owner&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span>
</span><span id="__span-123-37"><a id="__codelineno-123-37" name="__codelineno-123-37" href="#__codelineno-123-37"></a><span class="w">          </span><span class="vi">@runner</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span><span class="o">.</span><span class="n">exit_status</span><span class="o">.</span><span class="n">to_i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-123-38"><a id="__codelineno-123-38" name="__codelineno-123-38" href="#__codelineno-123-38"></a><span class="w">      </span><span class="k">end</span>
</span><span id="__span-123-39"><a id="__codelineno-123-39" name="__codelineno-123-39" href="#__codelineno-123-39"></a><span class="w">    </span><span class="k">end</span>
</span><span id="__span-123-40"><a id="__codelineno-123-40" name="__codelineno-123-40" href="#__codelineno-123-40"></a>
</span><span id="__span-123-41"><a id="__codelineno-123-41" name="__codelineno-123-41" href="#__codelineno-123-41"></a><span class="w">    </span><span class="c1"># Serverspec Type wrapper method for Serverspec::Type::Virtualenv</span>
</span><span id="__span-123-42"><a id="__codelineno-123-42" name="__codelineno-123-42" href="#__codelineno-123-42"></a><span class="w">    </span><span class="c1">#</span>
</span><span id="__span-123-43"><a id="__codelineno-123-43" name="__codelineno-123-43" href="#__codelineno-123-43"></a><span class="w">    </span><span class="c1"># @example</span>
</span><span id="__span-123-44"><a id="__codelineno-123-44" name="__codelineno-123-44" href="#__codelineno-123-44"></a><span class="w">    </span><span class="c1">#   describe virtualenv(&#39;/path/to/venv&#39;) do</span>
</span><span id="__span-123-45"><a id="__codelineno-123-45" name="__codelineno-123-45" href="#__codelineno-123-45"></a><span class="w">    </span><span class="c1">#     # tests here</span>
</span><span id="__span-123-46"><a id="__codelineno-123-46" name="__codelineno-123-46" href="#__codelineno-123-46"></a><span class="w">    </span><span class="c1">#   end</span>
</span><span id="__span-123-47"><a id="__codelineno-123-47" name="__codelineno-123-47" href="#__codelineno-123-47"></a><span class="w">    </span><span class="c1">#</span>
</span><span id="__span-123-48"><a id="__codelineno-123-48" name="__codelineno-123-48" href="#__codelineno-123-48"></a><span class="w">    </span><span class="c1"># @param name [String] the absolute path to the virtualenv root</span>
</span><span id="__span-123-49"><a id="__codelineno-123-49" name="__codelineno-123-49" href="#__codelineno-123-49"></a><span class="w">    </span><span class="c1">#</span>
</span><span id="__span-123-50"><a id="__codelineno-123-50" name="__codelineno-123-50" href="#__codelineno-123-50"></a><span class="w">    </span><span class="c1"># @api public</span>
</span><span id="__span-123-51"><a id="__codelineno-123-51" name="__codelineno-123-51" href="#__codelineno-123-51"></a><span class="w">    </span><span class="c1"># @return {Serverspec::Type::Virtualenv}</span>
</span><span id="__span-123-52"><a id="__codelineno-123-52" name="__codelineno-123-52" href="#__codelineno-123-52"></a><span class="w">    </span><span class="k">def</span><span class="w"> </span><span class="nf">virtualenv</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
</span><span id="__span-123-53"><a id="__codelineno-123-53" name="__codelineno-123-53" href="#__codelineno-123-53"></a><span class="w">      </span><span class="no">Virtualenv</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
</span><span id="__span-123-54"><a id="__codelineno-123-54" name="__codelineno-123-54" href="#__codelineno-123-54"></a><span class="w">    </span><span class="k">end</span>
</span><span id="__span-123-55"><a id="__codelineno-123-55" name="__codelineno-123-55" href="#__codelineno-123-55"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-123-56"><a id="__codelineno-123-56" name="__codelineno-123-56" href="#__codelineno-123-56"></a><span class="k">end</span>
</span><span id="__span-123-57"><a id="__codelineno-123-57" name="__codelineno-123-57" href="#__codelineno-123-57"></a>
</span><span id="__span-123-58"><a id="__codelineno-123-58" name="__codelineno-123-58" href="#__codelineno-123-58"></a><span class="kp">include</span><span class="w"> </span><span class="no">Serverspec</span><span class="o">::</span><span class="no">Type</span>
</span></code></pre></div>
<p>Add this line to <code>test/integration/helpers/serverspec/spec_helper.rb</code>:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-124-1"><a id="__codelineno-124-1" name="__codelineno-124-1" href="#__codelineno-124-1"></a><span class="nb">require</span><span class="w"> </span><span class="s1">&#39;type/virtualenv&#39;</span>
</span></code></pre></div>
<h4 id="reference-the-poise-python-cookbook"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#reference-the-poise-python-cookbook">Reference the <code>poise-python</code> cookbook</a></h4>
<p>Add this line to <code>metadata.rb</code>:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-125-1"><a id="__codelineno-125-1" name="__codelineno-125-1" href="#__codelineno-125-1"></a><span class="n">depends</span><span class="w"> </span><span class="s1">&#39;poise-python&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;~&gt; 1.2.1&#39;</span>
</span></code></pre></div>
<p>To get the latest version string, run <code>knife cookbook site show nginx</code>: </p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-126-1"><a id="__codelineno-126-1" name="__codelineno-126-1" href="#__codelineno-126-1"></a><span class="n">chef</span> <span class="n">exec</span> <span class="n">knife</span> <span class="n">cookbook</span> <span class="n">site</span> <span class="n">show</span> <span class="n">poise-python</span> <span class="p">|</span> <span class="n">grep</span> <span class="n">latest_version</span>
</span><span id="__span-126-2"><a id="__codelineno-126-2" name="__codelineno-126-2" href="#__codelineno-126-2"></a><span class="n">latest_version</span><span class="p">:</span>     <span class="n">https</span><span class="p">://</span><span class="n">supermarket</span><span class="p">.</span><span class="n">chef</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">api</span><span class="p">/</span><span class="n">v1</span><span class="p">/</span><span class="n">cookbooks</span><span class="p">/</span><span class="n">poise-python</span><span class="p">/</span><span class="n">versions</span><span class="p">/</span><span class="n">1</span><span class="p">.</span><span class="n">2</span><span class="p">.</span><span class="n">1</span>
</span></code></pre></div>
<p>Here is the complete file:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-127-1"><a id="__codelineno-127-1" name="__codelineno-127-1" href="#__codelineno-127-1"></a><span class="nb">name</span><span class="w"> </span><span class="s1">&#39;my_flask_server&#39;</span>
</span><span id="__span-127-2"><a id="__codelineno-127-2" name="__codelineno-127-2" href="#__codelineno-127-2"></a><span class="n">maintainer</span><span class="w"> </span><span class="s1">&#39;The Authors&#39;</span>
</span><span id="__span-127-3"><a id="__codelineno-127-3" name="__codelineno-127-3" href="#__codelineno-127-3"></a><span class="n">maintainer_email</span><span class="w"> </span><span class="s1">&#39;you@example.com&#39;</span>
</span><span id="__span-127-4"><a id="__codelineno-127-4" name="__codelineno-127-4" href="#__codelineno-127-4"></a><span class="n">license</span><span class="w"> </span><span class="s1">&#39;all_rights&#39;</span>
</span><span id="__span-127-5"><a id="__codelineno-127-5" name="__codelineno-127-5" href="#__codelineno-127-5"></a><span class="n">description</span><span class="w"> </span><span class="s1">&#39;Installs/Configures my_flask_server&#39;</span>
</span><span id="__span-127-6"><a id="__codelineno-127-6" name="__codelineno-127-6" href="#__codelineno-127-6"></a><span class="n">long_description</span><span class="w"> </span><span class="s1">&#39;Installs/Configures my_flask_server&#39;</span>
</span><span id="__span-127-7"><a id="__codelineno-127-7" name="__codelineno-127-7" href="#__codelineno-127-7"></a><span class="n">version</span><span class="w"> </span><span class="s1">&#39;0.1.0&#39;</span>
</span><span id="__span-127-8"><a id="__codelineno-127-8" name="__codelineno-127-8" href="#__codelineno-127-8"></a>
</span><span id="__span-127-9"><a id="__codelineno-127-9" name="__codelineno-127-9" href="#__codelineno-127-9"></a><span class="n">depends</span><span class="w"> </span><span class="s1">&#39;apt&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;~&gt; 2.9.2&#39;</span>
</span><span id="__span-127-10"><a id="__codelineno-127-10" name="__codelineno-127-10" href="#__codelineno-127-10"></a><span class="n">depends</span><span class="w"> </span><span class="s1">&#39;poise-python&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;~&gt; 1.2.1&#39;</span>
</span></code></pre></div>
<h4 id="write-the-my_app_python-recipe"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#write-the-my_app_python-recipe">Write the <code>my_app_python</code> recipe</a></h4>
<p>The first step is to create the recipe file, <code>my_app_python.rb</code>. Run the following command to generate it:</p>
<p><div class="language-powershell highlight"><pre><span></span><code><span id="__span-128-1"><a id="__codelineno-128-1" name="__codelineno-128-1" href="#__codelineno-128-1"></a><span class="n">chef</span> <span class="n">generate</span> <span class="n">recipe</span> <span class="n">my_app_python</span>
</span><span id="__span-128-2"><a id="__codelineno-128-2" name="__codelineno-128-2" href="#__codelineno-128-2"></a><span class="nb">rm </span><span class="n">spec</span><span class="p">/</span><span class="n">unit</span><span class="p">/</span><span class="n">recipes</span><span class="p">/</span><span class="n">my_app_python_spec</span><span class="p">.</span><span class="n">rb</span>
</span></code></pre></div>
Write out <code>recipes/my_app_python.rb</code> like this:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-129-1"><a id="__codelineno-129-1" name="__codelineno-129-1" href="#__codelineno-129-1"></a><span class="c1">#</span>
</span><span id="__span-129-2"><a id="__codelineno-129-2" name="__codelineno-129-2" href="#__codelineno-129-2"></a><span class="c1"># Cookbook Name:: my_flask_server</span>
</span><span id="__span-129-3"><a id="__codelineno-129-3" name="__codelineno-129-3" href="#__codelineno-129-3"></a><span class="c1"># Recipe:: my_python</span>
</span><span id="__span-129-4"><a id="__codelineno-129-4" name="__codelineno-129-4" href="#__codelineno-129-4"></a><span class="c1">#</span>
</span><span id="__span-129-5"><a id="__codelineno-129-5" name="__codelineno-129-5" href="#__codelineno-129-5"></a><span class="c1"># Copyright (c) 2016 The Authors, All Rights Reserved.</span>
</span><span id="__span-129-6"><a id="__codelineno-129-6" name="__codelineno-129-6" href="#__codelineno-129-6"></a>
</span><span id="__span-129-7"><a id="__codelineno-129-7" name="__codelineno-129-7" href="#__codelineno-129-7"></a><span class="c1"># See https://supermarket.chef.io/cookbooks/poise-python</span>
</span><span id="__span-129-8"><a id="__codelineno-129-8" name="__codelineno-129-8" href="#__codelineno-129-8"></a>
</span><span id="__span-129-9"><a id="__codelineno-129-9" name="__codelineno-129-9" href="#__codelineno-129-9"></a><span class="c1"># install python 2</span>
</span><span id="__span-129-10"><a id="__codelineno-129-10" name="__codelineno-129-10" href="#__codelineno-129-10"></a><span class="n">python_runtime</span><span class="w"> </span><span class="s1">&#39;python_2&#39;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-129-11"><a id="__codelineno-129-11" name="__codelineno-129-11" href="#__codelineno-129-11"></a><span class="w">  </span><span class="n">version</span><span class="w"> </span><span class="s1">&#39;2&#39;</span>
</span><span id="__span-129-12"><a id="__codelineno-129-12" name="__codelineno-129-12" href="#__codelineno-129-12"></a><span class="k">end</span>
</span><span id="__span-129-13"><a id="__codelineno-129-13" name="__codelineno-129-13" href="#__codelineno-129-13"></a>
</span><span id="__span-129-14"><a id="__codelineno-129-14" name="__codelineno-129-14" href="#__codelineno-129-14"></a><span class="c1"># create my_flask_app virtual environment</span>
</span><span id="__span-129-15"><a id="__codelineno-129-15" name="__codelineno-129-15" href="#__codelineno-129-15"></a><span class="n">python_virtualenv</span><span class="w"> </span><span class="s1">&#39;my_flask_app_env&#39;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-129-16"><a id="__codelineno-129-16" name="__codelineno-129-16" href="#__codelineno-129-16"></a><span class="w">  </span><span class="n">path</span><span class="w"> </span><span class="s1">&#39;/var/www/my_flask_app/shared/.env2&#39;</span>
</span><span id="__span-129-17"><a id="__codelineno-129-17" name="__codelineno-129-17" href="#__codelineno-129-17"></a><span class="w">  </span><span class="n">python</span><span class="w"> </span><span class="s1">&#39;python_2&#39;</span>
</span><span id="__span-129-18"><a id="__codelineno-129-18" name="__codelineno-129-18" href="#__codelineno-129-18"></a><span class="w">  </span><span class="n">user</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span>
</span><span id="__span-129-19"><a id="__codelineno-129-19" name="__codelineno-129-19" href="#__codelineno-129-19"></a><span class="w">  </span><span class="n">group</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span>
</span><span id="__span-129-20"><a id="__codelineno-129-20" name="__codelineno-129-20" href="#__codelineno-129-20"></a><span class="k">end</span>
</span></code></pre></div>
<h4 id="set-the-my_app_python-recipe-to-run"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#set-the-my_app_python-recipe-to-run">Set the <code>my_app_python</code> recipe to run</a></h4>
<p>Add this line to <code>recipes/default.rb</code>:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-130-1"><a id="__codelineno-130-1" name="__codelineno-130-1" href="#__codelineno-130-1"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;my_flask_server::my_app_python&#39;</span>
</span></code></pre></div>
<p>Here is the complete file:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-131-1"><a id="__codelineno-131-1" name="__codelineno-131-1" href="#__codelineno-131-1"></a><span class="c1">#</span>
</span><span id="__span-131-2"><a id="__codelineno-131-2" name="__codelineno-131-2" href="#__codelineno-131-2"></a><span class="c1"># Cookbook Name:: my_flask_server</span>
</span><span id="__span-131-3"><a id="__codelineno-131-3" name="__codelineno-131-3" href="#__codelineno-131-3"></a><span class="c1"># Recipe:: default</span>
</span><span id="__span-131-4"><a id="__codelineno-131-4" name="__codelineno-131-4" href="#__codelineno-131-4"></a><span class="c1">#</span>
</span><span id="__span-131-5"><a id="__codelineno-131-5" name="__codelineno-131-5" href="#__codelineno-131-5"></a><span class="c1"># Copyright (c) 2016 The Authors, All Rights Reserved.</span>
</span><span id="__span-131-6"><a id="__codelineno-131-6" name="__codelineno-131-6" href="#__codelineno-131-6"></a>
</span><span id="__span-131-7"><a id="__codelineno-131-7" name="__codelineno-131-7" href="#__codelineno-131-7"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;apt::default&#39;</span>
</span><span id="__span-131-8"><a id="__codelineno-131-8" name="__codelineno-131-8" href="#__codelineno-131-8"></a>
</span><span id="__span-131-9"><a id="__codelineno-131-9" name="__codelineno-131-9" href="#__codelineno-131-9"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;my_flask_server::my_app_dir&#39;</span>
</span><span id="__span-131-10"><a id="__codelineno-131-10" name="__codelineno-131-10" href="#__codelineno-131-10"></a>
</span><span id="__span-131-11"><a id="__codelineno-131-11" name="__codelineno-131-11" href="#__codelineno-131-11"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;my_flask_server::my_app_python&#39;</span>
</span></code></pre></div>
<h4 id="run-all-tests_2"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#run-all-tests_2">Run all tests</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-132-1"><a id="__codelineno-132-1" name="__codelineno-132-1" href="#__codelineno-132-1"></a><span class="n">chef</span> <span class="n">exec</span> <span class="n">rake</span>
</span></code></pre></div>
<h3 id="install-ssh-key"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#install-ssh-key">Install SSH Key</a></h3>
<h4 id="update-kitchenyml_1"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#update-kitchenyml_1">Update <code>.kitchen.yml</code></a></h4>
<p>Add this code to <code>.kitchen.yml</code> under <code>provisioner</code>: </p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-133-1"><a id="__codelineno-133-1" name="__codelineno-133-1" href="#__codelineno-133-1"></a><span class="w">    </span><span class="nt">data_bags_path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;./data_bags&quot;</span>
</span><span id="__span-133-2"><a id="__codelineno-133-2" name="__codelineno-133-2" href="#__codelineno-133-2"></a><span class="w">    </span><span class="nt">encrypted_data_bag_secret_key_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;%= ENV[&#39;CHEF_DATA_BAG_SECRET&#39;] %&gt;</span>
</span></code></pre></div>
<p>Here is the complete file:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-134-1"><a id="__codelineno-134-1" name="__codelineno-134-1" href="#__codelineno-134-1"></a><span class="nn">---</span>
</span><span id="__span-134-2"><a id="__codelineno-134-2" name="__codelineno-134-2" href="#__codelineno-134-2"></a><span class="nt">driver</span><span class="p">:</span>
</span><span id="__span-134-3"><a id="__codelineno-134-3" name="__codelineno-134-3" href="#__codelineno-134-3"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vagrant</span>
</span><span id="__span-134-4"><a id="__codelineno-134-4" name="__codelineno-134-4" href="#__codelineno-134-4"></a><span class="w">  </span><span class="nt">require_chef_omnibus</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">12.5.1</span>
</span><span id="__span-134-5"><a id="__codelineno-134-5" name="__codelineno-134-5" href="#__codelineno-134-5"></a><span class="w">  </span><span class="nt">network</span><span class="p">:</span>
</span><span id="__span-134-6"><a id="__codelineno-134-6" name="__codelineno-134-6" href="#__codelineno-134-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;private_network&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;dhcp&quot;</span><span class="p p-Indicator">}]</span>
</span><span id="__span-134-7"><a id="__codelineno-134-7" name="__codelineno-134-7" href="#__codelineno-134-7"></a><span class="w">  </span><span class="nt">vagrantfiles</span><span class="p">:</span>
</span><span id="__span-134-8"><a id="__codelineno-134-8" name="__codelineno-134-8" href="#__codelineno-134-8"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.kitchen.vagrant_cachier.rb</span>
</span><span id="__span-134-9"><a id="__codelineno-134-9" name="__codelineno-134-9" href="#__codelineno-134-9"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.kitchen.vagrant_hostmanager.rb</span>
</span><span id="__span-134-10"><a id="__codelineno-134-10" name="__codelineno-134-10" href="#__codelineno-134-10"></a>
</span><span id="__span-134-11"><a id="__codelineno-134-11" name="__codelineno-134-11" href="#__codelineno-134-11"></a><span class="nt">provisioner</span><span class="p">:</span>
</span><span id="__span-134-12"><a id="__codelineno-134-12" name="__codelineno-134-12" href="#__codelineno-134-12"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">chef_zero</span>
</span><span id="__span-134-13"><a id="__codelineno-134-13" name="__codelineno-134-13" href="#__codelineno-134-13"></a><span class="w">  </span><span class="nt">data_bags_path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;./data_bags&quot;</span>
</span><span id="__span-134-14"><a id="__codelineno-134-14" name="__codelineno-134-14" href="#__codelineno-134-14"></a><span class="w">  </span><span class="nt">encrypted_data_bag_secret_key_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;%= ENV[&#39;CHEF_DATA_BAG_SECRET&#39;] %&gt;</span>
</span><span id="__span-134-15"><a id="__codelineno-134-15" name="__codelineno-134-15" href="#__codelineno-134-15"></a>
</span><span id="__span-134-16"><a id="__codelineno-134-16" name="__codelineno-134-16" href="#__codelineno-134-16"></a><span class="nt">platforms</span><span class="p">:</span>
</span><span id="__span-134-17"><a id="__codelineno-134-17" name="__codelineno-134-17" href="#__codelineno-134-17"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-14.04</span>
</span><span id="__span-134-18"><a id="__codelineno-134-18" name="__codelineno-134-18" href="#__codelineno-134-18"></a>
</span><span id="__span-134-19"><a id="__codelineno-134-19" name="__codelineno-134-19" href="#__codelineno-134-19"></a><span class="nt">suites</span><span class="p">:</span>
</span><span id="__span-134-20"><a id="__codelineno-134-20" name="__codelineno-134-20" href="#__codelineno-134-20"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
</span><span id="__span-134-21"><a id="__codelineno-134-21" name="__codelineno-134-21" href="#__codelineno-134-21"></a><span class="w">    </span><span class="nt">run_list</span><span class="p">:</span>
</span><span id="__span-134-22"><a id="__codelineno-134-22" name="__codelineno-134-22" href="#__codelineno-134-22"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">recipe[my_flask_server::default]</span>
</span><span id="__span-134-23"><a id="__codelineno-134-23" name="__codelineno-134-23" href="#__codelineno-134-23"></a><span class="w">    </span><span class="nt">attributes</span><span class="p">:</span>
</span></code></pre></div>
<h4 id="generate-a-data-bag-secret"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#generate-a-data-bag-secret">Generate a Data Bag Secret</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-135-1"><a id="__codelineno-135-1" name="__codelineno-135-1" href="#__codelineno-135-1"></a><span class="n">mkdir</span> <span class="p">~/.</span><span class="n">chef</span>
</span></code></pre></div>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-136-1"><a id="__codelineno-136-1" name="__codelineno-136-1" href="#__codelineno-136-1"></a><span class="nv">$key</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">byte</span><span class="p">[](</span><span class="n">512</span><span class="p">)</span>
</span><span id="__span-136-2"><a id="__codelineno-136-2" name="__codelineno-136-2" href="#__codelineno-136-2"></a><span class="nv">$rng</span> <span class="p">=</span> <span class="no">[System.Security.Cryptography.RNGCryptoServiceProvider]</span><span class="p">::</span><span class="n">Create</span><span class="p">().</span><span class="n">GetBytes</span><span class="p">(</span><span class="nv">$key</span><span class="p">)</span>
</span><span id="__span-136-3"><a id="__codelineno-136-3" name="__codelineno-136-3" href="#__codelineno-136-3"></a><span class="no">[Convert]</span><span class="p">::</span><span class="n">ToBase64String</span><span class="p">(</span><span class="nv">$key</span><span class="p">)</span> <span class="p">|</span> <span class="nb">Out-File</span> <span class="s2">&quot;~/.chef/chef_data_bag_secret&quot;</span> <span class="n">-encoding</span> <span class="s2">&quot;UTF8&quot;</span>
</span><span id="__span-136-4"><a id="__codelineno-136-4" name="__codelineno-136-4" href="#__codelineno-136-4"></a><span class="no">[array]</span><span class="p">::</span><span class="n">Clear</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="n">0</span><span class="p">,</span> <span class="nv">$key</span><span class="p">.</span><span class="n">Length</span><span class="p">)</span>
</span></code></pre></div>
<p>This key will be used to encrypt sensitive cookbook information like SSH private keys. Make sure you store a copy of the <code>~/.chef/chef_data_bag_secret</code> file in a secure location.</p>
<h5 id="create-environment-variable"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#create-environment-variable">Create Environment Variable</a></h5>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-137-1"><a id="__codelineno-137-1" name="__codelineno-137-1" href="#__codelineno-137-1"></a><span class="nv">$chef_secret</span> <span class="p">=</span> <span class="p">(</span><span class="nb">rvpa </span><span class="s1">&#39;~/.chef/chef_data_bag_secret&#39;</span><span class="p">).</span><span class="n">Path</span>
</span><span id="__span-137-2"><a id="__codelineno-137-2" name="__codelineno-137-2" href="#__codelineno-137-2"></a><span class="nv">$env:CHEF_DATA_BAG_SECRET</span> <span class="p">=</span> <span class="nv">$chef_secret</span>
</span><span id="__span-137-3"><a id="__codelineno-137-3" name="__codelineno-137-3" href="#__codelineno-137-3"></a><span class="no">[Environment]</span><span class="p">::</span><span class="n">SetEnvironmentVariable</span><span class="p">(</span><span class="s2">&quot;CHEF_DATA_BAG_SECRET&quot;</span><span class="p">,</span> <span class="nv">$chef_secret</span><span class="p">,</span> <span class="s2">&quot;User&quot;</span><span class="p">)</span>
</span></code></pre></div>
<h4 id="generate-ssh-key"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#generate-ssh-key">Generate SSH Key</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-138-1"><a id="__codelineno-138-1" name="__codelineno-138-1" href="#__codelineno-138-1"></a><span class="n">mkdir</span> <span class="p">~/.</span><span class="n">ssh</span>
</span></code></pre></div>
<p>Make sure you use an empty passphrase.</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-139-1"><a id="__codelineno-139-1" name="__codelineno-139-1" href="#__codelineno-139-1"></a><span class="nb">pushd</span>
</span><span id="__span-139-2"><a id="__codelineno-139-2" name="__codelineno-139-2" href="#__codelineno-139-2"></a><span class="nb">cd </span><span class="p">~/.</span><span class="n">ssh</span>
</span><span id="__span-139-3"><a id="__codelineno-139-3" name="__codelineno-139-3" href="#__codelineno-139-3"></a><span class="n">ssh-keygen</span> <span class="o">-f</span> <span class="n">id_my_flask_app_deploy</span>
</span><span id="__span-139-4"><a id="__codelineno-139-4" name="__codelineno-139-4" href="#__codelineno-139-4"></a><span class="nb">popd </span>
</span></code></pre></div>
<p>If you have an existing key with a passphrase, remove the passphrase from a private key using code similar to:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-140-1"><a id="__codelineno-140-1" name="__codelineno-140-1" href="#__codelineno-140-1"></a><span class="n">ssh-keygen</span> <span class="n">-p</span> <span class="n">-P</span> <span class="s1">&#39;PASSPHRASE&#39;</span> <span class="n">-N</span> <span class="s1">&#39;&#39;</span> <span class="o">-f</span> <span class="n">id_deploy</span>
</span></code></pre></div>
<h5 id="add-the-ssh-key-to-bitbucket"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#add-the-ssh-key-to-bitbucket">Add the SSH key to Bitbucket</a></h5>
<p>We will use Bitbucket to host the source code of our test application. Go ahead and fork the <a href="https://bitbucket.org/vkantchev/my_flask_app/src">my_flask_app</a> repository. </p>
<p>Then add the public part of the SSH key, <code>~/.ssh/id_my_flask_app_deploy.pub</code>, to your Bitbucket fork. See <a href="https://confluence.atlassian.com/bitbucket/use-deployment-keys-294486051.html">Use deployment keys</a> for more details. </p>
<h4 id="create-data-bag-item"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#create-data-bag-item">Create Data Bag Item</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-141-1"><a id="__codelineno-141-1" name="__codelineno-141-1" href="#__codelineno-141-1"></a><span class="nv">$json</span> <span class="p">=</span> <span class="sh">@&quot;</span>
</span><span id="__span-141-2"><a id="__codelineno-141-2" name="__codelineno-141-2" href="#__codelineno-141-2"></a><span class="sh">{</span>
</span><span id="__span-141-3"><a id="__codelineno-141-3" name="__codelineno-141-3" href="#__codelineno-141-3"></a><span class="sh">    &quot;id&quot; : &quot;my_flask_app&quot;,</span>
</span><span id="__span-141-4"><a id="__codelineno-141-4" name="__codelineno-141-4" href="#__codelineno-141-4"></a><span class="sh">    &quot;deploy_key&quot; : &quot;&lt;key&gt;&quot;</span>
</span><span id="__span-141-5"><a id="__codelineno-141-5" name="__codelineno-141-5" href="#__codelineno-141-5"></a><span class="sh">}</span>
</span><span id="__span-141-6"><a id="__codelineno-141-6" name="__codelineno-141-6" href="#__codelineno-141-6"></a><span class="sh">&quot;@</span>
</span><span id="__span-141-7"><a id="__codelineno-141-7" name="__codelineno-141-7" href="#__codelineno-141-7"></a><span class="nv">$json</span> <span class="p">=</span> <span class="nv">$json</span> <span class="o">-replace</span> <span class="s2">&quot;&lt;key&gt;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="no">[io.file]</span><span class="p">::</span><span class="n">ReadAllText</span><span class="p">(</span><span class="s2">&quot;.ssh/id_my_flask_app_deploy&quot;</span><span class="p">).</span><span class="n">Replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">`n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;\n&quot;</span><span class="p">)</span> <span class="p">+</span> <span class="s2">&quot;\n&quot;</span><span class="p">)</span>
</span><span id="__span-141-8"><a id="__codelineno-141-8" name="__codelineno-141-8" href="#__codelineno-141-8"></a><span class="no">[io.file]</span><span class="p">::</span><span class="n">WriteAllText</span><span class="p">(</span><span class="s2">&quot;.chef/my_flask_app.json&quot;</span><span class="p">,</span> <span class="nv">$json</span><span class="p">)</span>
</span></code></pre></div>
<h4 id="encrypt-data-bag-item"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#encrypt-data-bag-item">Encrypt Data Bag Item</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-142-1"><a id="__codelineno-142-1" name="__codelineno-142-1" href="#__codelineno-142-1"></a><span class="n">mkdir</span> <span class="p">./</span><span class="n">data_bags</span><span class="p">/</span><span class="n">secrets</span>
</span><span id="__span-142-2"><a id="__codelineno-142-2" name="__codelineno-142-2" href="#__codelineno-142-2"></a>
</span><span id="__span-142-3"><a id="__codelineno-142-3" name="__codelineno-142-3" href="#__codelineno-142-3"></a><span class="n">chef</span> <span class="n">exec</span> <span class="n">knife</span> <span class="n">data</span> <span class="n">bag</span> <span class="n">from</span> <span class="n">file</span> <span class="n">secrets</span> <span class="p">~/.</span><span class="n">chef</span><span class="p">/</span><span class="n">my_flask_app</span><span class="p">.</span><span class="n">json</span> <span class="n">-z</span> <span class="p">-</span><span class="n">-secret</span><span class="o">-file</span> <span class="p">(</span><span class="nb">rvpa </span><span class="p">~/.</span><span class="n">chef</span><span class="p">/</span><span class="n">chef_data_bag_secret</span><span class="p">).</span><span class="n">Path</span>
</span></code></pre></div>
<h4 id="create-ssh-wrapper-script"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#create-ssh-wrapper-script">Create SSH Wrapper Script</a></h4>
<p>Create <code>files/default/wrap-ssh4git.sh</code> file:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-143-1"><a id="__codelineno-143-1" name="__codelineno-143-1" href="#__codelineno-143-1"></a><span class="n">chef</span> <span class="n">generate</span> <span class="n">file</span> <span class="n">wrap-ssh</span><span class="p">-</span><span class="n">4-git</span><span class="p">.</span><span class="n">sh</span>
</span></code></pre></div>
<p>Add this content to the <code>files/default/wrap-ssh-4-git.sh</code>:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-144-1"><a id="__codelineno-144-1" name="__codelineno-144-1" href="#__codelineno-144-1"></a><span class="ch">#!/bin/bash</span>
</span><span id="__span-144-2"><a id="__codelineno-144-2" name="__codelineno-144-2" href="#__codelineno-144-2"></a>ssh<span class="w"> </span>-o<span class="w"> </span><span class="s2">&quot;StrictHostKeyChecking=no&quot;</span><span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;/tmp/my_flask_app/ssh/id_my_flask_app_deploy&quot;</span><span class="w"> </span><span class="nv">$1</span><span class="w"> </span><span class="nv">$2</span>
</span></code></pre></div>
<p>IMPORTANT: Make sure the file uses Unix Line Ending (\n, LF) and UTF-8 encoding. Otherwise you may get weird errors when Chef client runs the script during deployment.</p>
<h4 id="add-an-integration-test_2"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#add-an-integration-test_2">Add an integration test</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-145-1"><a id="__codelineno-145-1" name="__codelineno-145-1" href="#__codelineno-145-1"></a><span class="n">touch</span> <span class="n">test</span><span class="p">/</span><span class="n">integration</span><span class="p">/</span><span class="k">default</span><span class="p">/</span><span class="n">serverspec</span><span class="p">/</span><span class="n">my_app_ssh_spec</span><span class="p">.</span><span class="n">rb</span>
</span></code></pre></div>
<p>Add this code to <code>my_app_ssh_spec.rb</code>:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-146-1"><a id="__codelineno-146-1" name="__codelineno-146-1" href="#__codelineno-146-1"></a><span class="nb">require</span><span class="w"> </span><span class="s1">&#39;spec_helper&#39;</span>
</span><span id="__span-146-2"><a id="__codelineno-146-2" name="__codelineno-146-2" href="#__codelineno-146-2"></a>
</span><span id="__span-146-3"><a id="__codelineno-146-3" name="__codelineno-146-3" href="#__codelineno-146-3"></a><span class="n">describe</span><span class="w"> </span><span class="s1">&#39;my_flask_server::my_app_ssh&#39;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-146-4"><a id="__codelineno-146-4" name="__codelineno-146-4" href="#__codelineno-146-4"></a><span class="w">  </span><span class="c1"># Serverspec examples can be found at</span>
</span><span id="__span-146-5"><a id="__codelineno-146-5" name="__codelineno-146-5" href="#__codelineno-146-5"></a><span class="w">  </span><span class="c1"># http://serverspec.org/resource_types.html</span>
</span><span id="__span-146-6"><a id="__codelineno-146-6" name="__codelineno-146-6" href="#__codelineno-146-6"></a>
</span><span id="__span-146-7"><a id="__codelineno-146-7" name="__codelineno-146-7" href="#__codelineno-146-7"></a><span class="w">  </span><span class="n">describe</span><span class="w"> </span><span class="n">file</span><span class="p">(</span><span class="s1">&#39;/tmp/my_flask_app/ssh/wrap-ssh-4-git.sh&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-146-8"><a id="__codelineno-146-8" name="__codelineno-146-8" href="#__codelineno-146-8"></a><span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_file</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-146-9"><a id="__codelineno-146-9" name="__codelineno-146-9" href="#__codelineno-146-9"></a><span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_mode</span><span class="w"> </span><span class="s1">&#39;755&#39;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-146-10"><a id="__codelineno-146-10" name="__codelineno-146-10" href="#__codelineno-146-10"></a><span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_owned_by</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-146-11"><a id="__codelineno-146-11" name="__codelineno-146-11" href="#__codelineno-146-11"></a><span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_grouped_into</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-146-12"><a id="__codelineno-146-12" name="__codelineno-146-12" href="#__codelineno-146-12"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-146-13"><a id="__codelineno-146-13" name="__codelineno-146-13" href="#__codelineno-146-13"></a>
</span><span id="__span-146-14"><a id="__codelineno-146-14" name="__codelineno-146-14" href="#__codelineno-146-14"></a><span class="w">  </span><span class="n">describe</span><span class="w"> </span><span class="n">file</span><span class="p">(</span><span class="s1">&#39;/tmp/my_flask_app/ssh/id_my_flask_app_deploy&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-146-15"><a id="__codelineno-146-15" name="__codelineno-146-15" href="#__codelineno-146-15"></a><span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_file</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-146-16"><a id="__codelineno-146-16" name="__codelineno-146-16" href="#__codelineno-146-16"></a><span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_mode</span><span class="w"> </span><span class="s1">&#39;600&#39;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-146-17"><a id="__codelineno-146-17" name="__codelineno-146-17" href="#__codelineno-146-17"></a><span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_owned_by</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-146-18"><a id="__codelineno-146-18" name="__codelineno-146-18" href="#__codelineno-146-18"></a><span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_grouped_into</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-146-19"><a id="__codelineno-146-19" name="__codelineno-146-19" href="#__codelineno-146-19"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-146-20"><a id="__codelineno-146-20" name="__codelineno-146-20" href="#__codelineno-146-20"></a><span class="k">end</span>
</span></code></pre></div>
<h4 id="write-the-my_app_ssh-recipe"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#write-the-my_app_ssh-recipe">Write the <code>my_app_ssh</code> recipe</a></h4>
<p>The first step is to create the recipe file, <code>my_app_ssh.rb</code>. Run the following command to generate it:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-147-1"><a id="__codelineno-147-1" name="__codelineno-147-1" href="#__codelineno-147-1"></a><span class="n">chef</span> <span class="n">generate</span> <span class="n">recipe</span> <span class="n">my_app_ssh</span>
</span><span id="__span-147-2"><a id="__codelineno-147-2" name="__codelineno-147-2" href="#__codelineno-147-2"></a><span class="nb">rm </span><span class="n">spec</span><span class="p">/</span><span class="n">unit</span><span class="p">/</span><span class="n">recipes</span><span class="p">/</span><span class="n">my_app_ssh_spec</span><span class="p">.</span><span class="n">rb</span>
</span></code></pre></div>
<p>Write out <code>recipes/my_app_ssh.rb</code> like this:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-148-1"><a id="__codelineno-148-1" name="__codelineno-148-1" href="#__codelineno-148-1"></a><span class="c1">#</span>
</span><span id="__span-148-2"><a id="__codelineno-148-2" name="__codelineno-148-2" href="#__codelineno-148-2"></a><span class="c1"># Cookbook Name:: my_flask_server</span>
</span><span id="__span-148-3"><a id="__codelineno-148-3" name="__codelineno-148-3" href="#__codelineno-148-3"></a><span class="c1"># Recipe:: my_app_ssh</span>
</span><span id="__span-148-4"><a id="__codelineno-148-4" name="__codelineno-148-4" href="#__codelineno-148-4"></a><span class="c1">#</span>
</span><span id="__span-148-5"><a id="__codelineno-148-5" name="__codelineno-148-5" href="#__codelineno-148-5"></a><span class="c1"># Copyright (c) 2016 The Authors, All Rights Reserved.</span>
</span><span id="__span-148-6"><a id="__codelineno-148-6" name="__codelineno-148-6" href="#__codelineno-148-6"></a>
</span><span id="__span-148-7"><a id="__codelineno-148-7" name="__codelineno-148-7" href="#__codelineno-148-7"></a><span class="n">directory</span><span class="w"> </span><span class="s1">&#39;/tmp/my_flask_app/ssh&#39;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-148-8"><a id="__codelineno-148-8" name="__codelineno-148-8" href="#__codelineno-148-8"></a><span class="w">  </span><span class="n">recursive</span><span class="w"> </span><span class="kp">true</span>
</span><span id="__span-148-9"><a id="__codelineno-148-9" name="__codelineno-148-9" href="#__codelineno-148-9"></a><span class="w">  </span><span class="n">user</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span>
</span><span id="__span-148-10"><a id="__codelineno-148-10" name="__codelineno-148-10" href="#__codelineno-148-10"></a><span class="w">  </span><span class="n">group</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span>
</span><span id="__span-148-11"><a id="__codelineno-148-11" name="__codelineno-148-11" href="#__codelineno-148-11"></a><span class="k">end</span>
</span><span id="__span-148-12"><a id="__codelineno-148-12" name="__codelineno-148-12" href="#__codelineno-148-12"></a>
</span><span id="__span-148-13"><a id="__codelineno-148-13" name="__codelineno-148-13" href="#__codelineno-148-13"></a><span class="c1"># copy git ssh wrapper</span>
</span><span id="__span-148-14"><a id="__codelineno-148-14" name="__codelineno-148-14" href="#__codelineno-148-14"></a><span class="n">cookbook_file</span><span class="w"> </span><span class="s1">&#39;/tmp/my_flask_app/ssh/wrap-ssh-4-git.sh&#39;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-148-15"><a id="__codelineno-148-15" name="__codelineno-148-15" href="#__codelineno-148-15"></a><span class="w">  </span><span class="n">source</span><span class="w"> </span><span class="s1">&#39;wrap-ssh-4-git.sh&#39;</span>
</span><span id="__span-148-16"><a id="__codelineno-148-16" name="__codelineno-148-16" href="#__codelineno-148-16"></a><span class="w">  </span><span class="n">mode</span><span class="w"> </span><span class="mo">0755</span>
</span><span id="__span-148-17"><a id="__codelineno-148-17" name="__codelineno-148-17" href="#__codelineno-148-17"></a><span class="w">  </span><span class="n">user</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span>
</span><span id="__span-148-18"><a id="__codelineno-148-18" name="__codelineno-148-18" href="#__codelineno-148-18"></a><span class="w">  </span><span class="n">group</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span>
</span><span id="__span-148-19"><a id="__codelineno-148-19" name="__codelineno-148-19" href="#__codelineno-148-19"></a><span class="k">end</span>
</span><span id="__span-148-20"><a id="__codelineno-148-20" name="__codelineno-148-20" href="#__codelineno-148-20"></a>
</span><span id="__span-148-21"><a id="__codelineno-148-21" name="__codelineno-148-21" href="#__codelineno-148-21"></a><span class="c1"># decrypt the private ssh key</span>
</span><span id="__span-148-22"><a id="__codelineno-148-22" name="__codelineno-148-22" href="#__codelineno-148-22"></a><span class="n">my_flask_app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">Chef</span><span class="o">::</span><span class="no">EncryptedDataBagItem</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;secrets&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;my_flask_app&#39;</span><span class="p">)</span>
</span><span id="__span-148-23"><a id="__codelineno-148-23" name="__codelineno-148-23" href="#__codelineno-148-23"></a>
</span><span id="__span-148-24"><a id="__codelineno-148-24" name="__codelineno-148-24" href="#__codelineno-148-24"></a><span class="k">if</span><span class="w"> </span><span class="n">my_flask_app</span><span class="o">[</span><span class="s1">&#39;deploy_key&#39;</span><span class="o">]</span>
</span><span id="__span-148-25"><a id="__codelineno-148-25" name="__codelineno-148-25" href="#__codelineno-148-25"></a><span class="w">  </span><span class="n">ruby_block</span><span class="w"> </span><span class="s1">&#39;decrypt `id_my_flask_app_deploy` private ssh key&#39;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-148-26"><a id="__codelineno-148-26" name="__codelineno-148-26" href="#__codelineno-148-26"></a><span class="w">    </span><span class="n">block</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-148-27"><a id="__codelineno-148-27" name="__codelineno-148-27" href="#__codelineno-148-27"></a><span class="w">      </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;/tmp/my_flask_app/ssh/id_my_flask_app_deploy&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
</span><span id="__span-148-28"><a id="__codelineno-148-28" name="__codelineno-148-28" href="#__codelineno-148-28"></a><span class="w">      </span><span class="n">f</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">my_flask_app</span><span class="o">[</span><span class="s1">&#39;deploy_key&#39;</span><span class="o">]</span><span class="p">)</span>
</span><span id="__span-148-29"><a id="__codelineno-148-29" name="__codelineno-148-29" href="#__codelineno-148-29"></a><span class="w">      </span><span class="n">f</span><span class="o">.</span><span class="n">close</span>
</span><span id="__span-148-30"><a id="__codelineno-148-30" name="__codelineno-148-30" href="#__codelineno-148-30"></a><span class="w">    </span><span class="k">end</span>
</span><span id="__span-148-31"><a id="__codelineno-148-31" name="__codelineno-148-31" href="#__codelineno-148-31"></a>
</span><span id="__span-148-32"><a id="__codelineno-148-32" name="__codelineno-148-32" href="#__codelineno-148-32"></a><span class="w">    </span><span class="n">not_if</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-148-33"><a id="__codelineno-148-33" name="__codelineno-148-33" href="#__codelineno-148-33"></a><span class="w">      </span><span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="s1">&#39;/tmp/my_flask_app/ssh/id_my_flask_app_deploy&#39;</span><span class="p">)</span>
</span><span id="__span-148-34"><a id="__codelineno-148-34" name="__codelineno-148-34" href="#__codelineno-148-34"></a><span class="w">    </span><span class="k">end</span>
</span><span id="__span-148-35"><a id="__codelineno-148-35" name="__codelineno-148-35" href="#__codelineno-148-35"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-148-36"><a id="__codelineno-148-36" name="__codelineno-148-36" href="#__codelineno-148-36"></a>
</span><span id="__span-148-37"><a id="__codelineno-148-37" name="__codelineno-148-37" href="#__codelineno-148-37"></a><span class="w">  </span><span class="c1"># change permissions</span>
</span><span id="__span-148-38"><a id="__codelineno-148-38" name="__codelineno-148-38" href="#__codelineno-148-38"></a><span class="w">  </span><span class="n">file</span><span class="w"> </span><span class="s1">&#39;/tmp/my_flask_app/ssh/id_my_flask_app_deploy&#39;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-148-39"><a id="__codelineno-148-39" name="__codelineno-148-39" href="#__codelineno-148-39"></a><span class="w">    </span><span class="n">mode</span><span class="w"> </span><span class="mo">0600</span>
</span><span id="__span-148-40"><a id="__codelineno-148-40" name="__codelineno-148-40" href="#__codelineno-148-40"></a><span class="w">    </span><span class="n">user</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span>
</span><span id="__span-148-41"><a id="__codelineno-148-41" name="__codelineno-148-41" href="#__codelineno-148-41"></a><span class="w">    </span><span class="n">group</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span>
</span><span id="__span-148-42"><a id="__codelineno-148-42" name="__codelineno-148-42" href="#__codelineno-148-42"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-148-43"><a id="__codelineno-148-43" name="__codelineno-148-43" href="#__codelineno-148-43"></a><span class="k">end</span>
</span></code></pre></div>
<h4 id="set-the-my_app_ssh-recipe-to-run"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#set-the-my_app_ssh-recipe-to-run">Set the <code>my_app_ssh</code> recipe to run</a></h4>
<p>Add this line to <code>recipes/default.rb</code>:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-149-1"><a id="__codelineno-149-1" name="__codelineno-149-1" href="#__codelineno-149-1"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;my_flask_server::my_app_ssh&#39;</span>
</span></code></pre></div>
<p>Here is the complete file:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-150-1"><a id="__codelineno-150-1" name="__codelineno-150-1" href="#__codelineno-150-1"></a><span class="c1">#</span>
</span><span id="__span-150-2"><a id="__codelineno-150-2" name="__codelineno-150-2" href="#__codelineno-150-2"></a><span class="c1"># Cookbook Name:: my_flask_server</span>
</span><span id="__span-150-3"><a id="__codelineno-150-3" name="__codelineno-150-3" href="#__codelineno-150-3"></a><span class="c1"># Recipe:: default</span>
</span><span id="__span-150-4"><a id="__codelineno-150-4" name="__codelineno-150-4" href="#__codelineno-150-4"></a><span class="c1">#</span>
</span><span id="__span-150-5"><a id="__codelineno-150-5" name="__codelineno-150-5" href="#__codelineno-150-5"></a><span class="c1"># Copyright (c) 2016 The Authors, All Rights Reserved.</span>
</span><span id="__span-150-6"><a id="__codelineno-150-6" name="__codelineno-150-6" href="#__codelineno-150-6"></a>
</span><span id="__span-150-7"><a id="__codelineno-150-7" name="__codelineno-150-7" href="#__codelineno-150-7"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;apt::default&#39;</span>
</span><span id="__span-150-8"><a id="__codelineno-150-8" name="__codelineno-150-8" href="#__codelineno-150-8"></a>
</span><span id="__span-150-9"><a id="__codelineno-150-9" name="__codelineno-150-9" href="#__codelineno-150-9"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;my_flask_server::my_app_dir&#39;</span>
</span><span id="__span-150-10"><a id="__codelineno-150-10" name="__codelineno-150-10" href="#__codelineno-150-10"></a>
</span><span id="__span-150-11"><a id="__codelineno-150-11" name="__codelineno-150-11" href="#__codelineno-150-11"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;my_flask_server::my_app_python&#39;</span>
</span><span id="__span-150-12"><a id="__codelineno-150-12" name="__codelineno-150-12" href="#__codelineno-150-12"></a>
</span><span id="__span-150-13"><a id="__codelineno-150-13" name="__codelineno-150-13" href="#__codelineno-150-13"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;my_flask_server::my_app_ssh&#39;</span>
</span></code></pre></div>
<h4 id="run-all-tests_3"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#run-all-tests_3">Run all tests</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-151-1"><a id="__codelineno-151-1" name="__codelineno-151-1" href="#__codelineno-151-1"></a><span class="n">chef</span> <span class="n">exec</span> <span class="n">rake</span>
</span></code></pre></div>
<h3 id="deploy-application-from-git"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#deploy-application-from-git">Deploy Application From Git</a></h3>
<p>The test application is available in the <a href="https://bitbucket.org/vkantchev/my_flask_app/src">my_flask_app</a> repository on Bitbucket. Make sure you have forked it, and configured your SSH key, as explained earlier in this tutorial.</p>
<h4 id="reference-the-git-cookbook"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#reference-the-git-cookbook">Reference the <code>git</code> cookbook</a></h4>
<p>Add this line to <code>metadata.rb</code>:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-152-1"><a id="__codelineno-152-1" name="__codelineno-152-1" href="#__codelineno-152-1"></a><span class="n">depends</span><span class="w"> </span><span class="s1">&#39;git&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;~&gt; 4.3.6&#39;</span>
</span></code></pre></div>
<p>To get the latest version string, run <code>knife cookbook site show git</code>: </p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-153-1"><a id="__codelineno-153-1" name="__codelineno-153-1" href="#__codelineno-153-1"></a><span class="n">chef</span> <span class="n">exec</span> <span class="n">knife</span> <span class="n">cookbook</span> <span class="n">site</span> <span class="n">show</span> <span class="n">git</span> <span class="p">|</span> <span class="n">grep</span> <span class="n">latest_version</span>
</span><span id="__span-153-2"><a id="__codelineno-153-2" name="__codelineno-153-2" href="#__codelineno-153-2"></a><span class="n">latest_version</span><span class="p">:</span>     <span class="n">https</span><span class="p">://</span><span class="n">supermarket</span><span class="p">.</span><span class="n">chef</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">api</span><span class="p">/</span><span class="n">v1</span><span class="p">/</span><span class="n">cookbooks</span><span class="p">/</span><span class="n">git</span><span class="p">/</span><span class="n">versions</span><span class="p">/</span><span class="n">4</span><span class="p">.</span><span class="n">3</span><span class="p">.</span><span class="n">6</span>
</span></code></pre></div>
<p>Here is the complete file:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-154-1"><a id="__codelineno-154-1" name="__codelineno-154-1" href="#__codelineno-154-1"></a><span class="nb">name</span><span class="w"> </span><span class="s1">&#39;my_flask_server&#39;</span>
</span><span id="__span-154-2"><a id="__codelineno-154-2" name="__codelineno-154-2" href="#__codelineno-154-2"></a><span class="n">maintainer</span><span class="w"> </span><span class="s1">&#39;The Authors&#39;</span>
</span><span id="__span-154-3"><a id="__codelineno-154-3" name="__codelineno-154-3" href="#__codelineno-154-3"></a><span class="n">maintainer_email</span><span class="w"> </span><span class="s1">&#39;you@example.com&#39;</span>
</span><span id="__span-154-4"><a id="__codelineno-154-4" name="__codelineno-154-4" href="#__codelineno-154-4"></a><span class="n">license</span><span class="w"> </span><span class="s1">&#39;all_rights&#39;</span>
</span><span id="__span-154-5"><a id="__codelineno-154-5" name="__codelineno-154-5" href="#__codelineno-154-5"></a><span class="n">description</span><span class="w"> </span><span class="s1">&#39;Installs/Configures my_flask_server&#39;</span>
</span><span id="__span-154-6"><a id="__codelineno-154-6" name="__codelineno-154-6" href="#__codelineno-154-6"></a><span class="n">long_description</span><span class="w"> </span><span class="s1">&#39;Installs/Configures my_flask_server&#39;</span>
</span><span id="__span-154-7"><a id="__codelineno-154-7" name="__codelineno-154-7" href="#__codelineno-154-7"></a><span class="n">version</span><span class="w"> </span><span class="s1">&#39;0.1.0&#39;</span>
</span><span id="__span-154-8"><a id="__codelineno-154-8" name="__codelineno-154-8" href="#__codelineno-154-8"></a>
</span><span id="__span-154-9"><a id="__codelineno-154-9" name="__codelineno-154-9" href="#__codelineno-154-9"></a><span class="n">depends</span><span class="w"> </span><span class="s1">&#39;apt&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;~&gt; 2.9.2&#39;</span>
</span><span id="__span-154-10"><a id="__codelineno-154-10" name="__codelineno-154-10" href="#__codelineno-154-10"></a><span class="n">depends</span><span class="w"> </span><span class="s1">&#39;poise-python&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;~&gt; 1.2.1&#39;</span>
</span><span id="__span-154-11"><a id="__codelineno-154-11" name="__codelineno-154-11" href="#__codelineno-154-11"></a><span class="n">depends</span><span class="w"> </span><span class="s1">&#39;git&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;~&gt; 4.3.6&#39;</span>
</span></code></pre></div>
<h4 id="add-an-integration-test_3"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#add-an-integration-test_3">Add an integration test</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-155-1"><a id="__codelineno-155-1" name="__codelineno-155-1" href="#__codelineno-155-1"></a><span class="n">touch</span> <span class="n">test</span><span class="p">/</span><span class="n">integration</span><span class="p">/</span><span class="k">default</span><span class="p">/</span><span class="n">serverspec</span><span class="p">/</span><span class="n">my_app_deploy_spec</span><span class="p">.</span><span class="n">rb</span>
</span></code></pre></div>
<p>Add this code to <code>my_app_deploy_spec.rb</code>:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-156-1"><a id="__codelineno-156-1" name="__codelineno-156-1" href="#__codelineno-156-1"></a><span class="nb">require</span><span class="w"> </span><span class="s1">&#39;spec_helper&#39;</span>
</span><span id="__span-156-2"><a id="__codelineno-156-2" name="__codelineno-156-2" href="#__codelineno-156-2"></a>
</span><span id="__span-156-3"><a id="__codelineno-156-3" name="__codelineno-156-3" href="#__codelineno-156-3"></a><span class="n">describe</span><span class="w"> </span><span class="s1">&#39;my_flask_server::my_app_deploy&#39;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-156-4"><a id="__codelineno-156-4" name="__codelineno-156-4" href="#__codelineno-156-4"></a><span class="w">  </span><span class="c1"># Serverspec examples can be found at</span>
</span><span id="__span-156-5"><a id="__codelineno-156-5" name="__codelineno-156-5" href="#__codelineno-156-5"></a><span class="w">  </span><span class="c1"># http://serverspec.org/resource_types.html</span>
</span><span id="__span-156-6"><a id="__codelineno-156-6" name="__codelineno-156-6" href="#__codelineno-156-6"></a>
</span><span id="__span-156-7"><a id="__codelineno-156-7" name="__codelineno-156-7" href="#__codelineno-156-7"></a><span class="w">  </span><span class="c1"># verify git deployment</span>
</span><span id="__span-156-8"><a id="__codelineno-156-8" name="__codelineno-156-8" href="#__codelineno-156-8"></a><span class="w">  </span><span class="n">describe</span><span class="w"> </span><span class="n">file</span><span class="p">(</span><span class="s1">&#39;/var/www/my_flask_app/current&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-156-9"><a id="__codelineno-156-9" name="__codelineno-156-9" href="#__codelineno-156-9"></a><span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_symlink</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-156-10"><a id="__codelineno-156-10" name="__codelineno-156-10" href="#__codelineno-156-10"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-156-11"><a id="__codelineno-156-11" name="__codelineno-156-11" href="#__codelineno-156-11"></a>
</span><span id="__span-156-12"><a id="__codelineno-156-12" name="__codelineno-156-12" href="#__codelineno-156-12"></a><span class="w">  </span><span class="n">describe</span><span class="w"> </span><span class="n">file</span><span class="p">(</span><span class="s1">&#39;/var/www/my_flask_app/current/app.py&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-156-13"><a id="__codelineno-156-13" name="__codelineno-156-13" href="#__codelineno-156-13"></a><span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">exist</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-156-14"><a id="__codelineno-156-14" name="__codelineno-156-14" href="#__codelineno-156-14"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-156-15"><a id="__codelineno-156-15" name="__codelineno-156-15" href="#__codelineno-156-15"></a>
</span><span id="__span-156-16"><a id="__codelineno-156-16" name="__codelineno-156-16" href="#__codelineno-156-16"></a><span class="w">  </span><span class="c1"># verify requirements.txt has been processed</span>
</span><span id="__span-156-17"><a id="__codelineno-156-17" name="__codelineno-156-17" href="#__codelineno-156-17"></a><span class="w">  </span><span class="c1"># i.e. local python packages like `Flask` have been installed</span>
</span><span id="__span-156-18"><a id="__codelineno-156-18" name="__codelineno-156-18" href="#__codelineno-156-18"></a><span class="w">  </span><span class="n">describe</span><span class="w"> </span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;/var/www/my_flask_app/shared/.env2/bin/pip list&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-156-19"><a id="__codelineno-156-19" name="__codelineno-156-19" href="#__codelineno-156-19"></a><span class="w">    </span><span class="n">its</span><span class="p">(</span><span class="ss">:stdout</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">contain</span><span class="w"> </span><span class="s1">&#39;Flask&#39;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-156-20"><a id="__codelineno-156-20" name="__codelineno-156-20" href="#__codelineno-156-20"></a><span class="w">    </span><span class="n">its</span><span class="p">(</span><span class="ss">:exit_status</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">eq</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-156-21"><a id="__codelineno-156-21" name="__codelineno-156-21" href="#__codelineno-156-21"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-156-22"><a id="__codelineno-156-22" name="__codelineno-156-22" href="#__codelineno-156-22"></a><span class="k">end</span>
</span></code></pre></div>
<h4 id="write-the-my_app_deploy-recipe"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#write-the-my_app_deploy-recipe">Write the <code>my_app_deploy</code> recipe</a></h4>
<p>The first step is to create the recipe file, <code>my_app_deploy.rb</code>. Run the following command to generate it:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-157-1"><a id="__codelineno-157-1" name="__codelineno-157-1" href="#__codelineno-157-1"></a><span class="n">chef</span> <span class="n">generate</span> <span class="n">recipe</span> <span class="n">my_app_deploy</span>
</span><span id="__span-157-2"><a id="__codelineno-157-2" name="__codelineno-157-2" href="#__codelineno-157-2"></a><span class="nb">rm </span><span class="n">spec</span><span class="p">/</span><span class="n">unit</span><span class="p">/</span><span class="n">recipes</span><span class="p">/</span><span class="n">my_app_deploy_spec</span><span class="p">.</span><span class="n">rb</span>
</span></code></pre></div>
<p>Write out <code>recipes/my_app_deploy.rb</code> like this:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-158-1"><a id="__codelineno-158-1" name="__codelineno-158-1" href="#__codelineno-158-1"></a><span class="c1">#</span>
</span><span id="__span-158-2"><a id="__codelineno-158-2" name="__codelineno-158-2" href="#__codelineno-158-2"></a><span class="c1"># Cookbook Name:: my_flask_server</span>
</span><span id="__span-158-3"><a id="__codelineno-158-3" name="__codelineno-158-3" href="#__codelineno-158-3"></a><span class="c1"># Recipe:: my_app_deploy</span>
</span><span id="__span-158-4"><a id="__codelineno-158-4" name="__codelineno-158-4" href="#__codelineno-158-4"></a><span class="c1">#</span>
</span><span id="__span-158-5"><a id="__codelineno-158-5" name="__codelineno-158-5" href="#__codelineno-158-5"></a><span class="c1"># Copyright (c) 2016 The Authors, All Rights Reserved.</span>
</span><span id="__span-158-6"><a id="__codelineno-158-6" name="__codelineno-158-6" href="#__codelineno-158-6"></a>
</span><span id="__span-158-7"><a id="__codelineno-158-7" name="__codelineno-158-7" href="#__codelineno-158-7"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;git::default&#39;</span>
</span><span id="__span-158-8"><a id="__codelineno-158-8" name="__codelineno-158-8" href="#__codelineno-158-8"></a>
</span><span id="__span-158-9"><a id="__codelineno-158-9" name="__codelineno-158-9" href="#__codelineno-158-9"></a><span class="c1"># checkout app from git repo / master branch</span>
</span><span id="__span-158-10"><a id="__codelineno-158-10" name="__codelineno-158-10" href="#__codelineno-158-10"></a><span class="c1"># creates `releases`, and `current` directories</span>
</span><span id="__span-158-11"><a id="__codelineno-158-11" name="__codelineno-158-11" href="#__codelineno-158-11"></a><span class="c1"># links `current` to latest revision</span>
</span><span id="__span-158-12"><a id="__codelineno-158-12" name="__codelineno-158-12" href="#__codelineno-158-12"></a><span class="n">deploy_revision</span><span class="w"> </span><span class="s1">&#39;/var/www/my_flask_app&#39;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-158-13"><a id="__codelineno-158-13" name="__codelineno-158-13" href="#__codelineno-158-13"></a><span class="w">  </span><span class="n">action</span><span class="w"> </span><span class="ss">:deploy</span>
</span><span id="__span-158-14"><a id="__codelineno-158-14" name="__codelineno-158-14" href="#__codelineno-158-14"></a>
</span><span id="__span-158-15"><a id="__codelineno-158-15" name="__codelineno-158-15" href="#__codelineno-158-15"></a><span class="w">  </span><span class="n">repo</span><span class="w"> </span><span class="s1">&#39;ssh://git@bitbucket.org/vkantchev/my_flask_app.git&#39;</span>
</span><span id="__span-158-16"><a id="__codelineno-158-16" name="__codelineno-158-16" href="#__codelineno-158-16"></a><span class="w">  </span><span class="n">branch</span><span class="w"> </span><span class="s1">&#39;master&#39;</span>
</span><span id="__span-158-17"><a id="__codelineno-158-17" name="__codelineno-158-17" href="#__codelineno-158-17"></a>
</span><span id="__span-158-18"><a id="__codelineno-158-18" name="__codelineno-158-18" href="#__codelineno-158-18"></a><span class="w">  </span><span class="n">user</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span>
</span><span id="__span-158-19"><a id="__codelineno-158-19" name="__codelineno-158-19" href="#__codelineno-158-19"></a><span class="w">  </span><span class="n">group</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span>
</span><span id="__span-158-20"><a id="__codelineno-158-20" name="__codelineno-158-20" href="#__codelineno-158-20"></a>
</span><span id="__span-158-21"><a id="__codelineno-158-21" name="__codelineno-158-21" href="#__codelineno-158-21"></a><span class="w">  </span><span class="n">ssh_wrapper</span><span class="w"> </span><span class="s1">&#39;/tmp/my_flask_app/ssh/wrap-ssh-4-git.sh&#39;</span>
</span><span id="__span-158-22"><a id="__codelineno-158-22" name="__codelineno-158-22" href="#__codelineno-158-22"></a>
</span><span id="__span-158-23"><a id="__codelineno-158-23" name="__codelineno-158-23" href="#__codelineno-158-23"></a><span class="w">  </span><span class="n">purge_before_symlink</span><span class="w"> </span><span class="o">[]</span>
</span><span id="__span-158-24"><a id="__codelineno-158-24" name="__codelineno-158-24" href="#__codelineno-158-24"></a><span class="w">  </span><span class="n">create_dirs_before_symlink</span><span class="w"> </span><span class="o">[]</span>
</span><span id="__span-158-25"><a id="__codelineno-158-25" name="__codelineno-158-25" href="#__codelineno-158-25"></a>
</span><span id="__span-158-26"><a id="__codelineno-158-26" name="__codelineno-158-26" href="#__codelineno-158-26"></a><span class="w">  </span><span class="n">symlinks</span><span class="p">({})</span>
</span><span id="__span-158-27"><a id="__codelineno-158-27" name="__codelineno-158-27" href="#__codelineno-158-27"></a>
</span><span id="__span-158-28"><a id="__codelineno-158-28" name="__codelineno-158-28" href="#__codelineno-158-28"></a><span class="w">  </span><span class="n">migrate</span><span class="w"> </span><span class="kp">false</span>
</span><span id="__span-158-29"><a id="__codelineno-158-29" name="__codelineno-158-29" href="#__codelineno-158-29"></a><span class="w">  </span><span class="n">symlink_before_migrate</span><span class="p">({})</span>
</span><span id="__span-158-30"><a id="__codelineno-158-30" name="__codelineno-158-30" href="#__codelineno-158-30"></a><span class="k">end</span>
</span><span id="__span-158-31"><a id="__codelineno-158-31" name="__codelineno-158-31" href="#__codelineno-158-31"></a>
</span><span id="__span-158-32"><a id="__codelineno-158-32" name="__codelineno-158-32" href="#__codelineno-158-32"></a><span class="c1"># install python packages in `my_flask_app_env` via pip</span>
</span><span id="__span-158-33"><a id="__codelineno-158-33" name="__codelineno-158-33" href="#__codelineno-158-33"></a><span class="c1"># `my_flask_app_env` is defined in the `my_app_python.rb`</span>
</span><span id="__span-158-34"><a id="__codelineno-158-34" name="__codelineno-158-34" href="#__codelineno-158-34"></a><span class="n">pip_requirements</span><span class="w"> </span><span class="s1">&#39;/var/www/my_flask_app/current/requirements.txt&#39;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-158-35"><a id="__codelineno-158-35" name="__codelineno-158-35" href="#__codelineno-158-35"></a><span class="w">  </span><span class="n">virtualenv</span><span class="w"> </span><span class="s1">&#39;my_flask_app_env&#39;</span>
</span><span id="__span-158-36"><a id="__codelineno-158-36" name="__codelineno-158-36" href="#__codelineno-158-36"></a><span class="w">  </span><span class="n">user</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span>
</span><span id="__span-158-37"><a id="__codelineno-158-37" name="__codelineno-158-37" href="#__codelineno-158-37"></a><span class="w">  </span><span class="n">group</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span>
</span><span id="__span-158-38"><a id="__codelineno-158-38" name="__codelineno-158-38" href="#__codelineno-158-38"></a><span class="w">  </span><span class="n">action</span><span class="w"> </span><span class="ss">:install</span>
</span><span id="__span-158-39"><a id="__codelineno-158-39" name="__codelineno-158-39" href="#__codelineno-158-39"></a><span class="k">end</span>
</span></code></pre></div>
<h4 id="set-the-my_app_deploy-recipe-to-run"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#set-the-my_app_deploy-recipe-to-run">Set the <code>my_app_deploy</code> recipe to run</a></h4>
<p>Add this line to <code>recipes/default.rb</code>:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-159-1"><a id="__codelineno-159-1" name="__codelineno-159-1" href="#__codelineno-159-1"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;my_flask_server::my_app_deploy&#39;</span>
</span></code></pre></div>
<p>Here is the complete file:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-160-1"><a id="__codelineno-160-1" name="__codelineno-160-1" href="#__codelineno-160-1"></a><span class="c1">#</span>
</span><span id="__span-160-2"><a id="__codelineno-160-2" name="__codelineno-160-2" href="#__codelineno-160-2"></a><span class="c1"># Cookbook Name:: my_flask_server</span>
</span><span id="__span-160-3"><a id="__codelineno-160-3" name="__codelineno-160-3" href="#__codelineno-160-3"></a><span class="c1"># Recipe:: default</span>
</span><span id="__span-160-4"><a id="__codelineno-160-4" name="__codelineno-160-4" href="#__codelineno-160-4"></a><span class="c1">#</span>
</span><span id="__span-160-5"><a id="__codelineno-160-5" name="__codelineno-160-5" href="#__codelineno-160-5"></a><span class="c1"># Copyright (c) 2016 The Authors, All Rights Reserved.</span>
</span><span id="__span-160-6"><a id="__codelineno-160-6" name="__codelineno-160-6" href="#__codelineno-160-6"></a>
</span><span id="__span-160-7"><a id="__codelineno-160-7" name="__codelineno-160-7" href="#__codelineno-160-7"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;apt::default&#39;</span>
</span><span id="__span-160-8"><a id="__codelineno-160-8" name="__codelineno-160-8" href="#__codelineno-160-8"></a>
</span><span id="__span-160-9"><a id="__codelineno-160-9" name="__codelineno-160-9" href="#__codelineno-160-9"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;my_flask_server::my_app_dir&#39;</span>
</span><span id="__span-160-10"><a id="__codelineno-160-10" name="__codelineno-160-10" href="#__codelineno-160-10"></a>
</span><span id="__span-160-11"><a id="__codelineno-160-11" name="__codelineno-160-11" href="#__codelineno-160-11"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;my_flask_server::my_app_python&#39;</span>
</span><span id="__span-160-12"><a id="__codelineno-160-12" name="__codelineno-160-12" href="#__codelineno-160-12"></a>
</span><span id="__span-160-13"><a id="__codelineno-160-13" name="__codelineno-160-13" href="#__codelineno-160-13"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;my_flask_server::my_app_ssh&#39;</span>
</span><span id="__span-160-14"><a id="__codelineno-160-14" name="__codelineno-160-14" href="#__codelineno-160-14"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;my_flask_server::my_app_deploy&#39;</span>
</span></code></pre></div>
<h4 id="run-all-tests_4"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#run-all-tests_4">Run all tests</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-161-1"><a id="__codelineno-161-1" name="__codelineno-161-1" href="#__codelineno-161-1"></a><span class="n">chef</span> <span class="n">exec</span> <span class="n">rake</span>
</span></code></pre></div>
<h3 id="install-uwsgi"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#install-uwsgi">Install uWSGI</a></h3>
<h4 id="add-an-integration-test_4"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#add-an-integration-test_4">Add an integration test</a></h4>
<p>Create <code>test/integration/default/serverspec/my_app_uwsgi_spec.rb</code></p>
<p>Add this code to <code>my_app_uwsgi_spec.rb</code>:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-162-1"><a id="__codelineno-162-1" name="__codelineno-162-1" href="#__codelineno-162-1"></a><span class="nb">require</span><span class="w"> </span><span class="s1">&#39;spec_helper&#39;</span>
</span><span id="__span-162-2"><a id="__codelineno-162-2" name="__codelineno-162-2" href="#__codelineno-162-2"></a>
</span><span id="__span-162-3"><a id="__codelineno-162-3" name="__codelineno-162-3" href="#__codelineno-162-3"></a><span class="n">describe</span><span class="w"> </span><span class="s1">&#39;my_flask_server::my_app_uwsgi&#39;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-162-4"><a id="__codelineno-162-4" name="__codelineno-162-4" href="#__codelineno-162-4"></a><span class="w">  </span><span class="c1"># Serverspec examples can be found at</span>
</span><span id="__span-162-5"><a id="__codelineno-162-5" name="__codelineno-162-5" href="#__codelineno-162-5"></a><span class="w">  </span><span class="c1"># http://serverspec.org/resource_types.html</span>
</span><span id="__span-162-6"><a id="__codelineno-162-6" name="__codelineno-162-6" href="#__codelineno-162-6"></a>
</span><span id="__span-162-7"><a id="__codelineno-162-7" name="__codelineno-162-7" href="#__codelineno-162-7"></a><span class="w">  </span><span class="c1"># verify uWSGI package</span>
</span><span id="__span-162-8"><a id="__codelineno-162-8" name="__codelineno-162-8" href="#__codelineno-162-8"></a><span class="w">  </span><span class="n">describe</span><span class="w"> </span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;/var/www/my_flask_app/shared/.env2/bin/pip list&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-162-9"><a id="__codelineno-162-9" name="__codelineno-162-9" href="#__codelineno-162-9"></a><span class="w">    </span><span class="n">its</span><span class="p">(</span><span class="ss">:stdout</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">contain</span><span class="w"> </span><span class="s1">&#39;uWSGI&#39;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-162-10"><a id="__codelineno-162-10" name="__codelineno-162-10" href="#__codelineno-162-10"></a><span class="w">    </span><span class="n">its</span><span class="p">(</span><span class="ss">:exit_status</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">eq</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-162-11"><a id="__codelineno-162-11" name="__codelineno-162-11" href="#__codelineno-162-11"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-162-12"><a id="__codelineno-162-12" name="__codelineno-162-12" href="#__codelineno-162-12"></a>
</span><span id="__span-162-13"><a id="__codelineno-162-13" name="__codelineno-162-13" href="#__codelineno-162-13"></a><span class="w">  </span><span class="c1"># verify my_flask_app uWSGI serice</span>
</span><span id="__span-162-14"><a id="__codelineno-162-14" name="__codelineno-162-14" href="#__codelineno-162-14"></a><span class="w">  </span><span class="n">describe</span><span class="w"> </span><span class="n">service</span><span class="p">(</span><span class="s1">&#39;my_flask_app&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-162-15"><a id="__codelineno-162-15" name="__codelineno-162-15" href="#__codelineno-162-15"></a><span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_enabled</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-162-16"><a id="__codelineno-162-16" name="__codelineno-162-16" href="#__codelineno-162-16"></a><span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_running</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-162-17"><a id="__codelineno-162-17" name="__codelineno-162-17" href="#__codelineno-162-17"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-162-18"><a id="__codelineno-162-18" name="__codelineno-162-18" href="#__codelineno-162-18"></a><span class="k">end</span>
</span></code></pre></div>
<h4 id="create-uwsgi-python-config-file"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#create-uwsgi-python-config-file">Create uWSGI Python Config File</a></h4>
<p>Create <code>files/default/uwsgi/my_flask_app.ini</code> file:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-163-1"><a id="__codelineno-163-1" name="__codelineno-163-1" href="#__codelineno-163-1"></a><span class="n">mkdir</span> <span class="n">files</span><span class="p">/</span><span class="k">default</span><span class="p">/</span><span class="n">uwsgi</span>
</span><span id="__span-163-2"><a id="__codelineno-163-2" name="__codelineno-163-2" href="#__codelineno-163-2"></a><span class="n">chef</span> <span class="n">generate</span> <span class="n">file</span> <span class="n">uwsgi</span><span class="p">/</span><span class="n">my_flask_app</span><span class="p">.</span><span class="n">ini</span>
</span></code></pre></div>
<p>Add this content to the <code>files/default/uwsgi/my_flask_app.ini</code>:</p>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-164-1"><a id="__codelineno-164-1" name="__codelineno-164-1" href="#__codelineno-164-1"></a><span class="c1"># See:</span>
</span><span id="__span-164-2"><a id="__codelineno-164-2" name="__codelineno-164-2" href="#__codelineno-164-2"></a><span class="c1"># http://uwsgi-docs.readthedocs.org/en/latest/WSGIquickstart.html</span>
</span><span id="__span-164-3"><a id="__codelineno-164-3" name="__codelineno-164-3" href="#__codelineno-164-3"></a><span class="c1"># http://uwsgi-docs.readthedocs.org/en/latest/Upstart.html</span>
</span><span id="__span-164-4"><a id="__codelineno-164-4" name="__codelineno-164-4" href="#__codelineno-164-4"></a><span class="c1"># http://uwsgi-docs.readthedocs.org/en/latest/Options.html#plugin-python</span>
</span><span id="__span-164-5"><a id="__codelineno-164-5" name="__codelineno-164-5" href="#__codelineno-164-5"></a><span class="k">[uwsgi]</span>
</span><span id="__span-164-6"><a id="__codelineno-164-6" name="__codelineno-164-6" href="#__codelineno-164-6"></a>
</span><span id="__span-164-7"><a id="__codelineno-164-7" name="__codelineno-164-7" href="#__codelineno-164-7"></a><span class="c1"># socket configuration</span>
</span><span id="__span-164-8"><a id="__codelineno-164-8" name="__codelineno-164-8" href="#__codelineno-164-8"></a><span class="na">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">/var/www/my_flask_app/shared/.uwsgi/my_flask_app.sock</span>
</span><span id="__span-164-9"><a id="__codelineno-164-9" name="__codelineno-164-9" href="#__codelineno-164-9"></a><span class="na">chmod-socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">664</span>
</span><span id="__span-164-10"><a id="__codelineno-164-10" name="__codelineno-164-10" href="#__codelineno-164-10"></a><span class="na">vacuum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>
</span><span id="__span-164-11"><a id="__codelineno-164-11" name="__codelineno-164-11" href="#__codelineno-164-11"></a>
</span><span id="__span-164-12"><a id="__codelineno-164-12" name="__codelineno-164-12" href="#__codelineno-164-12"></a><span class="c1"># process configuration</span>
</span><span id="__span-164-13"><a id="__codelineno-164-13" name="__codelineno-164-13" href="#__codelineno-164-13"></a><span class="na">master</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>
</span><span id="__span-164-14"><a id="__codelineno-164-14" name="__codelineno-164-14" href="#__codelineno-164-14"></a><span class="na">processes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">2</span>
</span><span id="__span-164-15"><a id="__codelineno-164-15" name="__codelineno-164-15" href="#__codelineno-164-15"></a><span class="na">threads</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">4</span>
</span><span id="__span-164-16"><a id="__codelineno-164-16" name="__codelineno-164-16" href="#__codelineno-164-16"></a><span class="na">die-on-term</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>
</span><span id="__span-164-17"><a id="__codelineno-164-17" name="__codelineno-164-17" href="#__codelineno-164-17"></a>
</span><span id="__span-164-18"><a id="__codelineno-164-18" name="__codelineno-164-18" href="#__codelineno-164-18"></a><span class="c1"># app configuration</span>
</span><span id="__span-164-19"><a id="__codelineno-164-19" name="__codelineno-164-19" href="#__codelineno-164-19"></a>
</span><span id="__span-164-20"><a id="__codelineno-164-20" name="__codelineno-164-20" href="#__codelineno-164-20"></a><span class="c1"># virtual environment</span>
</span><span id="__span-164-21"><a id="__codelineno-164-21" name="__codelineno-164-21" href="#__codelineno-164-21"></a><span class="na">virtualenv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">/var/www/my_flask_app/shared/.env2</span>
</span><span id="__span-164-22"><a id="__codelineno-164-22" name="__codelineno-164-22" href="#__codelineno-164-22"></a>
</span><span id="__span-164-23"><a id="__codelineno-164-23" name="__codelineno-164-23" href="#__codelineno-164-23"></a><span class="c1"># call the app instance from the app.py module</span>
</span><span id="__span-164-24"><a id="__codelineno-164-24" name="__codelineno-164-24" href="#__codelineno-164-24"></a><span class="na">chdir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">/var/www/my_flask_app/current</span>
</span><span id="__span-164-25"><a id="__codelineno-164-25" name="__codelineno-164-25" href="#__codelineno-164-25"></a><span class="na">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">app</span>
</span><span id="__span-164-26"><a id="__codelineno-164-26" name="__codelineno-164-26" href="#__codelineno-164-26"></a><span class="na">callable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">app</span>
</span></code></pre></div>
<p>IMPORTANT: Make sure the file uses Unix Line Ending (\n, LF) and UTF-8 encoding. Otherwise you may get weird errors when Chef client runs the script during deployment.</p>
<h4 id="create-uwsgi-service-config-file"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#create-uwsgi-service-config-file">Create uWSGI Service Config File</a></h4>
<p>Create <code>files/default/uwsgi/my_flask_app.conf</code> file:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-165-1"><a id="__codelineno-165-1" name="__codelineno-165-1" href="#__codelineno-165-1"></a><span class="n">chef</span> <span class="n">generate</span> <span class="n">file</span> <span class="n">uwsgi</span><span class="p">/</span><span class="n">my_flask_app</span><span class="p">.</span><span class="n">conf</span>
</span></code></pre></div>
<p>Add this content to the <code>files/default/uwsgi/my_flask_app.conf</code>:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-166-1"><a id="__codelineno-166-1" name="__codelineno-166-1" href="#__codelineno-166-1"></a>description &quot;uWSGI instance to serve my_flask_app&quot;
</span><span id="__span-166-2"><a id="__codelineno-166-2" name="__codelineno-166-2" href="#__codelineno-166-2"></a>
</span><span id="__span-166-3"><a id="__codelineno-166-3" name="__codelineno-166-3" href="#__codelineno-166-3"></a>start on runlevel [2345]
</span><span id="__span-166-4"><a id="__codelineno-166-4" name="__codelineno-166-4" href="#__codelineno-166-4"></a>stop on runlevel [!2345]
</span><span id="__span-166-5"><a id="__codelineno-166-5" name="__codelineno-166-5" href="#__codelineno-166-5"></a>
</span><span id="__span-166-6"><a id="__codelineno-166-6" name="__codelineno-166-6" href="#__codelineno-166-6"></a>setuid www-data
</span><span id="__span-166-7"><a id="__codelineno-166-7" name="__codelineno-166-7" href="#__codelineno-166-7"></a>setgid www-data
</span><span id="__span-166-8"><a id="__codelineno-166-8" name="__codelineno-166-8" href="#__codelineno-166-8"></a>
</span><span id="__span-166-9"><a id="__codelineno-166-9" name="__codelineno-166-9" href="#__codelineno-166-9"></a>script
</span><span id="__span-166-10"><a id="__codelineno-166-10" name="__codelineno-166-10" href="#__codelineno-166-10"></a>  cd /var/www/my_flask_app/shared
</span><span id="__span-166-11"><a id="__codelineno-166-11" name="__codelineno-166-11" href="#__codelineno-166-11"></a>  . .env2/bin/activate
</span><span id="__span-166-12"><a id="__codelineno-166-12" name="__codelineno-166-12" href="#__codelineno-166-12"></a>  uwsgi --ini .uwsgi/my_flask_app.ini
</span><span id="__span-166-13"><a id="__codelineno-166-13" name="__codelineno-166-13" href="#__codelineno-166-13"></a>end script
</span></code></pre></div>
<p>IMPORTANT: Make sure the file uses Unix Line Ending (\n, LF) and UTF-8 encoding. Otherwise you may get weird errors when Chef client runs the script during deployment.</p>
<h4 id="write-the-my_app_uwsgi-recipe"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#write-the-my_app_uwsgi-recipe">Write the <code>my_app_uwsgi</code> recipe</a></h4>
<p>The first step is to create the recipe file, <code>my_app_uwsgi.rb</code>. Run the following command to generate it:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-167-1"><a id="__codelineno-167-1" name="__codelineno-167-1" href="#__codelineno-167-1"></a><span class="n">chef</span> <span class="n">generate</span> <span class="n">recipe</span> <span class="n">my_app_uwsgi</span>
</span><span id="__span-167-2"><a id="__codelineno-167-2" name="__codelineno-167-2" href="#__codelineno-167-2"></a><span class="nb">rm </span><span class="n">spec</span><span class="p">/</span><span class="n">unit</span><span class="p">/</span><span class="n">recipes</span><span class="p">/</span><span class="n">my_app_uwsgi_spec</span><span class="p">.</span><span class="n">rb</span>
</span></code></pre></div>
<p>Write out <code>recipes/my_app_uwsgi.rb</code> like this:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-168-1"><a id="__codelineno-168-1" name="__codelineno-168-1" href="#__codelineno-168-1"></a><span class="c1">#</span>
</span><span id="__span-168-2"><a id="__codelineno-168-2" name="__codelineno-168-2" href="#__codelineno-168-2"></a><span class="c1"># Cookbook Name:: my_flask_server</span>
</span><span id="__span-168-3"><a id="__codelineno-168-3" name="__codelineno-168-3" href="#__codelineno-168-3"></a><span class="c1"># Recipe:: my_app_uwsgi</span>
</span><span id="__span-168-4"><a id="__codelineno-168-4" name="__codelineno-168-4" href="#__codelineno-168-4"></a><span class="c1">#</span>
</span><span id="__span-168-5"><a id="__codelineno-168-5" name="__codelineno-168-5" href="#__codelineno-168-5"></a><span class="c1"># Copyright (c) 2016 The Authors, All Rights Reserved.</span>
</span><span id="__span-168-6"><a id="__codelineno-168-6" name="__codelineno-168-6" href="#__codelineno-168-6"></a>
</span><span id="__span-168-7"><a id="__codelineno-168-7" name="__codelineno-168-7" href="#__codelineno-168-7"></a><span class="c1"># Install the uwsgi package in virtual environment using pip</span>
</span><span id="__span-168-8"><a id="__codelineno-168-8" name="__codelineno-168-8" href="#__codelineno-168-8"></a><span class="c1"># See https://supermarket.chef.io/cookbooks/poise-python</span>
</span><span id="__span-168-9"><a id="__codelineno-168-9" name="__codelineno-168-9" href="#__codelineno-168-9"></a>
</span><span id="__span-168-10"><a id="__codelineno-168-10" name="__codelineno-168-10" href="#__codelineno-168-10"></a><span class="c1"># install uwsgi python package</span>
</span><span id="__span-168-11"><a id="__codelineno-168-11" name="__codelineno-168-11" href="#__codelineno-168-11"></a><span class="n">python_package</span><span class="w"> </span><span class="s1">&#39;uwsgi&#39;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-168-12"><a id="__codelineno-168-12" name="__codelineno-168-12" href="#__codelineno-168-12"></a><span class="w">  </span><span class="n">virtualenv</span><span class="w"> </span><span class="s1">&#39;my_flask_app_env&#39;</span>
</span><span id="__span-168-13"><a id="__codelineno-168-13" name="__codelineno-168-13" href="#__codelineno-168-13"></a><span class="w">  </span><span class="n">user</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span>
</span><span id="__span-168-14"><a id="__codelineno-168-14" name="__codelineno-168-14" href="#__codelineno-168-14"></a><span class="w">  </span><span class="n">group</span><span class="w"> </span><span class="s1">&#39;www-data&#39;</span>
</span><span id="__span-168-15"><a id="__codelineno-168-15" name="__codelineno-168-15" href="#__codelineno-168-15"></a><span class="k">end</span>
</span><span id="__span-168-16"><a id="__codelineno-168-16" name="__codelineno-168-16" href="#__codelineno-168-16"></a>
</span><span id="__span-168-17"><a id="__codelineno-168-17" name="__codelineno-168-17" href="#__codelineno-168-17"></a><span class="c1"># my_flask_app uWSGI configuration</span>
</span><span id="__span-168-18"><a id="__codelineno-168-18" name="__codelineno-168-18" href="#__codelineno-168-18"></a><span class="n">cookbook_file</span><span class="w"> </span><span class="s1">&#39;/var/www/my_flask_app/shared/.uwsgi/my_flask_app.ini&#39;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-168-19"><a id="__codelineno-168-19" name="__codelineno-168-19" href="#__codelineno-168-19"></a><span class="w">  </span><span class="n">source</span><span class="w"> </span><span class="s1">&#39;uwsgi/my_flask_app.ini&#39;</span>
</span><span id="__span-168-20"><a id="__codelineno-168-20" name="__codelineno-168-20" href="#__codelineno-168-20"></a><span class="w">  </span><span class="n">owner</span><span class="w"> </span><span class="s1">&#39;root&#39;</span>
</span><span id="__span-168-21"><a id="__codelineno-168-21" name="__codelineno-168-21" href="#__codelineno-168-21"></a><span class="w">  </span><span class="n">group</span><span class="w"> </span><span class="s1">&#39;root&#39;</span>
</span><span id="__span-168-22"><a id="__codelineno-168-22" name="__codelineno-168-22" href="#__codelineno-168-22"></a><span class="w">  </span><span class="n">mode</span><span class="w"> </span><span class="mo">0644</span>
</span><span id="__span-168-23"><a id="__codelineno-168-23" name="__codelineno-168-23" href="#__codelineno-168-23"></a><span class="k">end</span>
</span><span id="__span-168-24"><a id="__codelineno-168-24" name="__codelineno-168-24" href="#__codelineno-168-24"></a>
</span><span id="__span-168-25"><a id="__codelineno-168-25" name="__codelineno-168-25" href="#__codelineno-168-25"></a><span class="c1"># create my_flask_app uWSGI service</span>
</span><span id="__span-168-26"><a id="__codelineno-168-26" name="__codelineno-168-26" href="#__codelineno-168-26"></a><span class="n">cookbook_file</span><span class="w"> </span><span class="s1">&#39;/etc/init/my_flask_app.conf&#39;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-168-27"><a id="__codelineno-168-27" name="__codelineno-168-27" href="#__codelineno-168-27"></a><span class="w">  </span><span class="n">source</span><span class="w"> </span><span class="s1">&#39;uwsgi/my_flask_app.conf&#39;</span>
</span><span id="__span-168-28"><a id="__codelineno-168-28" name="__codelineno-168-28" href="#__codelineno-168-28"></a><span class="w">  </span><span class="n">owner</span><span class="w"> </span><span class="s1">&#39;root&#39;</span>
</span><span id="__span-168-29"><a id="__codelineno-168-29" name="__codelineno-168-29" href="#__codelineno-168-29"></a><span class="w">  </span><span class="n">group</span><span class="w"> </span><span class="s1">&#39;root&#39;</span>
</span><span id="__span-168-30"><a id="__codelineno-168-30" name="__codelineno-168-30" href="#__codelineno-168-30"></a><span class="w">  </span><span class="n">mode</span><span class="w"> </span><span class="mo">0644</span>
</span><span id="__span-168-31"><a id="__codelineno-168-31" name="__codelineno-168-31" href="#__codelineno-168-31"></a><span class="k">end</span>
</span><span id="__span-168-32"><a id="__codelineno-168-32" name="__codelineno-168-32" href="#__codelineno-168-32"></a>
</span><span id="__span-168-33"><a id="__codelineno-168-33" name="__codelineno-168-33" href="#__codelineno-168-33"></a><span class="c1"># start my_flask_app uWSGI service</span>
</span><span id="__span-168-34"><a id="__codelineno-168-34" name="__codelineno-168-34" href="#__codelineno-168-34"></a><span class="n">service</span><span class="w"> </span><span class="s1">&#39;my_flask_app&#39;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-168-35"><a id="__codelineno-168-35" name="__codelineno-168-35" href="#__codelineno-168-35"></a><span class="w">  </span><span class="n">provider</span><span class="w"> </span><span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Service</span><span class="o">::</span><span class="no">Upstart</span>
</span><span id="__span-168-36"><a id="__codelineno-168-36" name="__codelineno-168-36" href="#__codelineno-168-36"></a><span class="w">  </span><span class="n">supports</span><span class="w"> </span><span class="ss">status</span><span class="p">:</span><span class="w"> </span><span class="kp">true</span><span class="p">,</span><span class="w"> </span><span class="ss">restart</span><span class="p">:</span><span class="w"> </span><span class="kp">true</span><span class="p">,</span><span class="w"> </span><span class="ss">reload</span><span class="p">:</span><span class="w"> </span><span class="kp">true</span>
</span><span id="__span-168-37"><a id="__codelineno-168-37" name="__codelineno-168-37" href="#__codelineno-168-37"></a><span class="w">  </span><span class="n">action</span><span class="w"> </span><span class="o">[</span><span class="ss">:enable</span><span class="p">,</span><span class="w"> </span><span class="ss">:start</span><span class="o">]</span>
</span><span id="__span-168-38"><a id="__codelineno-168-38" name="__codelineno-168-38" href="#__codelineno-168-38"></a><span class="k">end</span>
</span></code></pre></div>
<h4 id="set-the-my_app_uwsgi-recipe-to-run"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#set-the-my_app_uwsgi-recipe-to-run">Set the <code>my_app_uwsgi</code> recipe to run</a></h4>
<p>Add this line to <code>recipes/default.rb</code>:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-169-1"><a id="__codelineno-169-1" name="__codelineno-169-1" href="#__codelineno-169-1"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;my_flask_server::my_app_uwsgi&#39;</span>
</span></code></pre></div>
<p>Here is the complete file:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-170-1"><a id="__codelineno-170-1" name="__codelineno-170-1" href="#__codelineno-170-1"></a><span class="c1">#</span>
</span><span id="__span-170-2"><a id="__codelineno-170-2" name="__codelineno-170-2" href="#__codelineno-170-2"></a><span class="c1"># Cookbook Name:: my_flask_server</span>
</span><span id="__span-170-3"><a id="__codelineno-170-3" name="__codelineno-170-3" href="#__codelineno-170-3"></a><span class="c1"># Recipe:: default</span>
</span><span id="__span-170-4"><a id="__codelineno-170-4" name="__codelineno-170-4" href="#__codelineno-170-4"></a><span class="c1">#</span>
</span><span id="__span-170-5"><a id="__codelineno-170-5" name="__codelineno-170-5" href="#__codelineno-170-5"></a><span class="c1"># Copyright (c) 2016 The Authors, All Rights Reserved.</span>
</span><span id="__span-170-6"><a id="__codelineno-170-6" name="__codelineno-170-6" href="#__codelineno-170-6"></a>
</span><span id="__span-170-7"><a id="__codelineno-170-7" name="__codelineno-170-7" href="#__codelineno-170-7"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;apt::default&#39;</span>
</span><span id="__span-170-8"><a id="__codelineno-170-8" name="__codelineno-170-8" href="#__codelineno-170-8"></a>
</span><span id="__span-170-9"><a id="__codelineno-170-9" name="__codelineno-170-9" href="#__codelineno-170-9"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;my_flask_server::my_app_dir&#39;</span>
</span><span id="__span-170-10"><a id="__codelineno-170-10" name="__codelineno-170-10" href="#__codelineno-170-10"></a>
</span><span id="__span-170-11"><a id="__codelineno-170-11" name="__codelineno-170-11" href="#__codelineno-170-11"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;my_flask_server::my_app_python&#39;</span>
</span><span id="__span-170-12"><a id="__codelineno-170-12" name="__codelineno-170-12" href="#__codelineno-170-12"></a>
</span><span id="__span-170-13"><a id="__codelineno-170-13" name="__codelineno-170-13" href="#__codelineno-170-13"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;my_flask_server::my_app_ssh&#39;</span>
</span><span id="__span-170-14"><a id="__codelineno-170-14" name="__codelineno-170-14" href="#__codelineno-170-14"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;my_flask_server::my_app_deploy&#39;</span>
</span><span id="__span-170-15"><a id="__codelineno-170-15" name="__codelineno-170-15" href="#__codelineno-170-15"></a>
</span><span id="__span-170-16"><a id="__codelineno-170-16" name="__codelineno-170-16" href="#__codelineno-170-16"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;my_flask_server::my_app_uwsgi&#39;</span>
</span></code></pre></div>
<h4 id="run-all-tests_5"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#run-all-tests_5">Run all tests</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-171-1"><a id="__codelineno-171-1" name="__codelineno-171-1" href="#__codelineno-171-1"></a><span class="n">chef</span> <span class="n">exec</span> <span class="n">rake</span>
</span></code></pre></div>
<h3 id="install-nginx"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#install-nginx">Install Nginx</a></h3>
<h4 id="add-an-integration-test_5"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#add-an-integration-test_5">Add an integration test</a></h4>
<p>Rename <code>test/integration/default/serverspec/default_spec.rb</code> to <code>test/integration/default/serverspec/my_app_nginx_spec.rb</code> </p>
<p>Replace the contents of <code>my_app_nginx_spec.rb</code> with this code:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-172-1"><a id="__codelineno-172-1" name="__codelineno-172-1" href="#__codelineno-172-1"></a><span class="nb">require</span><span class="w"> </span><span class="s1">&#39;spec_helper&#39;</span>
</span><span id="__span-172-2"><a id="__codelineno-172-2" name="__codelineno-172-2" href="#__codelineno-172-2"></a>
</span><span id="__span-172-3"><a id="__codelineno-172-3" name="__codelineno-172-3" href="#__codelineno-172-3"></a><span class="n">describe</span><span class="w"> </span><span class="s1">&#39;my_flask_server::my_app_nginx&#39;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-172-4"><a id="__codelineno-172-4" name="__codelineno-172-4" href="#__codelineno-172-4"></a><span class="w">  </span><span class="c1"># Serverspec examples can be found at</span>
</span><span id="__span-172-5"><a id="__codelineno-172-5" name="__codelineno-172-5" href="#__codelineno-172-5"></a><span class="w">  </span><span class="c1"># http://serverspec.org/resource_types.html</span>
</span><span id="__span-172-6"><a id="__codelineno-172-6" name="__codelineno-172-6" href="#__codelineno-172-6"></a>
</span><span id="__span-172-7"><a id="__codelineno-172-7" name="__codelineno-172-7" href="#__codelineno-172-7"></a><span class="w">  </span><span class="c1"># verify nginx package</span>
</span><span id="__span-172-8"><a id="__codelineno-172-8" name="__codelineno-172-8" href="#__codelineno-172-8"></a><span class="w">  </span><span class="n">describe</span><span class="w"> </span><span class="n">package</span><span class="p">(</span><span class="s1">&#39;nginx&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-172-9"><a id="__codelineno-172-9" name="__codelineno-172-9" href="#__codelineno-172-9"></a><span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_installed</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-172-10"><a id="__codelineno-172-10" name="__codelineno-172-10" href="#__codelineno-172-10"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-172-11"><a id="__codelineno-172-11" name="__codelineno-172-11" href="#__codelineno-172-11"></a>
</span><span id="__span-172-12"><a id="__codelineno-172-12" name="__codelineno-172-12" href="#__codelineno-172-12"></a><span class="w">  </span><span class="c1"># verify nginx serice</span>
</span><span id="__span-172-13"><a id="__codelineno-172-13" name="__codelineno-172-13" href="#__codelineno-172-13"></a><span class="w">  </span><span class="n">describe</span><span class="w"> </span><span class="n">service</span><span class="p">(</span><span class="s1">&#39;nginx&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-172-14"><a id="__codelineno-172-14" name="__codelineno-172-14" href="#__codelineno-172-14"></a><span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_enabled</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-172-15"><a id="__codelineno-172-15" name="__codelineno-172-15" href="#__codelineno-172-15"></a><span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_running</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-172-16"><a id="__codelineno-172-16" name="__codelineno-172-16" href="#__codelineno-172-16"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-172-17"><a id="__codelineno-172-17" name="__codelineno-172-17" href="#__codelineno-172-17"></a><span class="k">end</span>
</span></code></pre></div>
<h4 id="create-nginx-site-file"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#create-nginx-site-file">Create Nginx Site File</a></h4>
<p>Create <code>files/default/nginx/my_flask_app</code> file:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-173-1"><a id="__codelineno-173-1" name="__codelineno-173-1" href="#__codelineno-173-1"></a><span class="n">mkdir</span> <span class="n">files</span><span class="p">/</span><span class="k">default</span><span class="p">/</span><span class="n">nginx</span>
</span><span id="__span-173-2"><a id="__codelineno-173-2" name="__codelineno-173-2" href="#__codelineno-173-2"></a><span class="n">chef</span> <span class="n">generate</span> <span class="n">file</span> <span class="n">nginx</span><span class="p">/</span><span class="n">my_flask_app</span>
</span></code></pre></div>
<p>Add this content to the <code>files/default/nginx/my_flask_app</code>:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-174-1"><a id="__codelineno-174-1" name="__codelineno-174-1" href="#__codelineno-174-1"></a>server {
</span><span id="__span-174-2"><a id="__codelineno-174-2" name="__codelineno-174-2" href="#__codelineno-174-2"></a>  listen 80 default_server;
</span><span id="__span-174-3"><a id="__codelineno-174-3" name="__codelineno-174-3" href="#__codelineno-174-3"></a>  listen [::]:80 default_server ipv6only=on;
</span><span id="__span-174-4"><a id="__codelineno-174-4" name="__codelineno-174-4" href="#__codelineno-174-4"></a>
</span><span id="__span-174-5"><a id="__codelineno-174-5" name="__codelineno-174-5" href="#__codelineno-174-5"></a>  # Make site accessible from http://localhost/
</span><span id="__span-174-6"><a id="__codelineno-174-6" name="__codelineno-174-6" href="#__codelineno-174-6"></a>  server_name localhost;
</span><span id="__span-174-7"><a id="__codelineno-174-7" name="__codelineno-174-7" href="#__codelineno-174-7"></a>
</span><span id="__span-174-8"><a id="__codelineno-174-8" name="__codelineno-174-8" href="#__codelineno-174-8"></a>  location / {
</span><span id="__span-174-9"><a id="__codelineno-174-9" name="__codelineno-174-9" href="#__codelineno-174-9"></a>    include uwsgi_params;
</span><span id="__span-174-10"><a id="__codelineno-174-10" name="__codelineno-174-10" href="#__codelineno-174-10"></a>    uwsgi_pass unix:/var/www/my_flask_app/shared/.uwsgi/my_flask_app.sock;
</span><span id="__span-174-11"><a id="__codelineno-174-11" name="__codelineno-174-11" href="#__codelineno-174-11"></a>  }
</span><span id="__span-174-12"><a id="__codelineno-174-12" name="__codelineno-174-12" href="#__codelineno-174-12"></a>}
</span></code></pre></div>
<p>IMPORTANT: Make sure the file uses Unix Line Ending (\n, LF) and UTF-8 encoding. Otherwise you may get weird errors when Chef client runs the script during deployment.</p>
<h4 id="write-the-my_app_nginx-recipe"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#write-the-my_app_nginx-recipe">Write the <code>my_app_nginx</code> recipe</a></h4>
<p>The first step is to create the recipe file, <code>my_app_nginx.rb</code>. Run the following command to generate it:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-175-1"><a id="__codelineno-175-1" name="__codelineno-175-1" href="#__codelineno-175-1"></a><span class="n">chef</span> <span class="n">generate</span> <span class="n">recipe</span> <span class="n">my_app_nginx</span>
</span><span id="__span-175-2"><a id="__codelineno-175-2" name="__codelineno-175-2" href="#__codelineno-175-2"></a><span class="nb">rm </span><span class="n">spec</span><span class="p">/</span><span class="n">unit</span><span class="p">/</span><span class="n">recipes</span><span class="p">/</span><span class="n">my_app_nginx_spec</span><span class="p">.</span><span class="n">rb</span>
</span></code></pre></div>
<p>Write out <code>recipes/my_app_nginx.rb</code> like this:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-176-1"><a id="__codelineno-176-1" name="__codelineno-176-1" href="#__codelineno-176-1"></a><span class="c1">#</span>
</span><span id="__span-176-2"><a id="__codelineno-176-2" name="__codelineno-176-2" href="#__codelineno-176-2"></a><span class="c1"># Cookbook Name:: my_flask_server</span>
</span><span id="__span-176-3"><a id="__codelineno-176-3" name="__codelineno-176-3" href="#__codelineno-176-3"></a><span class="c1"># Recipe:: my_nginx</span>
</span><span id="__span-176-4"><a id="__codelineno-176-4" name="__codelineno-176-4" href="#__codelineno-176-4"></a><span class="c1">#</span>
</span><span id="__span-176-5"><a id="__codelineno-176-5" name="__codelineno-176-5" href="#__codelineno-176-5"></a><span class="c1"># Copyright (c) 2016 The Authors, All Rights Reserved.</span>
</span><span id="__span-176-6"><a id="__codelineno-176-6" name="__codelineno-176-6" href="#__codelineno-176-6"></a>
</span><span id="__span-176-7"><a id="__codelineno-176-7" name="__codelineno-176-7" href="#__codelineno-176-7"></a><span class="c1"># install nginx</span>
</span><span id="__span-176-8"><a id="__codelineno-176-8" name="__codelineno-176-8" href="#__codelineno-176-8"></a><span class="n">package</span><span class="w"> </span><span class="s1">&#39;nginx&#39;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-176-9"><a id="__codelineno-176-9" name="__codelineno-176-9" href="#__codelineno-176-9"></a><span class="w">  </span><span class="ss">:upgrade</span>
</span><span id="__span-176-10"><a id="__codelineno-176-10" name="__codelineno-176-10" href="#__codelineno-176-10"></a><span class="k">end</span>
</span><span id="__span-176-11"><a id="__codelineno-176-11" name="__codelineno-176-11" href="#__codelineno-176-11"></a>
</span><span id="__span-176-12"><a id="__codelineno-176-12" name="__codelineno-176-12" href="#__codelineno-176-12"></a><span class="c1"># start nginx service</span>
</span><span id="__span-176-13"><a id="__codelineno-176-13" name="__codelineno-176-13" href="#__codelineno-176-13"></a><span class="n">service</span><span class="w"> </span><span class="s1">&#39;nginx&#39;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-176-14"><a id="__codelineno-176-14" name="__codelineno-176-14" href="#__codelineno-176-14"></a><span class="w">  </span><span class="n">supports</span><span class="w"> </span><span class="ss">status</span><span class="p">:</span><span class="w"> </span><span class="kp">true</span><span class="p">,</span><span class="w"> </span><span class="ss">restart</span><span class="p">:</span><span class="w"> </span><span class="kp">true</span><span class="p">,</span><span class="w"> </span><span class="ss">reload</span><span class="p">:</span><span class="w"> </span><span class="kp">true</span>
</span><span id="__span-176-15"><a id="__codelineno-176-15" name="__codelineno-176-15" href="#__codelineno-176-15"></a><span class="w">  </span><span class="n">action</span><span class="w"> </span><span class="o">[</span><span class="ss">:enable</span><span class="p">,</span><span class="w"> </span><span class="ss">:start</span><span class="o">]</span>
</span><span id="__span-176-16"><a id="__codelineno-176-16" name="__codelineno-176-16" href="#__codelineno-176-16"></a><span class="k">end</span>
</span><span id="__span-176-17"><a id="__codelineno-176-17" name="__codelineno-176-17" href="#__codelineno-176-17"></a>
</span><span id="__span-176-18"><a id="__codelineno-176-18" name="__codelineno-176-18" href="#__codelineno-176-18"></a><span class="c1"># Uncomment to use a custom nginx.conf</span>
</span><span id="__span-176-19"><a id="__codelineno-176-19" name="__codelineno-176-19" href="#__codelineno-176-19"></a><span class="c1"># cookbook_file &#39;/etc/nginx/nginx.conf&#39; do</span>
</span><span id="__span-176-20"><a id="__codelineno-176-20" name="__codelineno-176-20" href="#__codelineno-176-20"></a><span class="c1">#   source &#39;nginx/nginx.conf&#39;</span>
</span><span id="__span-176-21"><a id="__codelineno-176-21" name="__codelineno-176-21" href="#__codelineno-176-21"></a><span class="c1">#   mode 0640</span>
</span><span id="__span-176-22"><a id="__codelineno-176-22" name="__codelineno-176-22" href="#__codelineno-176-22"></a><span class="c1">#   owner &#39;root&#39;</span>
</span><span id="__span-176-23"><a id="__codelineno-176-23" name="__codelineno-176-23" href="#__codelineno-176-23"></a><span class="c1">#   group &#39;root&#39;</span>
</span><span id="__span-176-24"><a id="__codelineno-176-24" name="__codelineno-176-24" href="#__codelineno-176-24"></a><span class="c1">#   notifies :restart, &#39;service[nginx]&#39;</span>
</span><span id="__span-176-25"><a id="__codelineno-176-25" name="__codelineno-176-25" href="#__codelineno-176-25"></a><span class="c1"># end</span>
</span><span id="__span-176-26"><a id="__codelineno-176-26" name="__codelineno-176-26" href="#__codelineno-176-26"></a>
</span><span id="__span-176-27"><a id="__codelineno-176-27" name="__codelineno-176-27" href="#__codelineno-176-27"></a><span class="c1"># disable default site</span>
</span><span id="__span-176-28"><a id="__codelineno-176-28" name="__codelineno-176-28" href="#__codelineno-176-28"></a><span class="n">link</span><span class="w"> </span><span class="s1">&#39;/etc/nginx/sites-enabled/default&#39;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-176-29"><a id="__codelineno-176-29" name="__codelineno-176-29" href="#__codelineno-176-29"></a><span class="w">  </span><span class="n">action</span><span class="w"> </span><span class="ss">:delete</span>
</span><span id="__span-176-30"><a id="__codelineno-176-30" name="__codelineno-176-30" href="#__codelineno-176-30"></a><span class="w">  </span><span class="n">only_if</span><span class="w"> </span><span class="s1">&#39;test -L /etc/nginx/sites-enabled/default&#39;</span>
</span><span id="__span-176-31"><a id="__codelineno-176-31" name="__codelineno-176-31" href="#__codelineno-176-31"></a><span class="w">  </span><span class="n">notifies</span><span class="w"> </span><span class="ss">:restart</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;service[nginx]&#39;</span>
</span><span id="__span-176-32"><a id="__codelineno-176-32" name="__codelineno-176-32" href="#__codelineno-176-32"></a><span class="k">end</span>
</span><span id="__span-176-33"><a id="__codelineno-176-33" name="__codelineno-176-33" href="#__codelineno-176-33"></a>
</span><span id="__span-176-34"><a id="__codelineno-176-34" name="__codelineno-176-34" href="#__codelineno-176-34"></a><span class="c1"># add my_flask_app site</span>
</span><span id="__span-176-35"><a id="__codelineno-176-35" name="__codelineno-176-35" href="#__codelineno-176-35"></a><span class="n">cookbook_file</span><span class="w"> </span><span class="s1">&#39;/etc/nginx/sites-available/my_flask_app&#39;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-176-36"><a id="__codelineno-176-36" name="__codelineno-176-36" href="#__codelineno-176-36"></a><span class="w">  </span><span class="n">source</span><span class="w"> </span><span class="s1">&#39;nginx/my_flask_app&#39;</span>
</span><span id="__span-176-37"><a id="__codelineno-176-37" name="__codelineno-176-37" href="#__codelineno-176-37"></a><span class="w">  </span><span class="n">mode</span><span class="w"> </span><span class="mo">0640</span>
</span><span id="__span-176-38"><a id="__codelineno-176-38" name="__codelineno-176-38" href="#__codelineno-176-38"></a><span class="w">  </span><span class="n">owner</span><span class="w"> </span><span class="s1">&#39;root&#39;</span>
</span><span id="__span-176-39"><a id="__codelineno-176-39" name="__codelineno-176-39" href="#__codelineno-176-39"></a><span class="w">  </span><span class="n">group</span><span class="w"> </span><span class="s1">&#39;root&#39;</span>
</span><span id="__span-176-40"><a id="__codelineno-176-40" name="__codelineno-176-40" href="#__codelineno-176-40"></a><span class="k">end</span>
</span><span id="__span-176-41"><a id="__codelineno-176-41" name="__codelineno-176-41" href="#__codelineno-176-41"></a>
</span><span id="__span-176-42"><a id="__codelineno-176-42" name="__codelineno-176-42" href="#__codelineno-176-42"></a><span class="c1"># enable my_flask_app site</span>
</span><span id="__span-176-43"><a id="__codelineno-176-43" name="__codelineno-176-43" href="#__codelineno-176-43"></a><span class="n">link</span><span class="w"> </span><span class="s1">&#39;/etc/nginx/sites-enabled/my_flask_app&#39;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-176-44"><a id="__codelineno-176-44" name="__codelineno-176-44" href="#__codelineno-176-44"></a><span class="w">  </span><span class="n">to</span><span class="w"> </span><span class="s1">&#39;/etc/nginx/sites-available/my_flask_app&#39;</span>
</span><span id="__span-176-45"><a id="__codelineno-176-45" name="__codelineno-176-45" href="#__codelineno-176-45"></a><span class="w">  </span><span class="n">notifies</span><span class="w"> </span><span class="ss">:restart</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;service[nginx]&#39;</span>
</span><span id="__span-176-46"><a id="__codelineno-176-46" name="__codelineno-176-46" href="#__codelineno-176-46"></a><span class="k">end</span>
</span></code></pre></div>
<h4 id="set-the-my_app_nginx-recipe-to-run"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#set-the-my_app_nginx-recipe-to-run">Set the <code>my_app_nginx</code> recipe to run</a></h4>
<p>Add this line to <code>recipes/default.rb</code>:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-177-1"><a id="__codelineno-177-1" name="__codelineno-177-1" href="#__codelineno-177-1"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;my_flask_server::my_app_nginx&#39;</span>
</span></code></pre></div>
<p>Here is the complete file:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-178-1"><a id="__codelineno-178-1" name="__codelineno-178-1" href="#__codelineno-178-1"></a><span class="c1">#</span>
</span><span id="__span-178-2"><a id="__codelineno-178-2" name="__codelineno-178-2" href="#__codelineno-178-2"></a><span class="c1"># Cookbook Name:: my_flask_server</span>
</span><span id="__span-178-3"><a id="__codelineno-178-3" name="__codelineno-178-3" href="#__codelineno-178-3"></a><span class="c1"># Recipe:: default</span>
</span><span id="__span-178-4"><a id="__codelineno-178-4" name="__codelineno-178-4" href="#__codelineno-178-4"></a><span class="c1">#</span>
</span><span id="__span-178-5"><a id="__codelineno-178-5" name="__codelineno-178-5" href="#__codelineno-178-5"></a><span class="c1"># Copyright (c) 2016 The Authors, All Rights Reserved.</span>
</span><span id="__span-178-6"><a id="__codelineno-178-6" name="__codelineno-178-6" href="#__codelineno-178-6"></a>
</span><span id="__span-178-7"><a id="__codelineno-178-7" name="__codelineno-178-7" href="#__codelineno-178-7"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;apt::default&#39;</span>
</span><span id="__span-178-8"><a id="__codelineno-178-8" name="__codelineno-178-8" href="#__codelineno-178-8"></a>
</span><span id="__span-178-9"><a id="__codelineno-178-9" name="__codelineno-178-9" href="#__codelineno-178-9"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;my_flask_server::my_app_dir&#39;</span>
</span><span id="__span-178-10"><a id="__codelineno-178-10" name="__codelineno-178-10" href="#__codelineno-178-10"></a>
</span><span id="__span-178-11"><a id="__codelineno-178-11" name="__codelineno-178-11" href="#__codelineno-178-11"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;my_flask_server::my_app_python&#39;</span>
</span><span id="__span-178-12"><a id="__codelineno-178-12" name="__codelineno-178-12" href="#__codelineno-178-12"></a>
</span><span id="__span-178-13"><a id="__codelineno-178-13" name="__codelineno-178-13" href="#__codelineno-178-13"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;my_flask_server::my_app_ssh&#39;</span>
</span><span id="__span-178-14"><a id="__codelineno-178-14" name="__codelineno-178-14" href="#__codelineno-178-14"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;my_flask_server::my_app_deploy&#39;</span>
</span><span id="__span-178-15"><a id="__codelineno-178-15" name="__codelineno-178-15" href="#__codelineno-178-15"></a>
</span><span id="__span-178-16"><a id="__codelineno-178-16" name="__codelineno-178-16" href="#__codelineno-178-16"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;my_flask_server::my_app_uwsgi&#39;</span>
</span><span id="__span-178-17"><a id="__codelineno-178-17" name="__codelineno-178-17" href="#__codelineno-178-17"></a>
</span><span id="__span-178-18"><a id="__codelineno-178-18" name="__codelineno-178-18" href="#__codelineno-178-18"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;my_flask_server::my_app_nginx&#39;</span>
</span></code></pre></div>
<h4 id="run-all-tests_6"><a class="toclink" href="../../build-nginx-server-deploy-python-flask-app-using-chef/#run-all-tests_6">Run all tests</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-179-1"><a id="__codelineno-179-1" name="__codelineno-179-1" href="#__codelineno-179-1"></a><span class="n">chef</span> <span class="n">exec</span> <span class="n">rake</span>
</span></code></pre></div>
<p>Open a browser and navigate to <code>http://default-ubuntu-1404/</code>. You should see the "Hello World!" page of the my_flask application.</p>
    <nav class="md-post__action">
      <a href="../../build-nginx-server-deploy-python-flask-app-using-chef/">
        Continue reading
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2016-01-29 00:00:00">January 29, 2016</time></li>
        
        
          
          <li class="md-meta__item">
            
              1 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="getting-started-with-flashdevelop-on-windows-10"><a class="toclink" href="../../getting-started-flashdevelop-windows-10/">Getting Started with FlashDevelop on Windows 10</a></h2>
<p>FlashDevelop is a free IDE for Windows. You can use it to develop Adobe Flash and AIR applications using ActionScript. </p>
<h3 id="install-chocolatey"><a class="toclink" href="../../getting-started-flashdevelop-windows-10/#install-chocolatey">Install Chocolatey</a></h3>
<p>Chcocolatey is a package manager for Windows.</p>
<p>Open PowerShell as <em>Administrator</em> and run the following command:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nb">iex </span><span class="p">((</span><span class="nb">new-object</span> <span class="n">net</span><span class="p">.</span><span class="n">webclient</span><span class="p">).</span><span class="n">DownloadString</span><span class="p">(</span><span class="s1">&#39;https://chocolatey.org/install.ps1&#39;</span><span class="p">))</span>
</span></code></pre></div>
<h3 id="install-java-8-sdk-32-bit"><a class="toclink" href="../../getting-started-flashdevelop-windows-10/#install-java-8-sdk-32-bit">Install Java 8 SDK 32-bit</a></h3>
<p>FlashDevelop requires a 32-bit java on the system path.</p>
<p>In PowerShell as <em>Administrator</em>:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">choco</span> <span class="n">install</span> <span class="n">jdk8</span> <span class="n">-params</span> <span class="s2">&quot;x64=false&quot;</span>
</span></code></pre></div>
<h3 id="install-flashdevelop"><a class="toclink" href="../../getting-started-flashdevelop-windows-10/#install-flashdevelop">Install FlashDevelop</a></h3>
<p>Download the latest FlashDevelop setup package from <a href="http://www.flashdevelop.org/">www.flashdevelop.org</a> and install it, <code>FlashDevelop-5.0.2.exe</code> at the time of writing.</p>
<h3 id="install-additional-software"><a class="toclink" href="../../getting-started-flashdevelop-windows-10/#install-additional-software">Install Additional Software</a></h3>
<ol>
<li>Start FlashDevelop</li>
<li>Install SDKs and other tools using AppMan, from Tools -&gt; Install Software ...<ul>
<li>Flex SDK + AIR SDK</li>
<li>Flash Player (SA)</li>
</ul>
</li>
<li>Restart FlashDevelop, so that it can detect the installed SDKs and tools properly.</li>
</ol>
<h3 id="create-new-project"><a class="toclink" href="../../getting-started-flashdevelop-windows-10/#create-new-project">Create New Project</a></h3>
<ol>
<li>Create a new project from: Project -&gt; New Project</li>
<li>For project type choose AS3 Project</li>
<li>Set a breakpoint in Main method - Ctrl+Shift+B</li>
<li>Compile - F11</li>
<li>Debug - F5 </li>
</ol>
    <nav class="md-post__action">
      <a href="../../getting-started-flashdevelop-windows-10/">
        Continue reading
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2016-01-13 00:00:00">January 13, 2016</time></li>
        
        
          
          <li class="md-meta__item">
            
              3 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="how-to-install-nginx-on-ubuntu-using-chef"><a class="toclink" href="../../install-nginx-ubuntu-using-chef/">How To Install Nginx On Ubuntu Using Chef</a></h2>
<p>In this post we show how to install NGINX on Ubuntu using <a href="https://www.chef.io/chef/">Chef</a> on Windows 10 workstation.</p>
<p>All commands are executed in PowerShell on a Windows workstation.  </p>
<h3 id="before-you-begin"><a class="toclink" href="../../install-nginx-ubuntu-using-chef/#before-you-begin">Before You Begin</a></h3>
<h4 id="install-chocolatey"><a class="toclink" href="../../install-nginx-ubuntu-using-chef/#install-chocolatey">Install Chocolatey</a></h4>
<p>If you do not have Chocolatey, you can install it by following the instructions on <a href="https://chocolatey.org/">chocolatey.org</a>. You may also see <a href="http://www.swiftsoftwaregroup.com/configure-download-folder-chocolatey-packages/">this post</a> for instructions on how to set the Chocolatey cache location. </p>
<h4 id="install-chef-development-kit-chefdk"><a class="toclink" href="../../install-nginx-ubuntu-using-chef/#install-chef-development-kit-chefdk">Install Chef Development Kit (ChefDK)</a></h4>
<p>In PowerShell as <em>Administrator</em>:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="n">choco</span> <span class="n">install</span> <span class="n">chefdk</span>
</span></code></pre></div>
<h4 id="install-virtualbox-and-vagrant"><a class="toclink" href="../../install-nginx-ubuntu-using-chef/#install-virtualbox-and-vagrant">Install VirtualBox and Vagrant</a></h4>
<p>To install VirtualBox and Vagrant, follow the steps described in <a href="http://www.swiftsoftwaregroup.com/ubuntu-with-vagrant-and-virtualbox-on-windows/">Ubuntu with Vagrant and VirtualBox on Windows</a>.</p>
<h4 id="install-vagrant-plugins"><a class="toclink" href="../../install-nginx-ubuntu-using-chef/#install-vagrant-plugins">Install Vagrant Plugins</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="n">vagrant</span> <span class="n">plugin</span> <span class="n">install</span> <span class="n">vagrant-omnibus</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="n">vagrant</span> <span class="n">plugin</span> <span class="n">install</span> <span class="n">vagrant-berkshelf</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="n">vagrant</span> <span class="n">plugin</span> <span class="n">install</span> <span class="n">vagrant-hostmanager</span>
</span></code></pre></div>
<h3 id="create-chef-cookbook"><a class="toclink" href="../../install-nginx-ubuntu-using-chef/#create-chef-cookbook">Create Chef Cookbook</a></h3>
<p>This directory will become the root of your source repository:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="n">chef</span> <span class="n">generate</span> <span class="n">cookbook</span> <span class="n">my_ubuntu_nginx</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="nb">cd </span><span class="n">my_ubuntu_nginx</span>
</span></code></pre></div>
<h3 id="ensure-the-apt-cache-is-up-to-date"><a class="toclink" href="../../install-nginx-ubuntu-using-chef/#ensure-the-apt-cache-is-up-to-date">Ensure the apt cache is up to date</a></h3>
<h4 id="reference-the-apt-cookbook"><a class="toclink" href="../../install-nginx-ubuntu-using-chef/#reference-the-apt-cookbook">Reference the <code>apt</code> Cookbook</a></h4>
<p>Add this line to <code>metadata.rb</code>:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="n">depends</span><span class="w"> </span><span class="s1">&#39;apt&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;~&gt; 2.9.2&#39;</span>
</span></code></pre></div>
<p>To get the latest version string, run <code>knife cookbook site show apt</code>: </p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="n">chef</span> <span class="n">exec</span> <span class="n">knife</span> <span class="n">cookbook</span> <span class="n">site</span> <span class="n">show</span> <span class="n">apt</span> <span class="p">|</span> <span class="n">grep</span> <span class="n">latest_version</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="n">latest_version</span><span class="p">:</span>     <span class="n">https</span><span class="p">://</span><span class="n">supermarket</span><span class="p">.</span><span class="n">chef</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">api</span><span class="p">/</span><span class="n">v1</span><span class="p">/</span><span class="n">cookbooks</span><span class="p">/</span><span class="n">apt</span><span class="p">/</span><span class="n">versions</span><span class="p">/</span><span class="n">2</span><span class="p">.</span><span class="n">9</span><span class="p">.</span><span class="n">2</span>
</span></code></pre></div>
<p>Here is the complete file:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="nb">name</span><span class="w"> </span><span class="s1">&#39;my_ubuntu_nginx&#39;</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="n">maintainer</span><span class="w"> </span><span class="s1">&#39;The Authors&#39;</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="n">maintainer_email</span><span class="w"> </span><span class="s1">&#39;you@example.com&#39;</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="n">license</span><span class="w"> </span><span class="s1">&#39;all_rights&#39;</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="n">description</span><span class="w"> </span><span class="s1">&#39;Installs/Configures my_ubuntu_nginx&#39;</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="n">long_description</span><span class="w"> </span><span class="s1">&#39;Installs/Configures my_ubuntu_nginx&#39;</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a><span class="n">version</span><span class="w"> </span><span class="s1">&#39;0.1.0&#39;</span>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a><span class="n">depends</span><span class="w"> </span><span class="s1">&#39;apt&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;~&gt; 2.9.2&#39;</span>
</span></code></pre></div>
<h4 id="set-the-apt-cookbooks-default-recipe-to-run"><a class="toclink" href="../../install-nginx-ubuntu-using-chef/#set-the-apt-cookbooks-default-recipe-to-run">Set the apt cookbook's default recipe to run</a></h4>
<p>Add this line to <code>recipes/default.rb</code>:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;apt::default&#39;</span>
</span></code></pre></div>
<p>Here is the complete file:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="c1">#</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="c1"># Cookbook Name:: my_ubuntu_nginx</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="c1"># Recipe:: default</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="c1">#</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="c1"># Copyright (c) 2016 The Authors, All Rights Reserved.</span>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;apt::default&#39;</span>
</span></code></pre></div>
<h4 id="test"><a class="toclink" href="../../install-nginx-ubuntu-using-chef/#test">Test</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="n">chef</span> <span class="n">exec</span> <span class="n">berks</span> <span class="n">install</span>
</span></code></pre></div>
<p>This generates <code>Berksfile.lock</code> file.</p>
<h3 id="configure-nginx"><a class="toclink" href="../../install-nginx-ubuntu-using-chef/#configure-nginx">Configure NGINX</a></h3>
<h4 id="reference-the-nginx-cookbook"><a class="toclink" href="../../install-nginx-ubuntu-using-chef/#reference-the-nginx-cookbook">Reference the nginx cookbook</a></h4>
<p>We need the <code>nginx</code> cookbook for it's <code>nginx::repo</code> recipe. Add this line to <code>metadata.rb</code>:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="n">depends</span><span class="w"> </span><span class="s1">&#39;nginx&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;~&gt; 2.7.6&#39;</span>
</span></code></pre></div>
<p>To get the latest version string, run <code>knife cookbook site show nginx</code>: </p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="n">chef</span> <span class="n">exec</span> <span class="n">knife</span> <span class="n">cookbook</span> <span class="n">site</span> <span class="n">show</span> <span class="n">nginx</span> <span class="p">|</span> <span class="n">grep</span> <span class="n">latest_version</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="n">latest_version</span><span class="p">:</span>     <span class="n">https</span><span class="p">://</span><span class="n">supermarket</span><span class="p">.</span><span class="n">chef</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">api</span><span class="p">/</span><span class="n">v1</span><span class="p">/</span><span class="n">cookbooks</span><span class="p">/</span><span class="n">nginx</span><span class="p">/</span><span class="n">versions</span><span class="p">/</span><span class="n">2</span><span class="p">.</span><span class="n">7</span><span class="p">.</span><span class="n">6</span>
</span></code></pre></div>
<p>Here is the complete file:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="nb">name</span><span class="w"> </span><span class="s1">&#39;my_ubuntu_nginx&#39;</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="n">maintainer</span><span class="w"> </span><span class="s1">&#39;The Authors&#39;</span>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="n">maintainer_email</span><span class="w"> </span><span class="s1">&#39;you@example.com&#39;</span>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="n">license</span><span class="w"> </span><span class="s1">&#39;all_rights&#39;</span>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="n">description</span><span class="w"> </span><span class="s1">&#39;Installs/Configures my_ubuntu_nginx&#39;</span>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="n">long_description</span><span class="w"> </span><span class="s1">&#39;Installs/Configures my_ubuntu_nginx&#39;</span>
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="n">version</span><span class="w"> </span><span class="s1">&#39;0.1.0&#39;</span>
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a>
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a><span class="n">depends</span><span class="w"> </span><span class="s1">&#39;apt&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;~&gt; 2.9.2&#39;</span>
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a><span class="n">depends</span><span class="w"> </span><span class="s1">&#39;nginx&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;~&gt; 2.7.6&#39;</span>
</span></code></pre></div>
<h4 id="write-the-install_nginx-recipe"><a class="toclink" href="../../install-nginx-ubuntu-using-chef/#write-the-install_nginx-recipe">Write the install_nginx recipe</a></h4>
<p>The first step is to create the recipe file, <code>install_nginx.rb</code>. Run the following command to generate it:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="n">chef</span> <span class="n">generate</span> <span class="n">recipe</span> <span class="n">install_nginx</span>
</span></code></pre></div>
<p>Write out <code>recipes/install_nginx.rb</code> like this:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="c1">#</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="c1"># Cookbook Name:: my_ubuntu_nginx</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="c1"># Recipe:: install_nginx</span>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="c1">#</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="c1"># Copyright (c) 2016 The Authors, All Rights Reserved.</span>
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a>
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="c1"># Only needed if you want to install latest stable package from nginx.org</span>
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;nginx::repo&#39;</span>
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a>
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a><span class="n">package</span><span class="w"> </span><span class="s1">&#39;nginx&#39;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-38-11"><a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a><span class="w">  </span><span class="n">action</span><span class="w"> </span><span class="ss">:install</span>
</span><span id="__span-38-12"><a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a><span class="k">end</span>
</span><span id="__span-38-13"><a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a>
</span><span id="__span-38-14"><a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a><span class="n">service</span><span class="w"> </span><span class="s1">&#39;nginx&#39;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-38-15"><a id="__codelineno-38-15" name="__codelineno-38-15" href="#__codelineno-38-15"></a><span class="w">  </span><span class="n">supports</span><span class="w"> </span><span class="ss">status</span><span class="p">:</span><span class="w"> </span><span class="kp">true</span><span class="p">,</span><span class="w"> </span><span class="ss">restart</span><span class="p">:</span><span class="w"> </span><span class="kp">true</span><span class="p">,</span><span class="w"> </span><span class="ss">reload</span><span class="p">:</span><span class="w"> </span><span class="kp">true</span>
</span><span id="__span-38-16"><a id="__codelineno-38-16" name="__codelineno-38-16" href="#__codelineno-38-16"></a><span class="w">  </span><span class="n">action</span><span class="w"> </span><span class="ss">:enable</span>
</span><span id="__span-38-17"><a id="__codelineno-38-17" name="__codelineno-38-17" href="#__codelineno-38-17"></a><span class="k">end</span>
</span></code></pre></div>
<h4 id="set-the-install_nginx-recipe-to-run"><a class="toclink" href="../../install-nginx-ubuntu-using-chef/#set-the-install_nginx-recipe-to-run">Set the install_nginx recipe to run</a></h4>
<p>Add this line to <code>cookbooks/my_web_server/recipes/default.rb</code>:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;my_ubuntu_nginx::install_nginx&#39;</span>
</span></code></pre></div>
<p>Here is the complete file:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="c1">#</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="c1"># Cookbook Name:: my_ubuntu_nginx</span>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="c1"># Recipe:: default</span>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="c1">#</span>
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="c1"># Copyright (c) 2016 The Authors, All Rights Reserved.</span>
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a>
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;apt::default&#39;</span>
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;my_ubuntu_nginx::install_nginx&#39;</span>
</span></code></pre></div>
<h4 id="update-the-integration-test"><a class="toclink" href="../../install-nginx-ubuntu-using-chef/#update-the-integration-test">Update the integration test</a></h4>
<p>Replace the contents of <code>test/integration/default/serverspec/default_spec.rb</code> with this code:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="nb">require</span><span class="w"> </span><span class="s1">&#39;spec_helper&#39;</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="n">describe</span><span class="w"> </span><span class="s1">&#39;my_ubuntu_nginx::default&#39;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="w">  </span><span class="c1"># Serverspec examples can be found at</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="w">  </span><span class="c1"># http://serverspec.org/resource_types.html</span>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="w">  </span><span class="n">describe</span><span class="w"> </span><span class="n">package</span><span class="p">(</span><span class="s1">&#39;nginx&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_installed</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a>
</span><span id="__span-41-10"><a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a><span class="w">  </span><span class="n">describe</span><span class="w"> </span><span class="n">service</span><span class="p">(</span><span class="s1">&#39;nginx&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-41-11"><a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a><span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_enabled</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-41-12"><a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a><span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be_running</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-41-13"><a id="__codelineno-41-13" name="__codelineno-41-13" href="#__codelineno-41-13"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-41-14"><a id="__codelineno-41-14" name="__codelineno-41-14" href="#__codelineno-41-14"></a><span class="k">end</span>
</span></code></pre></div>
<h3 id="test_1"><a class="toclink" href="../../install-nginx-ubuntu-using-chef/#test_1">Test</a></h3>
<h4 id="ruby-lint"><a class="toclink" href="../../install-nginx-ubuntu-using-chef/#ruby-lint">Ruby Lint</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="n">chef</span> <span class="n">exec</span> <span class="n">rubocop</span>
</span></code></pre></div>
<h4 id="chef-lint"><a class="toclink" href="../../install-nginx-ubuntu-using-chef/#chef-lint">Chef Lint</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="n">chef</span> <span class="n">exec</span> <span class="n">foodcritic</span> <span class="p">.</span>
</span></code></pre></div>
<h4 id="unit-tests"><a class="toclink" href="../../install-nginx-ubuntu-using-chef/#unit-tests">Unit Tests</a></h4>
<p>Install / Update cookbooks:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="n">chef</span> <span class="n">exec</span> <span class="n">berks</span> <span class="n">install</span>
</span></code></pre></div>
<p>Create a <code>.rspec</code> file:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="n">touch</span> <span class="p">.</span><span class="n">rspec</span>
</span></code></pre></div>
<p>Paste these lines in <code>.rspec</code></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>--color
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>--format documentation
</span></code></pre></div>
<p>Run: </p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="n">chef</span> <span class="n">exec</span> <span class="n">rspec</span>
</span></code></pre></div>
<h4 id="integration-tests"><a class="toclink" href="../../install-nginx-ubuntu-using-chef/#integration-tests">Integration Tests</a></h4>
<p>Update <code>.kitchen.yml</code> to include the Ubuntu platform only. This is how it should look:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="nn">---</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="nt">driver</span><span class="p">:</span>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vagrant</span>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="w">  </span><span class="nt">network</span><span class="p">:</span>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;private_network&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;dhcp&quot;</span><span class="p p-Indicator">}]</span>
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a>
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a><span class="nt">provisioner</span><span class="p">:</span>
</span><span id="__span-48-8"><a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">chef_zero</span>
</span><span id="__span-48-9"><a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a>
</span><span id="__span-48-10"><a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a><span class="nt">platforms</span><span class="p">:</span>
</span><span id="__span-48-11"><a id="__codelineno-48-11" name="__codelineno-48-11" href="#__codelineno-48-11"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-14.04</span>
</span><span id="__span-48-12"><a id="__codelineno-48-12" name="__codelineno-48-12" href="#__codelineno-48-12"></a>
</span><span id="__span-48-13"><a id="__codelineno-48-13" name="__codelineno-48-13" href="#__codelineno-48-13"></a><span class="nt">suites</span><span class="p">:</span>
</span><span id="__span-48-14"><a id="__codelineno-48-14" name="__codelineno-48-14" href="#__codelineno-48-14"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
</span><span id="__span-48-15"><a id="__codelineno-48-15" name="__codelineno-48-15" href="#__codelineno-48-15"></a><span class="w">    </span><span class="nt">run_list</span><span class="p">:</span>
</span><span id="__span-48-16"><a id="__codelineno-48-16" name="__codelineno-48-16" href="#__codelineno-48-16"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">recipe[my_ubuntu_nginx::default]</span>
</span></code></pre></div>
<p>Run the integration tests:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="n">chef</span> <span class="n">exec</span> <span class="n">kitchen</span> <span class="n">test</span> <span class="p">-</span><span class="n">-destroy</span><span class="p">=</span><span class="n">never</span>
</span></code></pre></div>
    <nav class="md-post__action">
      <a href="../../install-nginx-ubuntu-using-chef/">
        Continue reading
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2015-11-25 00:00:00">November 25, 2015</time></li>
        
        
          
          <li class="md-meta__item">
            
              3 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="how-to-use-berkshelf-chef-zero-vagrant-and-virtualbox"><a class="toclink" href="../../how-to-use-berkshelf-chef-zero-vagrant-and-virtualbox/">How to use Berkshelf, Chef Zero, Vagrant and VirtualBox</a></h2>
<p>In this post we show how you can use <a href="http://berkshelf.com/">Berkshelf</a>, <a href="https://www.chef.io/chef/">Chef Zero</a>, <a href="https://www.vagrantup.com/">Vagrant</a>, and <a href="https://www.virtualbox.org/">VirtualBox</a> to provision Ubuntu 14.04 guest on Windows 10 host.</p>
<h3 id="before-you-begin"><a class="toclink" href="../../how-to-use-berkshelf-chef-zero-vagrant-and-virtualbox/#before-you-begin">Before You Begin</a></h3>
<p>You need VirtualBox and Vagrant installed. To do that, you can follow the steps described in <a href="../ubuntu-with-vagrant-and-virtualbox-on-windows/">Ubuntu with Vagrant and VirtualBox on Windows</a>.</p>
<h3 id="install-vagrant-omnibus-plugin"><a class="toclink" href="../../how-to-use-berkshelf-chef-zero-vagrant-and-virtualbox/#install-vagrant-omnibus-plugin">Install Vagrant-Omnibus Plugin</a></h3>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">vagrant</span> <span class="n">plugin</span> <span class="n">install</span> <span class="n">vagrant-omnibus</span>
</span></code></pre></div>
<h3 id="install-vagrant-berkshelf-plugin"><a class="toclink" href="../../how-to-use-berkshelf-chef-zero-vagrant-and-virtualbox/#install-vagrant-berkshelf-plugin">Install Vagrant-Berkshelf Plugin</a></h3>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="n">vagrant</span> <span class="n">plugin</span> <span class="n">install</span> <span class="n">vagrant-berkshelf</span>
</span></code></pre></div>
<h3 id="install-chef-development-kit-chefdk"><a class="toclink" href="../../how-to-use-berkshelf-chef-zero-vagrant-and-virtualbox/#install-chef-development-kit-chefdk">Install Chef Development Kit (ChefDK)</a></h3>
<p>In PowerShell as <em>Administrator</em>:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="n">choco</span> <span class="n">install</span> <span class="n">chefdk</span>
</span></code></pre></div>
<h3 id="install-knife-solo"><a class="toclink" href="../../how-to-use-berkshelf-chef-zero-vagrant-and-virtualbox/#install-knife-solo">Install Knife Solo</a></h3>
<p>At this time we only need knife solo to generate an empty Chef repository that is compatible with Chef Zero. For more information see <a href="https://matschaffer.github.io/knife-solo/">Knife Solo</a>.</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="n">chef</span> <span class="n">gem</span> <span class="n">install</span> <span class="n">knife-solo</span>
</span></code></pre></div>
<h3 id="create-chef-repository"><a class="toclink" href="../../how-to-use-berkshelf-chef-zero-vagrant-and-virtualbox/#create-chef-repository">Create Chef Repository</a></h3>
<h4 id="create-a-chef-repo-directory"><a class="toclink" href="../../how-to-use-berkshelf-chef-zero-vagrant-and-virtualbox/#create-a-chef-repo-directory">Create a chef-repo directory</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="n">mkdir</span> <span class="n">ubuntu-chef-repo</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="nb">cd </span><span class="n">ubuntu-chef-repo</span>
</span></code></pre></div>
<h4 id="setup-the-the-chef-repo-directory"><a class="toclink" href="../../how-to-use-berkshelf-chef-zero-vagrant-and-virtualbox/#setup-the-the-chef-repo-directory">Setup the the chef-repo directory</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">touch</span> <span class="n">Berksfile</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="n">chef</span> <span class="n">exec</span> <span class="n">knife</span> <span class="n">solo</span> <span class="n">init</span> <span class="p">.</span> <span class="p">-</span><span class="n">-no-git</span>
</span></code></pre></div>
<p>Paste this into the <code>Berksfile</code>:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">source</span><span class="w"> </span><span class="s1">&#39;https://supermarket.chef.io&#39;</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="n">cookbook</span><span class="w"> </span><span class="s1">&#39;main&#39;</span><span class="p">,</span><span class="w"> </span><span class="ss">path</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;./site-cookbooks/main&#39;</span>
</span></code></pre></div>
<h3 id="create-new-cookbook"><a class="toclink" href="../../how-to-use-berkshelf-chef-zero-vagrant-and-virtualbox/#create-new-cookbook">Create New Cookbook</a></h3>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="nb">cd </span><span class="n">site-cookbooks</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="n">chef</span> <span class="n">exec</span> <span class="n">berks</span> <span class="n">cookbook</span> <span class="n">main</span> <span class="p">-</span><span class="n">-skip-git</span> <span class="p">-</span><span class="n">-skip-test-kitchen</span> <span class="p">-</span><span class="n">-no-foodcritic</span> <span class="p">-</span><span class="n">-no-chef-minitest</span> <span class="p">-</span><span class="n">-no-bundler</span> <span class="p">-</span><span class="n">-skip-vagrant</span>
</span></code></pre></div>
<p>Check the structure of the <code>main</code> cookbook:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="n">tree</span> <span class="p">/</span><span class="n">F</span> <span class="n">main</span>
</span></code></pre></div>
<p>It should have the following structure:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>   Berksfile
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>   CHANGELOG.md
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>   chefignore
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>   LICENSE
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>   metadata.rb
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>   README.md
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>   Thorfile
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>attributes
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a>files
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a>   default
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a>libraries
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a>providers
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a>recipes
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a>       default.rb
</span><span id="__span-27-16"><a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a>
</span><span id="__span-27-17"><a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a>resources
</span><span id="__span-27-18"><a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a>templates
</span><span id="__span-27-19"><a id="__codelineno-27-19" name="__codelineno-27-19" href="#__codelineno-27-19"></a>    default
</span></code></pre></div>
<h4 id="add-the-apt-cookbook-as-a-dependency"><a class="toclink" href="../../how-to-use-berkshelf-chef-zero-vagrant-and-virtualbox/#add-the-apt-cookbook-as-a-dependency">Add the Apt Cookbook as a Dependency</a></h4>
<p>The <code>apt</code> cookbook runs the <code>apt-get update</code> command on the guest system. See <a href="https://supermarket.chef.io/cookbooks/apt">apt Cookbook - Chef Supermarket</a> for details.</p>
<p>Open the <code>site-cookbooks/main/metadata.rb</code> file and add the following code at the end (the version may be different than 2.9.2):</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="n">depends</span><span class="w"> </span><span class="s1">&#39;apt&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;~&gt; 2.9.2&#39;</span>
</span></code></pre></div>
<p>This is how the final file should look like:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="nb">name</span><span class="w">             </span><span class="s1">&#39;main&#39;</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="n">maintainer</span><span class="w">       </span><span class="s1">&#39;YOUR_NAME&#39;</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="n">maintainer_email</span><span class="w"> </span><span class="s1">&#39;YOUR_EMAIL&#39;</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="n">license</span><span class="w">          </span><span class="s1">&#39;All rights reserved&#39;</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="n">description</span><span class="w">      </span><span class="s1">&#39;Installs/Configures main&#39;</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="n">long_description</span><span class="w"> </span><span class="s1">&#39;Installs/Configures main&#39;</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="n">version</span><span class="w">          </span><span class="s1">&#39;0.1.0&#39;</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="n">depends</span><span class="w"> </span><span class="s1">&#39;apt&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;~&gt; 2.9.2&#39;</span>
</span></code></pre></div>
<h4 id="include-the-apt-cookbook-in-the-default-recipe"><a class="toclink" href="../../how-to-use-berkshelf-chef-zero-vagrant-and-virtualbox/#include-the-apt-cookbook-in-the-default-recipe">Include the Apt Cookbook in the Default Recipe</a></h4>
<p>Open <code>site-cookbooks/main/recipes/default.rb</code> and add the following code at the end:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;apt::default&#39;</span>
</span></code></pre></div>
<p>The final file looks like this:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="c1">#</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="c1"># Cookbook Name:: main</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="c1"># Recipe:: default</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="c1">#</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="c1"># Copyright (C) 2016 YOUR_NAME</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="c1">#</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="c1"># All rights reserved - Do Not Redistribute</span>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="c1">#</span>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a>
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a><span class="n">include_recipe</span><span class="w"> </span><span class="s1">&#39;apt::default&#39;</span>
</span></code></pre></div>
<h4 id="test"><a class="toclink" href="../../how-to-use-berkshelf-chef-zero-vagrant-and-virtualbox/#test">Test</a></h4>
<p>This will generate Berksfile.lock</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="n">berks</span> <span class="n">install</span>
</span></code></pre></div>
<h3 id="create-vagrantfile"><a class="toclink" href="../../how-to-use-berkshelf-chef-zero-vagrant-and-virtualbox/#create-vagrantfile">Create Vagrantfile</a></h3>
<p>Go to the Chef Repo root (<code>ubuntu-chef-repo</code>).</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="n">touch</span> <span class="n">Vagrantfile</span>
</span></code></pre></div>
<p>Open <code>Vagrantfile</code> and replace its content with the following one:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="c1"># -*- mode: ruby -*-</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="c1"># vi: set ft=ruby :</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="w">  </span><span class="c1"># Every Vagrant development environment requires a box. You can search for</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="w">  </span><span class="c1"># boxes at https://atlas.hashicorp.com/search.</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="w">  </span><span class="c1">#</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="w">  </span><span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ubuntu/trusty64&quot;</span>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a><span class="w">  </span><span class="c1"># Provider-specific configuration so you can fine-tune various</span>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a><span class="w">  </span><span class="c1"># backing providers for Vagrant. These expose provider-specific options.</span>
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a><span class="w">  </span><span class="c1">#</span>
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a><span class="w">  </span><span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provider</span><span class="w"> </span><span class="s2">&quot;virtualbox&quot;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">vb</span><span class="o">|</span>
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a><span class="w">    </span><span class="c1"># For a complete reference, please see the online documentation at</span>
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a><span class="w">    </span><span class="c1"># https://docs.vagrantup.com/v2/virtualbox/configuration.html</span>
</span><span id="__span-34-16"><a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a>
</span><span id="__span-34-17"><a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a><span class="w">    </span><span class="c1"># Name used in Oracle VM VirtualBox Manager GUI</span>
</span><span id="__span-34-18"><a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a><span class="w">    </span><span class="n">vb</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;berkshelf-ubuntu-kitchen&quot;</span>
</span><span id="__span-34-19"><a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a>
</span><span id="__span-34-20"><a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a><span class="w">    </span><span class="c1"># Customize the amount of memory on the VM (in MB):</span>
</span><span id="__span-34-21"><a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a><span class="w">    </span><span class="n">vb</span><span class="o">.</span><span class="n">memory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2048&quot;</span>
</span><span id="__span-34-22"><a id="__codelineno-34-22" name="__codelineno-34-22" href="#__codelineno-34-22"></a>
</span><span id="__span-34-23"><a id="__codelineno-34-23" name="__codelineno-34-23" href="#__codelineno-34-23"></a><span class="w">    </span><span class="c1"># Customize the amount of video memory on the VM (in MB):</span>
</span><span id="__span-34-24"><a id="__codelineno-34-24" name="__codelineno-34-24" href="#__codelineno-34-24"></a><span class="w">    </span><span class="n">vb</span><span class="o">.</span><span class="n">customize</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;modifyvm&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">:id</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;--vram&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;128&quot;</span><span class="o">]</span>
</span><span id="__span-34-25"><a id="__codelineno-34-25" name="__codelineno-34-25" href="#__codelineno-34-25"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-34-26"><a id="__codelineno-34-26" name="__codelineno-34-26" href="#__codelineno-34-26"></a>
</span><span id="__span-34-27"><a id="__codelineno-34-27" name="__codelineno-34-27" href="#__codelineno-34-27"></a><span class="w">  </span><span class="c1"># Install the latest version of Chef.</span>
</span><span id="__span-34-28"><a id="__codelineno-34-28" name="__codelineno-34-28" href="#__codelineno-34-28"></a><span class="w">  </span><span class="c1"># For more information see https://github.com/chef/vagrant-omnibus</span>
</span><span id="__span-34-29"><a id="__codelineno-34-29" name="__codelineno-34-29" href="#__codelineno-34-29"></a><span class="w">  </span><span class="c1">#</span>
</span><span id="__span-34-30"><a id="__codelineno-34-30" name="__codelineno-34-30" href="#__codelineno-34-30"></a><span class="w">  </span><span class="n">config</span><span class="o">.</span><span class="n">omnibus</span><span class="o">.</span><span class="n">chef_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:latest</span>
</span><span id="__span-34-31"><a id="__codelineno-34-31" name="__codelineno-34-31" href="#__codelineno-34-31"></a>
</span><span id="__span-34-32"><a id="__codelineno-34-32" name="__codelineno-34-32" href="#__codelineno-34-32"></a><span class="w">  </span><span class="c1"># Enabling the Berkshelf plugin.</span>
</span><span id="__span-34-33"><a id="__codelineno-34-33" name="__codelineno-34-33" href="#__codelineno-34-33"></a><span class="w">  </span><span class="n">config</span><span class="o">.</span><span class="n">berkshelf</span><span class="o">.</span><span class="n">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kp">true</span>
</span><span id="__span-34-34"><a id="__codelineno-34-34" name="__codelineno-34-34" href="#__codelineno-34-34"></a>
</span><span id="__span-34-35"><a id="__codelineno-34-35" name="__codelineno-34-35" href="#__codelineno-34-35"></a><span class="w">  </span><span class="c1"># Provision with Chef Zero</span>
</span><span id="__span-34-36"><a id="__codelineno-34-36" name="__codelineno-34-36" href="#__codelineno-34-36"></a><span class="w">  </span><span class="c1">#</span>
</span><span id="__span-34-37"><a id="__codelineno-34-37" name="__codelineno-34-37" href="#__codelineno-34-37"></a><span class="w">  </span><span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span><span class="w"> </span><span class="ss">:chef_zero</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">chef</span><span class="o">|</span>
</span><span id="__span-34-38"><a id="__codelineno-34-38" name="__codelineno-34-38" href="#__codelineno-34-38"></a><span class="w">    </span><span class="c1"># Specify the local paths where Chef data is stored</span>
</span><span id="__span-34-39"><a id="__codelineno-34-39" name="__codelineno-34-39" href="#__codelineno-34-39"></a><span class="w">    </span><span class="n">chef</span><span class="o">.</span><span class="n">cookbooks_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s1">&#39;cookbooks&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;site-cookbooks&#39;</span><span class="w"> </span><span class="o">]</span>
</span><span id="__span-34-40"><a id="__codelineno-34-40" name="__codelineno-34-40" href="#__codelineno-34-40"></a><span class="w">    </span><span class="n">chef</span><span class="o">.</span><span class="n">data_bags_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;data_bags&quot;</span>
</span><span id="__span-34-41"><a id="__codelineno-34-41" name="__codelineno-34-41" href="#__codelineno-34-41"></a><span class="w">    </span><span class="n">chef</span><span class="o">.</span><span class="n">nodes_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;nodes&quot;</span>
</span><span id="__span-34-42"><a id="__codelineno-34-42" name="__codelineno-34-42" href="#__codelineno-34-42"></a><span class="w">    </span><span class="n">chef</span><span class="o">.</span><span class="n">roles_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;roles&quot;</span>
</span><span id="__span-34-43"><a id="__codelineno-34-43" name="__codelineno-34-43" href="#__codelineno-34-43"></a>
</span><span id="__span-34-44"><a id="__codelineno-34-44" name="__codelineno-34-44" href="#__codelineno-34-44"></a><span class="w">    </span><span class="c1"># Add a recipe</span>
</span><span id="__span-34-45"><a id="__codelineno-34-45" name="__codelineno-34-45" href="#__codelineno-34-45"></a><span class="w">    </span><span class="n">chef</span><span class="o">.</span><span class="n">add_recipe</span><span class="w"> </span><span class="s2">&quot;main::default&quot;</span>
</span><span id="__span-34-46"><a id="__codelineno-34-46" name="__codelineno-34-46" href="#__codelineno-34-46"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-34-47"><a id="__codelineno-34-47" name="__codelineno-34-47" href="#__codelineno-34-47"></a><span class="k">end</span>
</span></code></pre></div>
<h3 id="test_1"><a class="toclink" href="../../how-to-use-berkshelf-chef-zero-vagrant-and-virtualbox/#test_1">Test</a></h3>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="n">vagrant</span> <span class="n">up</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="n">vagrant</span> <span class="n">provision</span>
</span></code></pre></div>
    <nav class="md-post__action">
      <a href="../../how-to-use-berkshelf-chef-zero-vagrant-and-virtualbox/">
        Continue reading
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2015-11-22 00:00:00">November 22, 2015</time></li>
        
        
          
          <li class="md-meta__item">
            
              2 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="provision-chef-with-vagrant-omnibus-plugin"><a class="toclink" href="../../provision-chef-vagrant-omnibus-plugin/">Provision Chef with Vagrant-Omnibus Plugin</a></h2>
<p>In this post we show how you can provision <a href="https://www.chef.io/chef/">Chef</a> from Vagrant using the <code>vagrant-omnibus</code> plugin. This post is for Ubuntu 14.04 guest running in VirtualBox on Windows 10 host.</p>
<h3 id="prerequisites"><a class="toclink" href="../../provision-chef-vagrant-omnibus-plugin/#prerequisites">Prerequisites</a></h3>
<p>You need VirtualBox and Vagrant installed. To do that, you can follow the steps described in <a href="http://www.swiftsoftwaregroup.com/ubuntu-with-vagrant-and-virtualbox-on-windows/">Ubuntu with Vagrant and VirtualBox on Windows</a>.</p>
<h3 id="install-chef-development-kit-chefdk"><a class="toclink" href="../../provision-chef-vagrant-omnibus-plugin/#install-chef-development-kit-chefdk">Install Chef Development Kit (ChefDK)</a></h3>
<p>In PowerShell as <em>Administrator</em>:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">choco</span> <span class="n">install</span> <span class="n">chefdk</span>
</span></code></pre></div>
<h3 id="provision-chef"><a class="toclink" href="../../provision-chef-vagrant-omnibus-plugin/#provision-chef">Provision Chef</a></h3>
<p>Before you can use Chef Solo, Chef Zero, or Chef Client for provisioning, you need to install the latest Chef client on the guest. This can be done with a shell script or with a Vagrant plugin called <code>vagrant-omnibus</code>.  </p>
<p>In PowerShell:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">vagrant</span> <span class="n">plugin</span> <span class="n">install</span> <span class="n">vagrant-omnibus</span>
</span></code></pre></div>
<p>Open <code>Vagrantfile</code> and add the following code at the end of the configuration:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1"># Install the latest version of Chef.</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="c1"># For more information see https://github.com/chef/vagrant-omnibus</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="c1">#</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="n">config</span><span class="o">.</span><span class="n">omnibus</span><span class="o">.</span><span class="n">chef_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:latest</span>
</span></code></pre></div>
<p>The complete <code>Vagrantfile</code> file should look like this:</p>
<div class="language-ruby highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1"># -*- mode: ruby -*-</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="c1"># vi: set ft=ruby :</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="c1"># All Vagrant configuration is done below. The &quot;2&quot; in Vagrant.configure</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="c1"># configures the configuration version (we support older styles for</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="c1"># backwards compatibility). Please don&#39;t change it unless you know what</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="c1"># you&#39;re doing.</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="c1">#</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="w">  </span><span class="c1"># Every Vagrant development environment requires a box. You can search for</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="w">  </span><span class="c1"># boxes at https://atlas.hashicorp.com/search.</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="w">  </span><span class="c1">#</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="w">  </span><span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ubuntu/trusty64&quot;</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="w">  </span><span class="c1"># Provider-specific configuration so you can fine-tune various</span>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="w">  </span><span class="c1"># backing providers for Vagrant. These expose provider-specific options.</span>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="w">  </span><span class="c1">#</span>
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="w">  </span><span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provider</span><span class="w"> </span><span class="s2">&quot;virtualbox&quot;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">vb</span><span class="o">|</span>
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a><span class="w">    </span><span class="c1"># For a complete reference, please see the online documentation at</span>
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a><span class="w">    </span><span class="c1"># https://docs.vagrantup.com/v2/virtualbox/configuration.html</span>
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a><span class="w">    </span><span class="c1"># Name used in Oracle VM VirtualBox Manager GUI</span>
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a><span class="w">    </span><span class="n">vb</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Ubuntu-x64-Vagrant&quot;</span>
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a>
</span><span id="__span-8-26"><a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a><span class="w">    </span><span class="c1"># Customize the amount of memory on the VM (in MB):</span>
</span><span id="__span-8-27"><a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a><span class="w">    </span><span class="n">vb</span><span class="o">.</span><span class="n">memory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2048&quot;</span>
</span><span id="__span-8-28"><a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a>
</span><span id="__span-8-29"><a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a><span class="w">    </span><span class="c1"># Customize the amount of video memory on the VM (in MB):</span>
</span><span id="__span-8-30"><a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a><span class="w">    </span><span class="n">vb</span><span class="o">.</span><span class="n">customize</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;modifyvm&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">:id</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;--vram&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;128&quot;</span><span class="o">]</span>
</span><span id="__span-8-31"><a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a><span class="w">  </span><span class="k">end</span>
</span><span id="__span-8-32"><a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a>
</span><span id="__span-8-33"><a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a><span class="w">  </span><span class="c1"># Install the latest version of Chef.</span>
</span><span id="__span-8-34"><a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a><span class="w">  </span><span class="c1"># For more information see https://github.com/chef/vagrant-omnibus</span>
</span><span id="__span-8-35"><a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a><span class="w">  </span><span class="c1">#</span>
</span><span id="__span-8-36"><a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a><span class="w">  </span><span class="n">config</span><span class="o">.</span><span class="n">omnibus</span><span class="o">.</span><span class="n">chef_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:latest</span>
</span><span id="__span-8-37"><a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a><span class="k">end</span>
</span></code></pre></div>
<h3 id="test"><a class="toclink" href="../../provision-chef-vagrant-omnibus-plugin/#test">Test</a></h3>
<p>Finally launch and provision the Vagrant box. It should install the latest Chef Client:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">vagrant</span> <span class="n">reload</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="n">vagrant</span> <span class="n">provision</span>
</span></code></pre></div>
    <nav class="md-post__action">
      <a href="../../provision-chef-vagrant-omnibus-plugin/">
        Continue reading
      </a>
    </nav>
  </div>
</article>
      
      
        
          



<nav class="md-pagination">
  <a class="md-pagination__link" href="../..">1</a> <span class="md-pagination__dots">..</span> <a class="md-pagination__link" href="../7/">7</a> <a class="md-pagination__link" href="../8/">8</a> <span class="md-pagination__current">9</span> <a class="md-pagination__link" href="../10/">10</a> <a class="md-pagination__link" href="../11/">11</a> <span class="md-pagination__dots">..</span> <a class="md-pagination__link" href="../20/">20</a>
</nav>
        
      
    </div>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2001 - 2024 Swift Software Group, Inc.
    </div>
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  
    
  


  
    
  



  


<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        </label>
      </li>
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="github" checked>
          <span class="task-list-indicator"></span>
          GitHub
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.tracking", "navigation.top", "search.suggest", "search.share", "search.highlight"], "search": "../../assets/javascripts/workers/search.c011b7c0.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.7389ff0e.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>