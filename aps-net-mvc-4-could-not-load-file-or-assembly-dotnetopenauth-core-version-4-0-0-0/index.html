<!DOCTYPE html>
<html lang="en">
<head>  
<title>ASP.NET MVC 4: Could not load file or assembly DotNetOpenAuth.Core, Version=4.0.0.0 | Swift Software Group</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="author" content="Swift Software Group">
<meta name="generator" content="Jekyll v4.2.0">
<link rel="canonical" href="/aps-net-mvc-4-could-not-load-file-or-assembly-dotnetopenauth-core-version-4-0-0-0/">


<link rel="stylesheet" href="/assets/css/frame.css">


<link rel="stylesheet" href="/assets/css/classes.css">

<link rel="alternate" href="/feed.xml" type="application/atom+xml" title="Swift Software Group">



<script src="//swiftsoftwaregroup.disqus.com/embed.js" async></script>



<script async src="https://www.googletagmanager.com/gtag/js?id=UA-37864402-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-37864402-1');
</script>

</head>




<header>
  <a href="/" class="title">Swift Software Group</a>
  <nav><a aria-label="Blog" href="/" ><span aria-hidden="true">Blog</span></a><a aria-label="" href="" ><span aria-hidden="true"></span></a></nav>

</header>

<article>
  <header>
  <h1><a href="/aps-net-mvc-4-could-not-load-file-or-assembly-dotnetopenauth-core-version-4-0-0-0/">ASP.NET MVC 4: Could not load file or assembly DotNetOpenAuth.Core, Version=4.0.0.0</a></h1><time datetime="2013-05-12T00:00:00-07:00">May 12, 2013</time>
</header>

  <p>I got this error in an ASP.NET MVC 4 application after installing DotnetOpenAuth via the Package Manager Console:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Could not load file or assembly 'DotNetOpenAuth.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=2780ccd10d57b246' or one of its dependencies. The located assembly's manifest definition does not match the assembly reference. (Exception from HRESULT: 0x80131040)
</code></pre></div></div>

<p>The application was actually upgraded earlier from ASP.NET MVC 3, i.e. it was not autogenerated by Visual Studio 2012. The pre-binding info in the exception was:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>=== Pre-bind state information ===
LOG: User = NT AUTHORITY\NETWORK SERVICE
LOG: DisplayName = DotNetOpenAuth.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=2780ccd10d57b246
    (Fully-specified)
LOG: Appbase = file:///
LOG: Initial PrivatePath = \bin
Calling assembly : Microsoft.Web.WebPages.OAuth, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35.
===
LOG: This bind starts in default load context.
LOG: Using application configuration file: \web.config
LOG: Using host configuration file: C:\Windows\Microsoft.NET\Framework64\v4.0.30319\aspnet.config
LOG: Using machine configuration file from C:\Windows\Microsoft.NET\Framework64\v4.0.30319\config\machine.config.
LOG: Post-policy reference: DotNetOpenAuth.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=2780ccd10d57b246
LOG: Attempting download of new URL file:////DotNetOpenAuth.Core.DLL.
LOG: Attempting download of new URL file:////DotNetOpenAuth.Core/DotNetOpenAuth.Core.DLL.
LOG: Attempting download of new URL file:////DotNetOpenAuth.Core.DLL.
WRN: Comparing the assembly name resulted in the mismatch: Minor Version
ERR: Failed to complete setup of assembly (hr = 0x80131040). Probing terminated.
</code></pre></div></div>

<p>The key pieces of information here are at lines 3 and 7. Basically, Microsoft.Web.WebPages.OAuth needs DotNetOpenAuth.Core 4.0.0.0, but the DotNetOpenAuth.Core I have is version4.3.0.0.</p>

<p>The solution is to add these lines under the <runtime>/<assemblyBinding> section of the root Web.config:</assemblyBinding></runtime></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependentAssembly&gt;</span>
    <span class="nt">&lt;assemblyIdentity</span> <span class="na">name=</span><span class="s">"DotNetOpenAuth.AspNet"</span> <span class="na">publicKeyToken=</span><span class="s">"2780ccd10d57b246"</span> <span class="na">culture=</span><span class="s">"neutral"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;bindingRedirect</span> <span class="na">oldVersion=</span><span class="s">"0.0.0.0-4.3.0.0"</span> <span class="na">newVersion=</span><span class="s">"4.3.0.0"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/dependentAssembly&gt;</span>
<span class="nt">&lt;dependentAssembly&gt;</span>
    <span class="nt">&lt;assemblyIdentity</span> <span class="na">name=</span><span class="s">"DotNetOpenAuth.Core"</span> <span class="na">publicKeyToken=</span><span class="s">"2780ccd10d57b246"</span> <span class="na">culture=</span><span class="s">"neutral"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;bindingRedirect</span> <span class="na">oldVersion=</span><span class="s">"0.0.0.0-4.3.0.0"</span> <span class="na">newVersion=</span><span class="s">"4.3.0.0"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/dependentAssembly&gt;</span>
</code></pre></div></div>

<p>The above solution works for other packages that ASP.NET MVC 4 depends on. For example, if you upgrade WebGrease from 1.0.0.0 to 1.3.0.0, you have to add this to the <runtime>/<assemblyBinding> section:</assemblyBinding></runtime></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependentAssembly&gt;</span>
    <span class="nt">&lt;assemblyIdentity</span> <span class="na">name=</span><span class="s">"WebGrease"</span> <span class="na">publicKeyToken=</span><span class="s">"31bf3856ad364e35"</span> <span class="na">culture=</span><span class="s">"neutral"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;bindingRedirect</span> <span class="na">oldVersion=</span><span class="s">"0.0.0.0-1.3.0.0"</span> <span class="na">newVersion=</span><span class="s">"1.3.0.0"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/dependentAssembly&gt;</span>
</code></pre></div></div>

  
    <hr>
    <div id="disqus_thread"></div>
    
    <noscript>Please enable JavaScript to view comments.</noscript>
  
</article>



<footer>
  <div>&copy; Swift Software Group</div>
  <nav><a aria-label="Mail" href="mailto:hello@swiftsoftwaregroup.com" ><svg aria-hidden="true" class="icon"><use xlink:href="/assets/fontawesome/icons.svg#envelope"></use></svg></a><a aria-label="Github" href="https://github.com/swiftsoftwaregroup" ><svg aria-hidden="true" class="icon"><use xlink:href="/assets/fontawesome/icons.svg#github"></use></svg></a><a aria-label="Subscribe" href="/feed.xml" ><svg aria-hidden="true" class="icon"><use xlink:href="/assets/fontawesome/icons.svg#rss"></use></svg></a></nav>

</footer>


</html>
